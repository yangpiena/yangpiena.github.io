<!DOCTYPE HTML>
<html class="no-js" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
    <!--[if lte IE 9]>
<meta http-equiv="refresh" content="0;url=http://yoursite.com/warn.html">
<![endif]-->
<meta charset="utf-8">
<meta http-equiv="X-DNS-Prefetch-Control" content="on">
<link rel="dns-prefetch" href="http://yoursite.com">
<link rel="dns-prefetch" href="//www.google-analytics.com">
<link rel="prefetch" href="http://yoursite.com">
<link rel="prefetch" href="//www.google-analytics.com">


<link rel="prerender" href="http://yoursite.com">

<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<meta name="renderer" content="webkit">
<meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=no">
<meta http-equiv="mobile-agent" content="format=html5; url=http://yoursite.com">
<meta name="author" content="æ˜œä¸¿æº">
<link rel="stylesheet" href="/css/JSimple.css">

<link rel="shortcut icon" href="/images/favicon.png">


<title>ã€sqlã€‘ç»å…¸è¯­å¥ - æ˜œä¸¿æº</title>

<meta name="keywords" content="undefined">

<meta name="description " content="æ²¡æœ‰é˜³å…‰ï¼Œæ²‰é»˜è€Œå±…">

    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                processEscapes: true
            }
        });
    </script>


    

    

</head>
<body>
<div id="nav">
    <nav class="nav-menu">
        <a class="site-name current" href="/" title="è¯´">è¯´</a>
        <a class="site-index current" href="/"><i class="fa fa-home"></i><span>Home</span></a>
        <a href="/archives" title="Archives"><i class="fa fa-archives"></i><span>Archives</span></a>
        <a href="/tags" title="Tags"><i class="fa fa-tags"></i><span>Tags</span></a>
        <!-- custom single page of menus -->
        
        
        <a href="/help" title="å¸®åŠ©">
            <i class="fa fa-question-circle"></i>
            <span>å¸®åŠ©</span>
        </a>
        
    </nav>
</div>

<div class="nav-user">
    <a class="btn-search" href="#"><i class="fa fa-search"></i></a>
    <a class="btn-read-mode" href="#"><i class="fa fa-sun-o"></i></a>
    <a class="btn-sns-qr" href="javascript:"><i class="fa fa-telegram"></i></a>
</div>

<div id="wrapper" class="clearfix">
    <div id="body">
        <div class="main" id="main">
            <div id="cover">
    <div class="cover-img"></div>
    <div class="cover-info">
        
        <h1 class="cover-siteName">è¯´IT</h1>
        <h3 class="cover-siteTitle">ç”¨ä»£ç æ‘‡æ»šè¿™ä¸ªä¸–ç•Œ</h3>
        <p class="cover-siteDesc">ä¸€ä¸ªå…³æ³¨æŠ€æœ¯ä¸äººæ–‡çš„ITåšå®¢</p>
        <div class="cover-sns">
            
    &nbsp;&nbsp;<div class="btn btn-telegram">
        <a href="http://t.me/kunyintang" target="_blank" title="telegram" ref="friend">
            <i class="fa fa-telegram"></i>
        </a>
    </div>

    &nbsp;&nbsp;<div class="btn btn-instagram">
        <a href="https://www.instagram.com/mtangsir/" target="_blank" title="instagram" ref="friend">
            <i class="fa fa-instagram"></i>
        </a>
    </div>

    &nbsp;&nbsp;<div class="btn btn-twitter">
        <a href="https://twitter.com/tangkunyin" target="_blank" title="twitter" ref="friend">
            <i class="fa fa-twitter"></i>
        </a>
    </div>

    &nbsp;&nbsp;<div class="btn btn-github">
        <a href="https://github.com/tangkunyin" target="_blank" title="github" ref="friend">
            <i class="fa fa-github"></i>
        </a>
    </div>


        </div>
    </div>
</div>

            <div class="page-title">
    <ul>
        <li><a href="/">Recent Posts</a></li>
        
            
                <li class="">
                    <a href="/categories/tech-notes" data-name="æŠ€æœ¯">æŠ€æœ¯</a>
                </li>
            
                <li class="">
                    <a href="/categories/humanities" data-name="äººæ–‡">äººæ–‡</a>
                </li>
            
                <li class="">
                    <a href="/categories/others" data-name="å…¶ä»–">å…¶ä»–</a>
                </li>
            
        
        <li class="page-search">
    <form id="search" class="search-form">
        <input type="text" readonly="readonly" id="local-search-input-tip" placeholder="click to search...">
        <button type="button" disabled="disabled" class="search-form-submit"><i class="fa fa-search"></i></button>
    </form>
</li>

    </ul>
</div>
<div class="main-inner">
    <article class="post" itemscope="" itemtype="http://schema.org/BlogPosting">
        <div class="post-header">
            <div class="post-author clearfix">
                <a class="avatar fleft" href="https://shuoit.net" target="_blank">
                    <img width="48" src="/images/favicon.png" alt="avatar">
                </a>
                <p><span class="label">Author</span>
                    <a href="https://shuoit.net" target="_blank">çº ç»“ä¼¦</a>
                    <span title="Last edited at&nbsp;2016-11-29">2016-11-29</span>
                </p>
                <p>ä¸€ä¸ªæ¬ğŸ§±çš„åŠ³æ–¯åŸºğŸ˜ï¸ï¸</p>
            </div>
            <h2 class="post-title">ã€SQLã€‘ç»å…¸è¯­å¥</h2>
            <div class="post-meta">
                emm... 17997 words in the article |
                you are the&nbsp;<span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span>th friend who reading now
            </div>
        </div>
        <div class="post-content markdown-body">
            <h1 id="ä¸€-åŸºç¡€ç¯‡"><a href="#ä¸€-åŸºç¡€ç¯‡" class="headerlink" title="ä¸€. åŸºç¡€ç¯‡"></a>ä¸€. åŸºç¡€ç¯‡</h1><h2 id="1-åˆ›å»ºæ•°æ®åº“"><a href="#1-åˆ›å»ºæ•°æ®åº“" class="headerlink" title="1. åˆ›å»ºæ•°æ®åº“"></a>1. åˆ›å»ºæ•°æ®åº“</h2><pre><code>CREATE DATABASE database-name
</code></pre><h2 id="2-åˆ é™¤æ•°æ®åº“"><a href="#2-åˆ é™¤æ•°æ®åº“" class="headerlink" title="2. åˆ é™¤æ•°æ®åº“"></a>2. åˆ é™¤æ•°æ®åº“</h2><pre><code>drop database dbname
</code></pre><h2 id="3-å¤‡ä»½sql-server"><a href="#3-å¤‡ä»½sql-server" class="headerlink" title="3. å¤‡ä»½sql server"></a>3. å¤‡ä»½sql server</h2><pre><code>åˆ›å»º å¤‡ä»½æ•°æ®çš„ device
USE master
EXEC sp_addumpdevice &apos;disk&apos;, &apos;testBack&apos;, &apos;c:\mssql7backup\MyNwind_1.dat&apos;
å¼€å§‹ å¤‡ä»½
BACKUP DATABASE pubs TO testBack 
</code></pre><a id="more"></a>
<h2 id="4-åˆ›å»ºæ–°è¡¨"><a href="#4-åˆ›å»ºæ–°è¡¨" class="headerlink" title="4. åˆ›å»ºæ–°è¡¨"></a>4. åˆ›å»ºæ–°è¡¨</h2><pre><code>create table tabname(col1 type1 [not null] [primary key],col2 type2 [not null],..)
</code></pre><p>æ ¹æ®å·²æœ‰çš„è¡¨åˆ›å»ºæ–°è¡¨ï¼š</p>
<pre><code>Aï¼šcreate table tab_new like tab_old (ä½¿ç”¨æ—§è¡¨åˆ›å»ºæ–°è¡¨)
Bï¼šcreate table tab_new as select col1,col2â€¦ from tab_old definition only
</code></pre><h2 id="5-åˆ é™¤æ–°è¡¨"><a href="#5-åˆ é™¤æ–°è¡¨" class="headerlink" title="5. åˆ é™¤æ–°è¡¨"></a>5. åˆ é™¤æ–°è¡¨</h2><pre><code>drop table tabname
</code></pre><h2 id="6-å¢åŠ ä¸€ä¸ªåˆ—"><a href="#6-å¢åŠ ä¸€ä¸ªåˆ—" class="headerlink" title="6. å¢åŠ ä¸€ä¸ªåˆ—"></a>6. å¢åŠ ä¸€ä¸ªåˆ—</h2><pre><code>Alter table tabname add column col type
</code></pre><blockquote>
<p>æ³¨ï¼šåˆ—å¢åŠ åå°†ä¸èƒ½åˆ é™¤ã€‚DB2ä¸­åˆ—åŠ ä¸Šåæ•°æ®ç±»å‹ä¹Ÿä¸èƒ½æ”¹å˜ï¼Œå”¯ä¸€èƒ½æ”¹å˜çš„æ˜¯å¢åŠ varcharç±»å‹çš„é•¿åº¦ã€‚</p>
</blockquote>
<h2 id="7-æ·»åŠ ä¸»é”®"><a href="#7-æ·»åŠ ä¸»é”®" class="headerlink" title="7. æ·»åŠ ä¸»é”®"></a>7. æ·»åŠ ä¸»é”®</h2><pre><code>ALTER TABLE tabname ADD PRIMARY KEY (col)
</code></pre><p>åˆ é™¤ä¸»é”®</p>
<pre><code>ALTER TABLE tabname DROP PRIMARY KEY (col)
</code></pre><h2 id="8-åˆ›å»ºç´¢å¼•"><a href="#8-åˆ›å»ºç´¢å¼•" class="headerlink" title="8. åˆ›å»ºç´¢å¼•"></a>8. åˆ›å»ºç´¢å¼•</h2><pre><code>create [unique] index idxname on tabname(colâ€¦.) 
</code></pre><p>åˆ é™¤ç´¢å¼•</p>
<pre><code>drop index idxname
</code></pre><blockquote>
<p>æ³¨ï¼šç´¢å¼•æ˜¯ä¸å¯æ›´æ”¹çš„ï¼Œæƒ³æ›´æ”¹å¿…é¡»åˆ é™¤é‡æ–°å»ºã€‚</p>
</blockquote>
<h2 id="9-åˆ›å»ºè§†å›¾"><a href="#9-åˆ›å»ºè§†å›¾" class="headerlink" title="9. åˆ›å»ºè§†å›¾"></a>9. åˆ›å»ºè§†å›¾</h2><pre><code>create view viewname as select statement 
</code></pre><p>åˆ é™¤è§†å›¾</p>
<pre><code>drop view viewname
</code></pre><h2 id="10-å‡ ä¸ªç®€å•çš„åŸºæœ¬sqlè¯­å¥"><a href="#10-å‡ ä¸ªç®€å•çš„åŸºæœ¬sqlè¯­å¥" class="headerlink" title="10. å‡ ä¸ªç®€å•çš„åŸºæœ¬sqlè¯­å¥"></a>10. å‡ ä¸ªç®€å•çš„åŸºæœ¬sqlè¯­å¥</h2><p>é€‰æ‹©</p>
<pre><code>select * from table1 where èŒƒå›´
</code></pre><p>æ’å…¥</p>
<pre><code>insert into table1(field1,field2) values(value1,value2)
</code></pre><p>åˆ é™¤</p>
<pre><code>delete from table1 where èŒƒå›´
</code></pre><p>æ›´æ–°</p>
<pre><code>update table1 set field1=value1 where èŒƒå›´
</code></pre><p>æŸ¥æ‰¾</p>
<pre><code>select * from table1 where field1 like â€™%value1%â€™
</code></pre><p>æ’åº</p>
<pre><code>select * from table1 order by field1,field2 [desc]
</code></pre><p>æ€»æ•°</p>
<pre><code>select count as totalcount from table1
</code></pre><p>æ±‚å’Œ</p>
<pre><code>select sum(field1) as sumvalue from table1
</code></pre><p>å¹³å‡</p>
<pre><code>select avg(field1) as avgvalue from table1
</code></pre><p>æœ€å¤§</p>
<pre><code>select max(field1) as maxvalue from table1
</code></pre><p>æœ€å°</p>
<pre><code>select min(field1) as minvalue from table1
</code></pre><h2 id="11-å‡ ä¸ªé«˜çº§æŸ¥è¯¢è¿ç®—è¯"><a href="#11-å‡ ä¸ªé«˜çº§æŸ¥è¯¢è¿ç®—è¯" class="headerlink" title="11. å‡ ä¸ªé«˜çº§æŸ¥è¯¢è¿ç®—è¯"></a>11. å‡ ä¸ªé«˜çº§æŸ¥è¯¢è¿ç®—è¯</h2><ul>
<li>Aï¼š UNION è¿ç®—ç¬¦<br>UNION è¿ç®—ç¬¦é€šè¿‡ç»„åˆå…¶ä»–ä¸¤ä¸ªç»“æœè¡¨ï¼ˆä¾‹å¦‚ TABLE1 å’Œ TABLE2ï¼‰å¹¶æ¶ˆå»è¡¨ä¸­ä»»ä½•é‡å¤è¡Œè€Œæ´¾ç”Ÿå‡ºä¸€ä¸ªç»“æœè¡¨ã€‚å½“ ALL éš UNIONä¸€èµ·ä½¿ç”¨æ—¶ï¼ˆå³ UNION ALLï¼‰ï¼Œä¸æ¶ˆé™¤é‡å¤è¡Œã€‚ä¸¤ç§æƒ…å†µä¸‹ï¼Œæ´¾ç”Ÿè¡¨çš„æ¯ä¸€è¡Œä¸æ˜¯æ¥è‡ª TABLE1 å°±æ˜¯æ¥è‡ª TABLE2ã€‚ </li>
<li>Bï¼š EXCEPT è¿ç®—ç¬¦<br>EXCEPT è¿ç®—ç¬¦é€šè¿‡åŒ…æ‹¬æ‰€æœ‰åœ¨ TABLE1 ä¸­ä½†ä¸åœ¨ TABLE2 ä¸­çš„è¡Œå¹¶æ¶ˆé™¤æ‰€æœ‰é‡å¤è¡Œè€Œæ´¾ç”Ÿå‡ºä¸€ä¸ªç»“æœè¡¨ã€‚å½“ ALL éš EXCEPT ä¸€èµ·ä½¿ç”¨æ—¶ (EXCEPT ALL)ï¼Œä¸æ¶ˆé™¤é‡å¤è¡Œã€‚ </li>
<li>Cï¼š INTERSECT è¿ç®—ç¬¦<br>INTERSECT è¿ç®—ç¬¦é€šè¿‡åªåŒ…æ‹¬ TABLE1 å’Œ TABLE2 ä¸­éƒ½æœ‰çš„è¡Œå¹¶æ¶ˆé™¤æ‰€æœ‰é‡å¤è¡Œè€Œæ´¾ç”Ÿå‡ºä¸€ä¸ªç»“æœè¡¨ã€‚å½“ ALL éš INTERSECT ä¸€èµ·ä½¿ç”¨æ—¶ (INTERSECT ALL)ï¼Œä¸æ¶ˆé™¤é‡å¤è¡Œã€‚ <blockquote>
<p>æ³¨ï¼šä½¿ç”¨è¿ç®—è¯çš„å‡ ä¸ªæŸ¥è¯¢ç»“æœè¡Œå¿…é¡»æ˜¯ä¸€è‡´çš„ã€‚</p>
</blockquote>
</li>
</ul>
<h2 id="12-ä½¿ç”¨å¤–è¿æ¥"><a href="#12-ä½¿ç”¨å¤–è¿æ¥" class="headerlink" title="12. ä½¿ç”¨å¤–è¿æ¥"></a>12. ä½¿ç”¨å¤–è¿æ¥</h2><ul>
<li>A. left ï¼ˆouterï¼‰ joinï¼š<br>å·¦å¤–è¿æ¥ï¼ˆå·¦è¿æ¥ï¼‰ï¼šç»“æœé›†å‡ åŒ…æ‹¬è¿æ¥è¡¨çš„åŒ¹é…è¡Œï¼Œä¹ŸåŒ…æ‹¬å·¦è¿æ¥è¡¨çš„æ‰€æœ‰è¡Œã€‚ </li>
</ul>
<pre><code>select a.a, a.b, a.c, b.c, b.d, b.f from a LEFT OUT JOIN b ON a.a = b.c
</code></pre><ul>
<li>Bï¼šright ï¼ˆouterï¼‰ join:<br>å³å¤–è¿æ¥(å³è¿æ¥)ï¼šç»“æœé›†æ—¢åŒ…æ‹¬è¿æ¥è¡¨çš„åŒ¹é…è¿æ¥è¡Œï¼Œä¹ŸåŒ…æ‹¬å³è¿æ¥è¡¨çš„æ‰€æœ‰è¡Œã€‚ </li>
<li>Cï¼šfull/cross ï¼ˆouterï¼‰ joinï¼š<br>å…¨å¤–è¿æ¥ï¼šä¸ä»…åŒ…æ‹¬ç¬¦å·è¿æ¥è¡¨çš„åŒ¹é…è¡Œï¼Œè¿˜åŒ…æ‹¬ä¸¤ä¸ªè¿æ¥è¡¨ä¸­çš„æ‰€æœ‰è®°å½•ã€‚</li>
</ul>
<h2 id="13-åˆ†ç»„-Group-by"><a href="#13-åˆ†ç»„-Group-by" class="headerlink" title="13. åˆ†ç»„:Group by"></a>13. åˆ†ç»„:Group by</h2><p>ä¸€å¼ è¡¨ï¼Œä¸€æ—¦åˆ†ç»„ å®Œæˆåï¼ŒæŸ¥è¯¢ååªèƒ½å¾—åˆ°ç»„ç›¸å…³çš„ä¿¡æ¯ã€‚<br>ç»„ç›¸å…³çš„ä¿¡æ¯ï¼šï¼ˆç»Ÿè®¡ä¿¡æ¯ï¼‰ count,sum,max,min,avg åˆ†ç»„çš„æ ‡å‡†)<br>åœ¨SQLServerä¸­åˆ†ç»„æ—¶ï¼šä¸èƒ½ä»¥text,ntext,imageç±»å‹çš„å­—æ®µä½œä¸ºåˆ†ç»„ä¾æ®<br>åœ¨selecteç»Ÿè®¡å‡½æ•°ä¸­çš„å­—æ®µï¼Œä¸èƒ½å’Œæ™®é€šçš„å­—æ®µæ”¾åœ¨ä¸€èµ·ï¼›</p>
<h2 id="14-å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œ"><a href="#14-å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œ" class="headerlink" title="14. å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œ"></a>14. å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œ</h2><p>åˆ†ç¦»æ•°æ®åº“ï¼š sp_detach_db; é™„åŠ æ•°æ®åº“ï¼šsp_attach_db åæ¥è¡¨æ˜ï¼Œé™„åŠ éœ€è¦å®Œæ•´çš„è·¯å¾„å</p>
<h2 id="15-å¦‚ä½•ä¿®æ”¹æ•°æ®åº“çš„åç§°"><a href="#15-å¦‚ä½•ä¿®æ”¹æ•°æ®åº“çš„åç§°" class="headerlink" title="15. å¦‚ä½•ä¿®æ”¹æ•°æ®åº“çš„åç§°"></a>15. å¦‚ä½•ä¿®æ”¹æ•°æ®åº“çš„åç§°</h2><p>sp_renamedb â€˜old_nameâ€™, â€˜new_nameâ€™</p>
<h2 id="16-æŸ¥è¯¢å­—æ®µIDæœ€å¤§å€¼çš„è®°å½•"><a href="#16-æŸ¥è¯¢å­—æ®µIDæœ€å¤§å€¼çš„è®°å½•" class="headerlink" title="16. æŸ¥è¯¢å­—æ®µIDæœ€å¤§å€¼çš„è®°å½•"></a>16. æŸ¥è¯¢å­—æ®µIDæœ€å¤§å€¼çš„è®°å½•</h2><p>æ— ç´¢å¼•</p>
<pre><code>select time from table t1 where not exists (select 1 from table where id &gt; t1.id) 
</code></pre><p>æœ‰ç´¢å¼•</p>
<pre><code>select time from table where id in (select max(id) from table)
</code></pre><h2 id="17-æŸ¥è¯¢æŸä¸€åˆ—çš„é‡å¤é¡¹å†…å®¹"><a href="#17-æŸ¥è¯¢æŸä¸€åˆ—çš„é‡å¤é¡¹å†…å®¹" class="headerlink" title="17. æŸ¥è¯¢æŸä¸€åˆ—çš„é‡å¤é¡¹å†…å®¹"></a>17. æŸ¥è¯¢æŸä¸€åˆ—çš„é‡å¤é¡¹å†…å®¹</h2><pre><code>SELECT * FROM documentation AS A WHERE (SELECT COUNT(*) FROM documentation WHERE fileName=A.fileName)&gt;1 
</code></pre><h2 id="18-åˆ¤æ–­è¡¨ä¸­æ˜¯å¦å­˜åœ¨è®°å½•"><a href="#18-åˆ¤æ–­è¡¨ä¸­æ˜¯å¦å­˜åœ¨è®°å½•" class="headerlink" title="18. åˆ¤æ–­è¡¨ä¸­æ˜¯å¦å­˜åœ¨è®°å½•"></a>18. åˆ¤æ–­è¡¨ä¸­æ˜¯å¦å­˜åœ¨è®°å½•</h2><pre><code>SELECT COUNT (*) FROM tableName WHERE conditions
</code></pre><hr>
<h1 id="äºŒ-æå‡ç¯‡"><a href="#äºŒ-æå‡ç¯‡" class="headerlink" title="äºŒ. æå‡ç¯‡"></a>äºŒ. æå‡ç¯‡</h1><h2 id="1-å¤åˆ¶è¡¨-åªå¤åˆ¶ç»“æ„-æºè¡¨åï¼ša-æ–°è¡¨åï¼šb-Accesså¯ç”¨"><a href="#1-å¤åˆ¶è¡¨-åªå¤åˆ¶ç»“æ„-æºè¡¨åï¼ša-æ–°è¡¨åï¼šb-Accesså¯ç”¨" class="headerlink" title="1. å¤åˆ¶è¡¨(åªå¤åˆ¶ç»“æ„,æºè¡¨åï¼ša æ–°è¡¨åï¼šb) (Accesså¯ç”¨)"></a>1. å¤åˆ¶è¡¨(åªå¤åˆ¶ç»“æ„,æºè¡¨åï¼ša æ–°è¡¨åï¼šb) (Accesså¯ç”¨)</h2><p>æ³•ä¸€</p>
<pre><code>select * into b from a where 1&lt;&gt;1ï¼ˆä»…ç”¨äºSQlServerï¼‰
</code></pre><p>æ³•äºŒ</p>
<pre><code>select top 0 * into b from a
</code></pre><h2 id="2-æ‹·è´è¡¨-æ‹·è´æ•°æ®-æºè¡¨åï¼ša-ç›®æ ‡è¡¨åï¼šb-Accesså¯ç”¨"><a href="#2-æ‹·è´è¡¨-æ‹·è´æ•°æ®-æºè¡¨åï¼ša-ç›®æ ‡è¡¨åï¼šb-Accesså¯ç”¨" class="headerlink" title="2. æ‹·è´è¡¨(æ‹·è´æ•°æ®,æºè¡¨åï¼ša ç›®æ ‡è¡¨åï¼šb) (Accesså¯ç”¨)"></a>2. æ‹·è´è¡¨(æ‹·è´æ•°æ®,æºè¡¨åï¼ša ç›®æ ‡è¡¨åï¼šb) (Accesså¯ç”¨)</h2><pre><code>insert into b(a, b, c) select d,e,f from b;
</code></pre><h2 id="3-è·¨æ•°æ®åº“ä¹‹é—´è¡¨çš„æ‹·è´-å…·ä½“æ•°æ®ä½¿ç”¨ç»å¯¹è·¯å¾„-Accesså¯ç”¨"><a href="#3-è·¨æ•°æ®åº“ä¹‹é—´è¡¨çš„æ‹·è´-å…·ä½“æ•°æ®ä½¿ç”¨ç»å¯¹è·¯å¾„-Accesså¯ç”¨" class="headerlink" title="3. è·¨æ•°æ®åº“ä¹‹é—´è¡¨çš„æ‹·è´(å…·ä½“æ•°æ®ä½¿ç”¨ç»å¯¹è·¯å¾„) (Accesså¯ç”¨)"></a>3. è·¨æ•°æ®åº“ä¹‹é—´è¡¨çš„æ‹·è´(å…·ä½“æ•°æ®ä½¿ç”¨ç»å¯¹è·¯å¾„) (Accesså¯ç”¨)</h2><pre><code>insert into b(a, b, c) select d,e,f from b in â€˜å…·ä½“æ•°æ®åº“â€™ where æ¡ä»¶
</code></pre><p>ä¾‹å­ï¼š..from b in â€˜â€œ&amp;Server.MapPath(â€œ.â€)&amp;â€\data.mdbâ€ &amp;â€â€˜ where..</p>
<h2 id="4-å­æŸ¥è¯¢-è¡¨å1ï¼ša-è¡¨å2ï¼šb"><a href="#4-å­æŸ¥è¯¢-è¡¨å1ï¼ša-è¡¨å2ï¼šb" class="headerlink" title="4. å­æŸ¥è¯¢(è¡¨å1ï¼ša è¡¨å2ï¼šb)"></a>4. å­æŸ¥è¯¢(è¡¨å1ï¼ša è¡¨å2ï¼šb)</h2><pre><code>select a,b,c from a where a IN (select d from b ) æˆ–è€…: select a,b,c from a where a IN (1,2,3)
</code></pre><h2 id="5-æ˜¾ç¤ºæ–‡ç« ã€æäº¤äººå’Œæœ€åå›å¤æ—¶é—´"><a href="#5-æ˜¾ç¤ºæ–‡ç« ã€æäº¤äººå’Œæœ€åå›å¤æ—¶é—´" class="headerlink" title="5. æ˜¾ç¤ºæ–‡ç« ã€æäº¤äººå’Œæœ€åå›å¤æ—¶é—´"></a>5. æ˜¾ç¤ºæ–‡ç« ã€æäº¤äººå’Œæœ€åå›å¤æ—¶é—´</h2><pre><code>select a.title,a.username,b.adddate from table a,(select max(adddate) adddate from table where table.title=a.title) b
</code></pre><h2 id="6-å¤–è¿æ¥æŸ¥è¯¢-è¡¨å1ï¼ša-è¡¨å2ï¼šb"><a href="#6-å¤–è¿æ¥æŸ¥è¯¢-è¡¨å1ï¼ša-è¡¨å2ï¼šb" class="headerlink" title="6. å¤–è¿æ¥æŸ¥è¯¢(è¡¨å1ï¼ša è¡¨å2ï¼šb)"></a>6. å¤–è¿æ¥æŸ¥è¯¢(è¡¨å1ï¼ša è¡¨å2ï¼šb)</h2><pre><code>select a.a, a.b, a.c, b.c, b.d, b.f from a LEFT OUT JOIN b ON a.a = b.c
</code></pre><h2 id="7-åœ¨çº¿è§†å›¾æŸ¥è¯¢-è¡¨å1ï¼ša"><a href="#7-åœ¨çº¿è§†å›¾æŸ¥è¯¢-è¡¨å1ï¼ša" class="headerlink" title="7. åœ¨çº¿è§†å›¾æŸ¥è¯¢(è¡¨å1ï¼ša )"></a>7. åœ¨çº¿è§†å›¾æŸ¥è¯¢(è¡¨å1ï¼ša )</h2><pre><code>select * from (SELECT a,b,c FROM a) T where t.a &gt; 1;
</code></pre><h2 id="8-betweençš„ç”¨æ³•-betweené™åˆ¶æŸ¥è¯¢æ•°æ®èŒƒå›´æ—¶åŒ…æ‹¬äº†è¾¹ç•Œå€¼-not-betweenä¸åŒ…æ‹¬"><a href="#8-betweençš„ç”¨æ³•-betweené™åˆ¶æŸ¥è¯¢æ•°æ®èŒƒå›´æ—¶åŒ…æ‹¬äº†è¾¹ç•Œå€¼-not-betweenä¸åŒ…æ‹¬" class="headerlink" title="8. betweençš„ç”¨æ³•,betweené™åˆ¶æŸ¥è¯¢æ•°æ®èŒƒå›´æ—¶åŒ…æ‹¬äº†è¾¹ç•Œå€¼,not betweenä¸åŒ…æ‹¬"></a>8. betweençš„ç”¨æ³•,betweené™åˆ¶æŸ¥è¯¢æ•°æ®èŒƒå›´æ—¶åŒ…æ‹¬äº†è¾¹ç•Œå€¼,not betweenä¸åŒ…æ‹¬</h2><pre><code>select * from table1 where time between time1 and time2
select a,b,c, from table1 where a not between æ•°å€¼1 and æ•°å€¼2
</code></pre><h2 id="9-in-çš„ä½¿ç”¨æ–¹æ³•"><a href="#9-in-çš„ä½¿ç”¨æ–¹æ³•" class="headerlink" title="9. in çš„ä½¿ç”¨æ–¹æ³•"></a>9. in çš„ä½¿ç”¨æ–¹æ³•</h2><pre><code>select * from table1 where a [not] in (â€˜å€¼1â€™,â€™å€¼2â€™,â€™å€¼4â€™,â€™å€¼6â€™)
</code></pre><h2 id="10-ä¸¤å¼ å…³è”è¡¨ï¼Œåˆ é™¤ä¸»è¡¨ä¸­å·²ç»åœ¨å‰¯è¡¨ä¸­æ²¡æœ‰çš„ä¿¡æ¯"><a href="#10-ä¸¤å¼ å…³è”è¡¨ï¼Œåˆ é™¤ä¸»è¡¨ä¸­å·²ç»åœ¨å‰¯è¡¨ä¸­æ²¡æœ‰çš„ä¿¡æ¯" class="headerlink" title="10. ä¸¤å¼ å…³è”è¡¨ï¼Œåˆ é™¤ä¸»è¡¨ä¸­å·²ç»åœ¨å‰¯è¡¨ä¸­æ²¡æœ‰çš„ä¿¡æ¯"></a>10. ä¸¤å¼ å…³è”è¡¨ï¼Œåˆ é™¤ä¸»è¡¨ä¸­å·²ç»åœ¨å‰¯è¡¨ä¸­æ²¡æœ‰çš„ä¿¡æ¯</h2><pre><code>delete from table1 where not exists ( select * from table2 where table1.field1=table2.field1 )
</code></pre><h2 id="11-å››è¡¨è”æŸ¥é—®é¢˜"><a href="#11-å››è¡¨è”æŸ¥é—®é¢˜" class="headerlink" title="11. å››è¡¨è”æŸ¥é—®é¢˜"></a>11. å››è¡¨è”æŸ¥é—®é¢˜</h2><pre><code>select * from a left inner join b on a.a=b.b right inner join c on a.a=c.c inner join d on a.a=d.d where .....
</code></pre><h2 id="12-æ—¥ç¨‹å®‰æ’æå‰äº”åˆ†é’Ÿæé†’"><a href="#12-æ—¥ç¨‹å®‰æ’æå‰äº”åˆ†é’Ÿæé†’" class="headerlink" title="12. æ—¥ç¨‹å®‰æ’æå‰äº”åˆ†é’Ÿæé†’"></a>12. æ—¥ç¨‹å®‰æ’æå‰äº”åˆ†é’Ÿæé†’</h2><pre><code>select * from æ—¥ç¨‹å®‰æ’ where datediff(&apos;minute&apos;,få¼€å§‹æ—¶é—´,getdate())&gt;5
</code></pre><h2 id="13-ä¸€æ¡sqlè¯­å¥æå®šæ•°æ®åº“åˆ†é¡µ"><a href="#13-ä¸€æ¡sqlè¯­å¥æå®šæ•°æ®åº“åˆ†é¡µ" class="headerlink" title="13. ä¸€æ¡sqlè¯­å¥æå®šæ•°æ®åº“åˆ†é¡µ"></a>13. ä¸€æ¡sqlè¯­å¥æå®šæ•°æ®åº“åˆ†é¡µ</h2><pre><code>select top 10 b.* from (select top 20 ä¸»é”®å­—æ®µ,æ’åºå­—æ®µ from è¡¨å order by æ’åºå­—æ®µ desc) a,è¡¨å b where b.ä¸»é”®å­—æ®µ = a.ä¸»é”®å­—æ®µ order by a.æ’åºå­—æ®µ
</code></pre><p>å…³äºæ•°æ®åº“åˆ†é¡µï¼š</p>
<pre><code>declare @start int,@end int
@sql nvarchar(600)
set @sql=â€™select topâ€™+str(@end-@start+1)+â€™+from T where rid not in(select topâ€™+str(@str-1)+â€™Rid from T where Rid&gt;-1)â€™
exec sp_executesql @sql
</code></pre><blockquote>
<p>æ³¨æ„ï¼šåœ¨topåä¸èƒ½ç›´æ¥è·Ÿä¸€ä¸ªå˜é‡ï¼Œæ‰€ä»¥åœ¨å®é™…åº”ç”¨ä¸­åªæœ‰è¿™æ ·çš„è¿›è¡Œç‰¹æ®Šçš„å¤„ç†ã€‚Ridä¸ºä¸€ä¸ªæ ‡è¯†åˆ—ï¼Œå¦‚æœtopåè¿˜æœ‰å…·ä½“çš„å­—æ®µï¼Œè¿™æ ·åšæ˜¯éå¸¸æœ‰å¥½å¤„çš„ã€‚å› ä¸ºè¿™æ ·å¯ä»¥é¿å… topçš„å­—æ®µå¦‚æœæ˜¯é€»è¾‘ç´¢å¼•çš„ï¼ŒæŸ¥è¯¢çš„ç»“æœåå®é™…è¡¨ä¸­çš„ä¸ä¸€è‡´ï¼ˆé€»è¾‘ç´¢å¼•ä¸­çš„æ•°æ®æœ‰å¯èƒ½å’Œæ•°æ®è¡¨ä¸­çš„ä¸ä¸€è‡´ï¼Œè€ŒæŸ¥è¯¢æ—¶å¦‚æœå¤„åœ¨ç´¢å¼•åˆ™é¦–å…ˆæŸ¥è¯¢ç´¢å¼•ï¼‰</p>
</blockquote>
<h2 id="14-å‰10æ¡è®°å½•"><a href="#14-å‰10æ¡è®°å½•" class="headerlink" title="14. å‰10æ¡è®°å½•"></a>14. å‰10æ¡è®°å½•</h2><pre><code>select top 10 * form table1 where èŒƒå›´
</code></pre><h2 id="15-é€‰æ‹©åœ¨æ¯ä¸€ç»„bå€¼ç›¸åŒçš„æ•°æ®ä¸­å¯¹åº”çš„aæœ€å¤§çš„è®°å½•çš„æ‰€æœ‰ä¿¡æ¯-ç±»ä¼¼è¿™æ ·çš„ç”¨æ³•å¯ä»¥ç”¨äºè®ºå›æ¯æœˆæ’è¡Œæ¦œ-æ¯æœˆçƒ­é”€äº§å“åˆ†æ-æŒ‰ç§‘ç›®æˆç»©æ’å-ç­‰ç­‰"><a href="#15-é€‰æ‹©åœ¨æ¯ä¸€ç»„bå€¼ç›¸åŒçš„æ•°æ®ä¸­å¯¹åº”çš„aæœ€å¤§çš„è®°å½•çš„æ‰€æœ‰ä¿¡æ¯-ç±»ä¼¼è¿™æ ·çš„ç”¨æ³•å¯ä»¥ç”¨äºè®ºå›æ¯æœˆæ’è¡Œæ¦œ-æ¯æœˆçƒ­é”€äº§å“åˆ†æ-æŒ‰ç§‘ç›®æˆç»©æ’å-ç­‰ç­‰" class="headerlink" title="15. é€‰æ‹©åœ¨æ¯ä¸€ç»„bå€¼ç›¸åŒçš„æ•°æ®ä¸­å¯¹åº”çš„aæœ€å¤§çš„è®°å½•çš„æ‰€æœ‰ä¿¡æ¯(ç±»ä¼¼è¿™æ ·çš„ç”¨æ³•å¯ä»¥ç”¨äºè®ºå›æ¯æœˆæ’è¡Œæ¦œ,æ¯æœˆçƒ­é”€äº§å“åˆ†æ,æŒ‰ç§‘ç›®æˆç»©æ’å,ç­‰ç­‰.)"></a>15. é€‰æ‹©åœ¨æ¯ä¸€ç»„bå€¼ç›¸åŒçš„æ•°æ®ä¸­å¯¹åº”çš„aæœ€å¤§çš„è®°å½•çš„æ‰€æœ‰ä¿¡æ¯(ç±»ä¼¼è¿™æ ·çš„ç”¨æ³•å¯ä»¥ç”¨äºè®ºå›æ¯æœˆæ’è¡Œæ¦œ,æ¯æœˆçƒ­é”€äº§å“åˆ†æ,æŒ‰ç§‘ç›®æˆç»©æ’å,ç­‰ç­‰.)</h2><pre><code>select a,b,c from tablename ta where a=(select max(a) from tablename tb where tb.b=ta.b)
</code></pre><h2 id="16-åŒ…æ‹¬æ‰€æœ‰åœ¨-TableA-ä¸­ä½†ä¸åœ¨-TableBå’ŒTableC-ä¸­çš„è¡Œå¹¶æ¶ˆé™¤æ‰€æœ‰é‡å¤è¡Œè€Œæ´¾ç”Ÿå‡ºä¸€ä¸ªç»“æœè¡¨"><a href="#16-åŒ…æ‹¬æ‰€æœ‰åœ¨-TableA-ä¸­ä½†ä¸åœ¨-TableBå’ŒTableC-ä¸­çš„è¡Œå¹¶æ¶ˆé™¤æ‰€æœ‰é‡å¤è¡Œè€Œæ´¾ç”Ÿå‡ºä¸€ä¸ªç»“æœè¡¨" class="headerlink" title="16. åŒ…æ‹¬æ‰€æœ‰åœ¨ TableA ä¸­ä½†ä¸åœ¨ TableBå’ŒTableC ä¸­çš„è¡Œå¹¶æ¶ˆé™¤æ‰€æœ‰é‡å¤è¡Œè€Œæ´¾ç”Ÿå‡ºä¸€ä¸ªç»“æœè¡¨"></a>16. åŒ…æ‹¬æ‰€æœ‰åœ¨ TableA ä¸­ä½†ä¸åœ¨ TableBå’ŒTableC ä¸­çš„è¡Œå¹¶æ¶ˆé™¤æ‰€æœ‰é‡å¤è¡Œè€Œæ´¾ç”Ÿå‡ºä¸€ä¸ªç»“æœè¡¨</h2><pre><code>(select a from tableA ) except (select a from tableB) except (select a from tableC)
</code></pre><h2 id="17-éšæœºå–å‡º10æ¡æ•°æ®"><a href="#17-éšæœºå–å‡º10æ¡æ•°æ®" class="headerlink" title="17. éšæœºå–å‡º10æ¡æ•°æ®"></a>17. éšæœºå–å‡º10æ¡æ•°æ®</h2><pre><code>select top 10 * from tablename order by newid()
</code></pre><h2 id="18-éšæœºé€‰æ‹©è®°å½•"><a href="#18-éšæœºé€‰æ‹©è®°å½•" class="headerlink" title="18. éšæœºé€‰æ‹©è®°å½•"></a>18. éšæœºé€‰æ‹©è®°å½•</h2><pre><code>select newid()
</code></pre><h2 id="19-åˆ é™¤é‡å¤è®°å½•"><a href="#19-åˆ é™¤é‡å¤è®°å½•" class="headerlink" title="19. åˆ é™¤é‡å¤è®°å½•"></a>19. åˆ é™¤é‡å¤è®°å½•</h2><ul>
<li>æ–¹æ³•ä¸€ï¼š</li>
</ul>
<pre><code>delete from tablename where id not in (select max(id) from tablename group by col1,col2,...)
</code></pre><ul>
<li>æ–¹æ³•äºŒï¼š</li>
</ul>
<pre><code>select distinct * into temp from tablename
delete from tablename
insert into tablename select * from temp
</code></pre><blockquote>
<p>è¯„ä»·ï¼š è¿™ç§æ“ä½œç‰µè¿å¤§é‡çš„æ•°æ®çš„ç§»åŠ¨ï¼Œè¿™ç§åšæ³•ä¸é€‚åˆå¤§å®¹é‡çš„æ•°æ®æ“ä½œ</p>
</blockquote>
<ul>
<li>æ–¹æ³•ä¸‰ï¼š ä¾‹å¦‚ï¼šåœ¨ä¸€ä¸ªå¤–éƒ¨è¡¨ä¸­å¯¼å…¥æ•°æ®ï¼Œç”±äºæŸäº›åŸå› ç¬¬ä¸€æ¬¡åªå¯¼å…¥äº†ä¸€éƒ¨åˆ†ï¼Œä½†å¾ˆéš¾åˆ¤æ–­å…·ä½“ä½ç½®ï¼Œè¿™æ ·åªæœ‰åœ¨ä¸‹ä¸€æ¬¡å…¨éƒ¨å¯¼å…¥ï¼Œè¿™æ ·ä¹Ÿå°±äº§ç”Ÿå¥½å¤šé‡å¤çš„å­—æ®µï¼Œæ€æ ·åˆ é™¤é‡å¤å­—æ®µ</li>
</ul>
<pre><code>alter table tablename
add column_b int identity(1,1)    --æ·»åŠ ä¸€ä¸ªè‡ªå¢åˆ—
delete from tablename where column_b not in(
select max(column_b) from tablename group by column1,column2,...)
alter table tablename drop column column_b
</code></pre><h2 id="20-åˆ—å‡ºæ•°æ®åº“é‡Œæ‰€æœ‰çš„è¡¨å"><a href="#20-åˆ—å‡ºæ•°æ®åº“é‡Œæ‰€æœ‰çš„è¡¨å" class="headerlink" title="20. åˆ—å‡ºæ•°æ®åº“é‡Œæ‰€æœ‰çš„è¡¨å"></a>20. åˆ—å‡ºæ•°æ®åº“é‡Œæ‰€æœ‰çš„è¡¨å</h2><pre><code>select name from sysobjects where type=&apos;U&apos; // Uä»£è¡¨ç”¨æˆ·
</code></pre><h2 id="21-åˆ—å‡ºè¡¨é‡Œçš„æ‰€æœ‰çš„åˆ—å"><a href="#21-åˆ—å‡ºè¡¨é‡Œçš„æ‰€æœ‰çš„åˆ—å" class="headerlink" title="21. åˆ—å‡ºè¡¨é‡Œçš„æ‰€æœ‰çš„åˆ—å"></a>21. åˆ—å‡ºè¡¨é‡Œçš„æ‰€æœ‰çš„åˆ—å</h2><pre><code>select name from syscolumns where id=object_id(&apos;TableName&apos;)
</code></pre><h2 id="22-åˆ—ç¤ºtypeã€venderã€pcså­—æ®µï¼Œä»¥typeå­—æ®µæ’åˆ—ï¼Œcaseå¯ä»¥æ–¹ä¾¿åœ°å®ç°å¤šé‡é€‰æ‹©ï¼Œç±»ä¼¼select-ä¸­çš„caseã€‚"><a href="#22-åˆ—ç¤ºtypeã€venderã€pcså­—æ®µï¼Œä»¥typeå­—æ®µæ’åˆ—ï¼Œcaseå¯ä»¥æ–¹ä¾¿åœ°å®ç°å¤šé‡é€‰æ‹©ï¼Œç±»ä¼¼select-ä¸­çš„caseã€‚" class="headerlink" title="22. åˆ—ç¤ºtypeã€venderã€pcså­—æ®µï¼Œä»¥typeå­—æ®µæ’åˆ—ï¼Œcaseå¯ä»¥æ–¹ä¾¿åœ°å®ç°å¤šé‡é€‰æ‹©ï¼Œç±»ä¼¼select ä¸­çš„caseã€‚"></a>22. åˆ—ç¤ºtypeã€venderã€pcså­—æ®µï¼Œä»¥typeå­—æ®µæ’åˆ—ï¼Œcaseå¯ä»¥æ–¹ä¾¿åœ°å®ç°å¤šé‡é€‰æ‹©ï¼Œç±»ä¼¼select ä¸­çš„caseã€‚</h2><pre><code>select type,sum(case vender when &apos;A&apos; then pcs else 0 end),sum(case vender when &apos;C&apos; then pcs else 0 end),sum(case vender when &apos;B&apos; then pcs else 0 end) FROM tablename group by type
</code></pre><p>æ˜¾ç¤ºç»“æœï¼š</p>
<pre><code>type vender pcs
ç”µè„‘ A 1
ç”µè„‘ A 1
å…‰ç›˜ B 2
å…‰ç›˜ A 2
æ‰‹æœº B 3
æ‰‹æœº C 3
</code></pre><h2 id="23-åˆå§‹åŒ–-è¡¨table1"><a href="#23-åˆå§‹åŒ–-è¡¨table1" class="headerlink" title="23. åˆå§‹åŒ– è¡¨table1"></a>23. åˆå§‹åŒ– è¡¨table1</h2><pre><code>TRUNCATE TABLE table1
</code></pre><h2 id="24-é€‰æ‹©ä»10åˆ°15çš„è®°å½•"><a href="#24-é€‰æ‹©ä»10åˆ°15çš„è®°å½•" class="headerlink" title="24. é€‰æ‹©ä»10åˆ°15çš„è®°å½•"></a>24. é€‰æ‹©ä»10åˆ°15çš„è®°å½•</h2><pre><code>select top 5 * from (select top 15 * from table order by id asc) table_åˆ«å order by id desc
</code></pre><h2 id="25-åˆ›å»ºä¸´æ—¶è¡¨"><a href="#25-åˆ›å»ºä¸´æ—¶è¡¨" class="headerlink" title="25. åˆ›å»ºä¸´æ—¶è¡¨"></a>25. åˆ›å»ºä¸´æ—¶è¡¨</h2><ul>
<li>æ–¹æ³•ä¸€ï¼š</li>
</ul>
<pre><code>create table #ä¸´æ—¶è¡¨å(å­—æ®µ1 çº¦æŸæ¡ä»¶,
                       å­—æ®µ2 çº¦æŸæ¡ä»¶,
                      .....)
create table ##ä¸´æ—¶è¡¨å(å­—æ®µ1 çº¦æŸæ¡ä»¶,
                        å­—æ®µ2 çº¦æŸæ¡ä»¶,
                        .....)
</code></pre><p>ä¾‹ï¼š</p>
<pre><code>create table #Tmp --åˆ›å»ºä¸´æ—¶è¡¨#Tmp
(
    ID   int IDENTITY (1,1)     not null, --åˆ›å»ºåˆ—ID,å¹¶ä¸”æ¯æ¬¡æ–°å¢ä¸€æ¡è®°å½•å°±ä¼šåŠ 1
    WokNo                varchar(50),   
    primary key (ID)      --å®šä¹‰IDä¸ºä¸´æ—¶è¡¨#Tmpçš„ä¸»é”®      
);
</code></pre><ul>
<li>æ–¹æ³•äºŒï¼š</li>
</ul>
<pre><code>select * into #ä¸´æ—¶è¡¨å from ä½ çš„è¡¨;
select * into ##ä¸´æ—¶è¡¨å from ä½ çš„è¡¨;
</code></pre><blockquote>
<p>æ³¨ï¼šä»¥ä¸Šçš„#ä»£è¡¨å±€éƒ¨ä¸´æ—¶è¡¨ï¼Œ##ä»£è¡¨å…¨å±€ä¸´æ—¶è¡¨<br>æŸ¥è¯¢ä¸´æ—¶è¡¨</p>
</blockquote>
<pre><code>select * from #ä¸´æ—¶è¡¨å;
select * from ##ä¸´æ—¶è¡¨å;
</code></pre><p>åˆ é™¤ä¸´æ—¶è¡¨</p>
<pre><code>drop table #ä¸´æ—¶è¡¨å;
drop table ##ä¸´æ—¶è¡¨å;
</code></pre><h2 id="26-å…³è”è¡¨æ›´æ–°"><a href="#26-å…³è”è¡¨æ›´æ–°" class="headerlink" title="26. å…³è”è¡¨æ›´æ–°"></a>26. å…³è”è¡¨æ›´æ–°</h2><pre><code>UPDATE A SET A.b=B.d FROM tableA A INNER JOIN tableB B ON A.a = B.a
</code></pre><h2 id="27-æŸ¥çœ‹è¡¨çš„æ‰€æœ‰å¤–é”®å…³ç³»"><a href="#27-æŸ¥çœ‹è¡¨çš„æ‰€æœ‰å¤–é”®å…³ç³»" class="headerlink" title="27. æŸ¥çœ‹è¡¨çš„æ‰€æœ‰å¤–é”®å…³ç³»"></a>27. æŸ¥çœ‹è¡¨çš„æ‰€æœ‰å¤–é”®å…³ç³»</h2><pre><code>select t1.*,t2.name,t3.name from dbo.sysforeignkeys t1 left join sysobjects t2 on t1.fkeyid=t2.id 
           left join sysobjects t3 on t1.rkeyid=t3.id where t3.name=&apos;è¡¨å &apos;
</code></pre><h2 id="28-åˆ é™¤æ‰€æœ‰çº¦æŸ"><a href="#28-åˆ é™¤æ‰€æœ‰çº¦æŸ" class="headerlink" title="28. åˆ é™¤æ‰€æœ‰çº¦æŸ"></a>28. åˆ é™¤æ‰€æœ‰çº¦æŸ</h2><pre><code>DECLARE c1 cursor for
    select &apos;alter table [&apos;+ object_name(parent_obj) + &apos;] drop constraint [&apos;+name+&apos;]; &apos;
    from sysobjects
    where xtype = &apos;F&apos;
open c1
declare @c1 varchar(8000)
fetch next from c1 into @c1
while(@@fetch_status=0)
    begin
        exec(@c1)
        fetch next from c1 into @c1
    end
close c1
deallocate c1
</code></pre><h2 id="29-åˆ é™¤æ•°æ®åº“æ‰€æœ‰è¡¨"><a href="#29-åˆ é™¤æ•°æ®åº“æ‰€æœ‰è¡¨" class="headerlink" title="29. åˆ é™¤æ•°æ®åº“æ‰€æœ‰è¡¨"></a>29. åˆ é™¤æ•°æ®åº“æ‰€æœ‰è¡¨</h2><pre><code>declare @tname varchar(8000)
set @tname=&apos;&apos;
select @tname=@tname + Name + &apos;,&apos; from sysobjects where xtype=&apos;U&apos;
select @tname=&apos;drop table &apos; + left(@tname,len(@tname)-1)
exec(@tname)
</code></pre><h2 id="30-åˆ é™¤å¤–é”®çº¦æŸ"><a href="#30-åˆ é™¤å¤–é”®çº¦æŸ" class="headerlink" title="30. åˆ é™¤å¤–é”®çº¦æŸ"></a>30. åˆ é™¤å¤–é”®çº¦æŸ</h2><p>å¾—åˆ°æŸä¸ªè¡¨è¢«å“ªäº›å¤–é”®å¼•ç”¨ï¼Œå¹¶ä¸”æ˜¾ç¤ºå‡ºå¤–é”®è¡¨çš„è¡¨å</p>
<pre><code>SELECT
    fk.name,
    fk.object_id,
    OBJECT_NAME(fk.parent_object_id) AS referenceTableName
FROM
    sys.foreign_keys AS fk
JOIN sys.objects AS o ON fk.referenced_object_id = o.object_id
WHERE
    o.name = &apos;ATTACHMENTDOC&apos;;
</code></pre><p>é€šè¿‡å¤–é”®è¡¨çš„è¡¨åå’Œå¤–é”®åç§°æ‰§è¡Œä»¥ä¸‹è¯­å¥å³å¯åˆ é™¤å¤–é”®</p>
<pre><code>ALTER TABLE dbo.CONTRACTINFO DROP CONSTRAINT FK_CONTRACTINFO_ATTACHMENTDOC
</code></pre><h2 id="31-æŸ¥æ‰¾æŒ‡å®šæ•°æ®åº“è¡¨çš„å­—æ®µåï¼Œç±»å‹ï¼Œæ³¨é‡Š"><a href="#31-æŸ¥æ‰¾æŒ‡å®šæ•°æ®åº“è¡¨çš„å­—æ®µåï¼Œç±»å‹ï¼Œæ³¨é‡Š" class="headerlink" title="31. æŸ¥æ‰¾æŒ‡å®šæ•°æ®åº“è¡¨çš„å­—æ®µåï¼Œç±»å‹ï¼Œæ³¨é‡Š"></a>31. æŸ¥æ‰¾æŒ‡å®šæ•°æ®åº“è¡¨çš„å­—æ®µåï¼Œç±»å‹ï¼Œæ³¨é‡Š</h2><pre><code>    SELECT c.object_id, c.name AS cname, t.name AS tname, is_computed AS isComputed,
           (SELECT VALUE
              FROM sys.extended_properties AS ex
             WHERE ex.major_id = c.object_id AND ex.minor_id = c.column_id) AS notes
      FROM sys.columns AS c
INNER JOIN sys.tables  AS ta ON c.object_id = ta.object_id
INNER JOIN (SELECT name, system_type_id
              FROM sys.types
             WHERE name &lt;&gt; &apos;sysname&apos;) AS t ON c.system_type_id = t.system_type_id
     WHERE ta.name = &apos;æŒ‡å®šæ•°æ®åº“è¡¨&apos;
  ORDER BY c.column_id
</code></pre><h2 id="32-åŒæ­¥è¡¨æ•°æ®"><a href="#32-åŒæ­¥è¡¨æ•°æ®" class="headerlink" title="32. åŒæ­¥è¡¨æ•°æ®"></a>32. åŒæ­¥è¡¨æ•°æ®</h2><pre><code>INSERT è¡¨2 
SELECT * FROM è¡¨1 AS a WHERE NOT EXISTS(SELECT 1 FROM è¡¨2 WHERE ID = a.ID);
</code></pre><h2 id="33-åˆ¤æ–­æŸåˆ—ä¸­æ˜¯å¦åŒ…å«ä¸­æ–‡å­—ç¬¦æˆ–è€…è‹±æ–‡å­—ç¬¦"><a href="#33-åˆ¤æ–­æŸåˆ—ä¸­æ˜¯å¦åŒ…å«ä¸­æ–‡å­—ç¬¦æˆ–è€…è‹±æ–‡å­—ç¬¦" class="headerlink" title="33. åˆ¤æ–­æŸåˆ—ä¸­æ˜¯å¦åŒ…å«ä¸­æ–‡å­—ç¬¦æˆ–è€…è‹±æ–‡å­—ç¬¦"></a>33. åˆ¤æ–­æŸåˆ—ä¸­æ˜¯å¦åŒ…å«ä¸­æ–‡å­—ç¬¦æˆ–è€…è‹±æ–‡å­—ç¬¦</h2><pre><code>SELECT * FROM è¡¨å WHERE æŸåˆ— LIKE &apos;%[å–-åº§]%&apos;
SELECT * FROM è¡¨å WHERE æŸåˆ— LIKE &apos;%[a-z]%&apos;
</code></pre><h2 id="34-è¡Œè½¬åˆ—ï¼Œå°†å¤šè¡Œæ•°æ®åˆå¹¶æˆä¸€è¡Œï¼ˆSQL-SERVER-2005ä»¥ä¸Šæ”¯æŒï¼‰"><a href="#34-è¡Œè½¬åˆ—ï¼Œå°†å¤šè¡Œæ•°æ®åˆå¹¶æˆä¸€è¡Œï¼ˆSQL-SERVER-2005ä»¥ä¸Šæ”¯æŒï¼‰" class="headerlink" title="34. è¡Œè½¬åˆ—ï¼Œå°†å¤šè¡Œæ•°æ®åˆå¹¶æˆä¸€è¡Œï¼ˆSQL SERVER 2005ä»¥ä¸Šæ”¯æŒï¼‰"></a>34. è¡Œè½¬åˆ—ï¼Œå°†å¤šè¡Œæ•°æ®åˆå¹¶æˆä¸€è¡Œï¼ˆSQL SERVER 2005ä»¥ä¸Šæ”¯æŒï¼‰</h2><p>ä¾‹å¦‚è¡¨Table1ä¸­æœ‰ä¸¤åˆ—æ•°æ®ï¼š</p>
<pre><code>code        name
AAA         å§“å1
AAA         å§“å2
AAA         å§“å3
BBB         å§“å4
BBB         å§“å5
</code></pre><p>è¡Œè½¬åˆ—ï¼Œæƒ³å˜æˆå¦‚ä¸‹æ ¼å¼ï¼š</p>
<pre><code>code        name
AAA         å§“å1,å§“å2,å§“å3
BBB         å§“å4,å§“å5
</code></pre><p>å¯ç”¨å¦‚ä¸‹SQLå®ç°ï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">SELECT</span> code, <span class="keyword">name</span> = (<span class="keyword">STUFF</span>((<span class="keyword">SELECT</span> <span class="string">','</span> + <span class="keyword">name</span> </span><br><span class="line">                                <span class="keyword">FROM</span> Table1 </span><br><span class="line">                               <span class="keyword">WHERE</span> code = a.code <span class="keyword">FOR</span> <span class="keyword">xml</span> <span class="keyword">PATH</span>(<span class="string">''</span>)),<span class="number">1</span>,<span class="number">1</span>,<span class="string">''</span>))</span><br><span class="line">    <span class="keyword">FROM</span> Table1 a </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> code</span><br></pre></td></tr></table></figure></p>
<hr>
<h1 id="ä¸‰-æŠ€å·§ç¯‡"><a href="#ä¸‰-æŠ€å·§ç¯‡" class="headerlink" title="ä¸‰. æŠ€å·§ç¯‡"></a>ä¸‰. æŠ€å·§ç¯‡</h1><h2 id="1-1-1ï¼Œ1-2çš„ä½¿ç”¨ï¼Œåœ¨SQLè¯­å¥ç»„åˆæ—¶ç”¨çš„è¾ƒå¤š"><a href="#1-1-1ï¼Œ1-2çš„ä½¿ç”¨ï¼Œåœ¨SQLè¯­å¥ç»„åˆæ—¶ç”¨çš„è¾ƒå¤š" class="headerlink" title="1. 1=1ï¼Œ1=2çš„ä½¿ç”¨ï¼Œåœ¨SQLè¯­å¥ç»„åˆæ—¶ç”¨çš„è¾ƒå¤š"></a>1. 1=1ï¼Œ1=2çš„ä½¿ç”¨ï¼Œåœ¨SQLè¯­å¥ç»„åˆæ—¶ç”¨çš„è¾ƒå¤š</h2><p>â€œwhere 1=1â€ è¡¨ç¤ºé€‰æ‹©å…¨éƒ¨<br>â€œwhere 1=2â€ è¡¨ç¤ºå…¨éƒ¨ä¸é€‰</p>
<h2 id="2-æ”¶ç¼©æ•°æ®åº“"><a href="#2-æ”¶ç¼©æ•°æ®åº“" class="headerlink" title="2. æ”¶ç¼©æ•°æ®åº“"></a>2. æ”¶ç¼©æ•°æ®åº“</h2><p>é‡å»ºç´¢å¼•</p>
<pre><code>DBCC REINDEX
DBCC INDEXDEFRAG
</code></pre><p>æ”¶ç¼©æ•°æ®å’Œæ—¥å¿—</p>
<pre><code>DBCC SHRINKDB
DBCC SHRINKFILE
</code></pre><h2 id="3-å‹ç¼©æ•°æ®åº“"><a href="#3-å‹ç¼©æ•°æ®åº“" class="headerlink" title="3. å‹ç¼©æ•°æ®åº“"></a>3. å‹ç¼©æ•°æ®åº“</h2><pre><code>dbcc shrinkdatabase(dbname)
</code></pre><h2 id="4-è½¬ç§»æ•°æ®åº“ç»™æ–°ç”¨æˆ·ä»¥å·²å­˜åœ¨ç”¨æˆ·æƒé™"><a href="#4-è½¬ç§»æ•°æ®åº“ç»™æ–°ç”¨æˆ·ä»¥å·²å­˜åœ¨ç”¨æˆ·æƒé™" class="headerlink" title="4. è½¬ç§»æ•°æ®åº“ç»™æ–°ç”¨æˆ·ä»¥å·²å­˜åœ¨ç”¨æˆ·æƒé™"></a>4. è½¬ç§»æ•°æ®åº“ç»™æ–°ç”¨æˆ·ä»¥å·²å­˜åœ¨ç”¨æˆ·æƒé™</h2><pre><code>exec sp_change_users_login &apos;update_one&apos;,&apos;newname&apos;,&apos;oldname&apos;
go
</code></pre><h2 id="5-æ£€æŸ¥å¤‡ä»½é›†"><a href="#5-æ£€æŸ¥å¤‡ä»½é›†" class="headerlink" title="5. æ£€æŸ¥å¤‡ä»½é›†"></a>5. æ£€æŸ¥å¤‡ä»½é›†</h2><pre><code>RESTORE VERIFYONLY from disk=&apos;E:\dvbbs.bak&apos;
</code></pre><h2 id="6-ä¿®å¤æ•°æ®åº“"><a href="#6-ä¿®å¤æ•°æ®åº“" class="headerlink" title="6. ä¿®å¤æ•°æ®åº“"></a>6. ä¿®å¤æ•°æ®åº“</h2><pre><code>ALTER DATABASE [dvbbs] SET SINGLE_USER
GO
DBCC CHECKDB(&apos;dvbbs&apos;,repair_allow_data_loss) WITH TABLOCK
GO
ALTER DATABASE [dvbbs] SET MULTI_USER
GO
</code></pre><h2 id="7-æ—¥å¿—æ¸…é™¤"><a href="#7-æ—¥å¿—æ¸…é™¤" class="headerlink" title="7. æ—¥å¿—æ¸…é™¤"></a>7. æ—¥å¿—æ¸…é™¤</h2><pre><code>SET NOCOUNT ON
DECLARE @LogicalFileName sysname,
@MaxMinutes INT,
@NewSize INT

USE tablename -- è¦æ“ä½œçš„æ•°æ®åº“å
SELECT  @LogicalFileName = &apos;tablename_log&apos;, -- æ—¥å¿—æ–‡ä»¶å
@MaxMinutes = 10, -- Limit on time allowed to wrap log.
@NewSize = 1  -- ä½ æƒ³è®¾å®šçš„æ—¥å¿—æ–‡ä»¶çš„å¤§å°(M)
Setup / initialize
DECLARE @OriginalSize int
SELECT @OriginalSize = size 
FROM sysfiles
WHERE name = @LogicalFileName
SELECT &apos;Original Size of &apos; + db_name() + &apos; LOG is &apos; + 
CONVERT(VARCHAR(30),@OriginalSize) + &apos; 8K pages or &apos; + 
CONVERT(VARCHAR(30),(@OriginalSize*8/1024)) + &apos;MB&apos;
FROM sysfiles
WHERE name = @LogicalFileName
CREATE TABLE DummyTrans
(DummyColumn char (8000) not null)

DECLARE @Counter    INT,
@StartTime DATETIME,
@TruncLog   VARCHAR(255)
SELECT @StartTime = GETDATE(),
@TruncLog = &apos;BACKUP LOG &apos; + db_name() + &apos; WITH TRUNCATE_ONLY&apos;
DBCC SHRINKFILE (@LogicalFileName, @NewSize)
EXEC (@TruncLog)
-- Wrap the log if necessary.
WHILE @MaxMinutes &gt; DATEDIFF (mi, @StartTime, GETDATE()) -- time has not expired
AND @OriginalSize = (SELECT size FROM sysfiles WHERE name = @LogicalFileName)  
AND (@OriginalSize * 8 /1024) &gt; @NewSize  
BEGIN -- Outer loop.
SELECT @Counter = 0
WHILE   ((@Counter &lt; @OriginalSize / 16) AND (@Counter &lt; 50000))
BEGIN -- update
INSERT DummyTrans VALUES (&apos;Fill Log&apos;) DELETE DummyTrans
SELECT @Counter = @Counter + 1
END
EXEC (@TruncLog)  
END
SELECT &apos;Final Size of &apos; + db_name() + &apos; LOG is &apos; +
CONVERT(VARCHAR(30),size) + &apos; 8K pages or &apos; + 
CONVERT(VARCHAR(30),(size*8/1024)) + &apos;MB&apos;
FROM sysfiles 
WHERE name = @LogicalFileName
DROP TABLE DummyTrans
SET NOCOUNT OFF
</code></pre><h2 id="8-æ›´æ”¹æŸä¸ªè¡¨"><a href="#8-æ›´æ”¹æŸä¸ªè¡¨" class="headerlink" title="8. æ›´æ”¹æŸä¸ªè¡¨"></a>8. æ›´æ”¹æŸä¸ªè¡¨</h2><pre><code>exec sp_changeobjectowner &apos;tablename&apos;,&apos;dbo&apos;
</code></pre><h2 id="9-å­˜å‚¨æ›´æ”¹å…¨éƒ¨è¡¨"><a href="#9-å­˜å‚¨æ›´æ”¹å…¨éƒ¨è¡¨" class="headerlink" title="9. å­˜å‚¨æ›´æ”¹å…¨éƒ¨è¡¨"></a>9. å­˜å‚¨æ›´æ”¹å…¨éƒ¨è¡¨</h2><pre><code>CREATE PROCEDURE dbo.User_ChangeObjectOwnerBatch
@OldOwner as NVARCHAR(128),
@NewOwner as NVARCHAR(128)
AS
DECLARE @Name    as NVARCHAR(128)
DECLARE @Owner   as NVARCHAR(128)
DECLARE @OwnerName   as NVARCHAR(128)
DECLARE curObject CURSOR FOR 
select &apos;Name&apos;    = name,
   &apos;Owner&apos;    = user_name(uid)
from sysobjects
where user_name(uid)=@OldOwner
order by name
OPEN   curObject
FETCH NEXT FROM curObject INTO @Name, @Owner
WHILE(@@FETCH_STATUS=0)
BEGIN     
if @Owner=@OldOwner 
begin
   set @OwnerName = @OldOwner + &apos;.&apos; + rtrim(@Name)
   exec sp_changeobjectowner @OwnerName, @NewOwner
end
-- select @name,@NewOwner,@OldOwner
FETCH NEXT FROM curObject INTO @Name, @Owner
END
close curObject
deallocate curObject
GO
</code></pre><h2 id="10-SQL-SERVERä¸­ç›´æ¥å¾ªç¯å†™å…¥æ•°æ®"><a href="#10-SQL-SERVERä¸­ç›´æ¥å¾ªç¯å†™å…¥æ•°æ®" class="headerlink" title="10. SQL SERVERä¸­ç›´æ¥å¾ªç¯å†™å…¥æ•°æ®"></a>10. SQL SERVERä¸­ç›´æ¥å¾ªç¯å†™å…¥æ•°æ®</h2><pre><code>declare @i int
set @i=1
while @i&lt;30
begin
insert into test (userid) values(@i)
set @i=@i+1
end
</code></pre><p>æ¡ˆä¾‹ï¼š<br>æœ‰å¦‚ä¸‹è¡¨ï¼Œè¦æ±‚å°±è¡¨ä¸­æ‰€æœ‰æ²’æœ‰åŠæ ¼çš„æˆç»©ï¼Œåœ¨æ¯æ¬¡å¢é•¿0.1çš„åŸºç¡€ä¸Šï¼Œä½¿ä»–ä»¬åˆšå¥½åŠæ ¼:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th style="text-align:right">score</th>
</tr>
</thead>
<tbody>
<tr>
<td>Zhangshan</td>
<td style="text-align:right">80</td>
</tr>
<tr>
<td>Lishi</td>
<td style="text-align:right">59</td>
</tr>
<tr>
<td>Wangwu</td>
<td style="text-align:right">50</td>
</tr>
<tr>
<td>Songquan</td>
<td style="text-align:right">69</td>
</tr>
</tbody>
</table>
<pre><code>while((select min(score) from tb_table)&lt;60)
begin
update tb_table set score =score*1.01
where score&lt;60
if (select min(score) from tb_table)&gt;60
break
else
continue
end
</code></pre><h2 id="11-æŸ¥çœ‹æ•°æ®åº“å±æ€§"><a href="#11-æŸ¥çœ‹æ•°æ®åº“å±æ€§" class="headerlink" title="11. æŸ¥çœ‹æ•°æ®åº“å±æ€§"></a>11. æŸ¥çœ‹æ•°æ®åº“å±æ€§</h2><pre><code>sp_helpdb æ•°æ®åº“å
</code></pre><h2 id="12-æŒ‰å§“æ°ç¬”ç”»æ’åº"><a href="#12-æŒ‰å§“æ°ç¬”ç”»æ’åº" class="headerlink" title="12. æŒ‰å§“æ°ç¬”ç”»æ’åº:"></a>12. æŒ‰å§“æ°ç¬”ç”»æ’åº:</h2><pre><code>Select * From TableName Order By CustomerName Collate Chinese_PRC_Stroke_ci_as //ä»å°‘åˆ°å¤š
</code></pre><h2 id="13-æ•°æ®åº“åŠ å¯†"><a href="#13-æ•°æ®åº“åŠ å¯†" class="headerlink" title="13. æ•°æ®åº“åŠ å¯†:"></a>13. æ•°æ®åº“åŠ å¯†:</h2><pre><code>select encrypt(&apos;åŸå§‹å¯†ç &apos;)
select pwdencrypt(&apos;åŸå§‹å¯†ç &apos;)
select pwdcompare(&apos;åŸå§‹å¯†ç &apos;,&apos;åŠ å¯†åå¯†ç &apos;) = 1--ç›¸åŒï¼›å¦åˆ™ä¸ç›¸åŒ encrypt(&apos;åŸå§‹å¯†ç &apos;)
select pwdencrypt(&apos;åŸå§‹å¯†ç &apos;)
select pwdcompare(&apos;åŸå§‹å¯†ç &apos;,&apos;åŠ å¯†åå¯†ç &apos;) = 1--ç›¸åŒï¼›å¦åˆ™ä¸ç›¸åŒ
</code></pre><h2 id="14-å–å›è¡¨ä¸­å­—æ®µ"><a href="#14-å–å›è¡¨ä¸­å­—æ®µ" class="headerlink" title="14. å–å›è¡¨ä¸­å­—æ®µ:"></a>14. å–å›è¡¨ä¸­å­—æ®µ:</h2><pre><code>declare @list varchar(1000),
@sql nvarchar(1000) 
select @list=@list+&apos;,&apos;+b.name from sysobjects a,syscolumns b where a.id=b.id and a.name=&apos;è¡¨A&apos;
set @sql=&apos;select &apos;+right(@list,len(@list)-1)+&apos; from è¡¨A&apos; 
exec (@sql)
</code></pre><h2 id="15-æŸ¥çœ‹ç¡¬ç›˜åˆ†åŒº"><a href="#15-æŸ¥çœ‹ç¡¬ç›˜åˆ†åŒº" class="headerlink" title="15. æŸ¥çœ‹ç¡¬ç›˜åˆ†åŒº:"></a>15. æŸ¥çœ‹ç¡¬ç›˜åˆ†åŒº:</h2><pre><code>EXEC master..xp_fixeddrives
</code></pre><h2 id="16-æ¯”è¾ƒA-Bè¡¨æ˜¯å¦ç›¸ç­‰"><a href="#16-æ¯”è¾ƒA-Bè¡¨æ˜¯å¦ç›¸ç­‰" class="headerlink" title="16. æ¯”è¾ƒA,Bè¡¨æ˜¯å¦ç›¸ç­‰:"></a>16. æ¯”è¾ƒA,Bè¡¨æ˜¯å¦ç›¸ç­‰:</h2><pre><code>if (select checksum_agg(binary_checksum(*)) from A)
     =
    (select checksum_agg(binary_checksum(*)) from B)
print &apos;ç›¸ç­‰&apos;
else
print &apos;ä¸ç›¸ç­‰&apos;
</code></pre><h2 id="17-æ€æ‰æ‰€æœ‰çš„äº‹ä»¶æ¢å¯Ÿå™¨è¿›ç¨‹"><a href="#17-æ€æ‰æ‰€æœ‰çš„äº‹ä»¶æ¢å¯Ÿå™¨è¿›ç¨‹" class="headerlink" title="17. æ€æ‰æ‰€æœ‰çš„äº‹ä»¶æ¢å¯Ÿå™¨è¿›ç¨‹:"></a>17. æ€æ‰æ‰€æœ‰çš„äº‹ä»¶æ¢å¯Ÿå™¨è¿›ç¨‹:</h2><pre><code>DECLARE hcforeach CURSOR GLOBAL FOR SELECT &apos;kill &apos;+RTRIM(spid) FROM master.dbo.sysprocesses
WHERE program_name IN(&apos;SQL profiler&apos;,N&apos;SQL äº‹ä»¶æ¢æŸ¥å™¨&apos;)
EXEC sp_msforeach_worker &apos;?&apos;
</code></pre><h2 id="18-è®°å½•æœç´¢"><a href="#18-è®°å½•æœç´¢" class="headerlink" title="18. è®°å½•æœç´¢:"></a>18. è®°å½•æœç´¢:</h2><p>å¼€å¤´åˆ°Næ¡è®°å½•</p>
<pre><code>Select Top N * From è¡¨
</code></pre><p>Nåˆ°Mæ¡è®°å½•(è¦æœ‰ä¸»ç´¢å¼•ID)</p>
<pre><code>Select Top M-N * From è¡¨ Where ID in (Select Top M ID From è¡¨) Order by ID   Desc
</code></pre><p>Nåˆ°ç»“å°¾è®°å½•</p>
<pre><code>Select Top N * From è¡¨ Order by ID Desc
</code></pre><h2 id="19-è·å–å½“å‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰ç”¨æˆ·è¡¨"><a href="#19-è·å–å½“å‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰ç”¨æˆ·è¡¨" class="headerlink" title="19. è·å–å½“å‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰ç”¨æˆ·è¡¨"></a>19. è·å–å½“å‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰ç”¨æˆ·è¡¨</h2><pre><code>select Name from sysobjects where xtype=&apos;u&apos; and status&gt;=0
</code></pre><h2 id="20-è·å–æŸä¸€ä¸ªè¡¨çš„æ‰€æœ‰å­—æ®µ"><a href="#20-è·å–æŸä¸€ä¸ªè¡¨çš„æ‰€æœ‰å­—æ®µ" class="headerlink" title="20. è·å–æŸä¸€ä¸ªè¡¨çš„æ‰€æœ‰å­—æ®µ"></a>20. è·å–æŸä¸€ä¸ªè¡¨çš„æ‰€æœ‰å­—æ®µ</h2><pre><code>select name from syscolumns where id=object_id(&apos;è¡¨å&apos;)
select name from syscolumns where id in (select id from sysobjects where type = &apos;u&apos; and name = &apos;è¡¨å&apos;)
</code></pre><p>ä¸¤ç§æ–¹å¼çš„æ•ˆæœç›¸åŒ</p>
<h2 id="21-æŸ¥çœ‹ä¸æŸä¸€ä¸ªè¡¨ç›¸å…³çš„è§†å›¾ã€å­˜å‚¨è¿‡ç¨‹ã€å‡½æ•°"><a href="#21-æŸ¥çœ‹ä¸æŸä¸€ä¸ªè¡¨ç›¸å…³çš„è§†å›¾ã€å­˜å‚¨è¿‡ç¨‹ã€å‡½æ•°" class="headerlink" title="21. æŸ¥çœ‹ä¸æŸä¸€ä¸ªè¡¨ç›¸å…³çš„è§†å›¾ã€å­˜å‚¨è¿‡ç¨‹ã€å‡½æ•°"></a>21. æŸ¥çœ‹ä¸æŸä¸€ä¸ªè¡¨ç›¸å…³çš„è§†å›¾ã€å­˜å‚¨è¿‡ç¨‹ã€å‡½æ•°</h2><pre><code>select a.* from sysobjects a, syscomments b where a.id = b.id and b.text like &apos;%è¡¨å%&apos;
</code></pre><h2 id="22-æŸ¥çœ‹å½“å‰æ•°æ®åº“ä¸­æ‰€æœ‰å­˜å‚¨è¿‡ç¨‹"><a href="#22-æŸ¥çœ‹å½“å‰æ•°æ®åº“ä¸­æ‰€æœ‰å­˜å‚¨è¿‡ç¨‹" class="headerlink" title="22. æŸ¥çœ‹å½“å‰æ•°æ®åº“ä¸­æ‰€æœ‰å­˜å‚¨è¿‡ç¨‹"></a>22. æŸ¥çœ‹å½“å‰æ•°æ®åº“ä¸­æ‰€æœ‰å­˜å‚¨è¿‡ç¨‹</h2><pre><code>select name as å­˜å‚¨è¿‡ç¨‹åç§° from sysobjects where xtype=&apos;P&apos;
</code></pre><h2 id="23-æŸ¥è¯¢ç”¨æˆ·åˆ›å»ºçš„æ‰€æœ‰æ•°æ®åº“"><a href="#23-æŸ¥è¯¢ç”¨æˆ·åˆ›å»ºçš„æ‰€æœ‰æ•°æ®åº“" class="headerlink" title="23. æŸ¥è¯¢ç”¨æˆ·åˆ›å»ºçš„æ‰€æœ‰æ•°æ®åº“"></a>23. æŸ¥è¯¢ç”¨æˆ·åˆ›å»ºçš„æ‰€æœ‰æ•°æ®åº“</h2><pre><code>select * from master..sysdatabases D where sid not in(select sid from master..syslogins where name=&apos;sa&apos;)
</code></pre><p>æˆ–è€…</p>
<pre><code>select dbid, name AS DB_NAME from master..sysdatabases where sid &lt;&gt; 0x01
</code></pre><h2 id="24-æŸ¥è¯¢æŸä¸€ä¸ªè¡¨çš„å­—æ®µå’Œæ•°æ®ç±»å‹"><a href="#24-æŸ¥è¯¢æŸä¸€ä¸ªè¡¨çš„å­—æ®µå’Œæ•°æ®ç±»å‹" class="headerlink" title="24. æŸ¥è¯¢æŸä¸€ä¸ªè¡¨çš„å­—æ®µå’Œæ•°æ®ç±»å‹"></a>24. æŸ¥è¯¢æŸä¸€ä¸ªè¡¨çš„å­—æ®µå’Œæ•°æ®ç±»å‹</h2><pre><code>select column_name,data_type from information_schema.columns
where table_name = &apos;è¡¨å&apos;
</code></pre><h2 id="25-ä¸åŒæœåŠ¡å™¨æ•°æ®åº“ä¹‹é—´çš„æ•°æ®æ“ä½œ"><a href="#25-ä¸åŒæœåŠ¡å™¨æ•°æ®åº“ä¹‹é—´çš„æ•°æ®æ“ä½œ" class="headerlink" title="25. ä¸åŒæœåŠ¡å™¨æ•°æ®åº“ä¹‹é—´çš„æ•°æ®æ“ä½œ"></a>25. ä¸åŒæœåŠ¡å™¨æ•°æ®åº“ä¹‹é—´çš„æ•°æ®æ“ä½œ</h2><p>åˆ›å»ºé“¾æ¥æœåŠ¡å™¨</p>
<pre><code>exec sp_addlinkedserver &apos;ITSV &apos;, &apos; &apos;, &apos;SQLOLEDB &apos;, &apos;è¿œç¨‹æœåŠ¡å™¨åæˆ–ipåœ°å€ &apos;
exec sp_addlinkedsrvlogin &apos;ITSV &apos;, &apos;false &apos;,null, &apos;ç”¨æˆ·å &apos;, &apos;å¯†ç  &apos;
</code></pre><p>æŸ¥è¯¢ç¤ºä¾‹</p>
<pre><code>select * from ITSV.æ•°æ®åº“å.dbo.è¡¨å
</code></pre><p>å¯¼å…¥ç¤ºä¾‹</p>
<pre><code>select * into è¡¨ from ITSV.æ•°æ®åº“å.dbo.è¡¨å
</code></pre><p>ä»¥åä¸å†ä½¿ç”¨æ—¶åˆ é™¤é“¾æ¥æœåŠ¡å™¨</p>
<pre><code>exec sp_dropserver &apos;ITSV &apos;, &apos;droplogins &apos;
</code></pre><p>è¿æ¥è¿œç¨‹/å±€åŸŸç½‘æ•°æ®(openrowset/openquery/opendatasource)</p>
<ul>
<li><ol>
<li>openrowset<br>æŸ¥è¯¢ç¤ºä¾‹</li>
</ol>
</li>
</ul>
<pre><code>select * from openrowset( &apos;SQLOLEDB &apos;, &apos;sqlæœåŠ¡å™¨å &apos;; &apos;ç”¨æˆ·å &apos;; &apos;å¯†ç  &apos;,æ•°æ®åº“å.dbo.è¡¨å)
</code></pre><p>ç”Ÿæˆæœ¬åœ°è¡¨</p>
<pre><code>select * into è¡¨ from openrowset( &apos;SQLOLEDB &apos;, &apos;sqlæœåŠ¡å™¨å &apos;; &apos;ç”¨æˆ·å &apos;; &apos;å¯†ç  &apos;,æ•°æ®åº“å.dbo.è¡¨å)
</code></pre><p>æŠŠæœ¬åœ°è¡¨å¯¼å…¥è¿œç¨‹è¡¨</p>
<pre><code>insert openrowset( &apos;SQLOLEDB &apos;, &apos;sqlæœåŠ¡å™¨å &apos;; &apos;ç”¨æˆ·å &apos;; &apos;å¯†ç  &apos;,æ•°æ®åº“å.dbo.è¡¨å)
select *from æœ¬åœ°è¡¨
</code></pre><p>æ›´æ–°æœ¬åœ°è¡¨</p>
<pre><code>update b
set b.åˆ—A=a.åˆ—A
from openrowset( &apos;SQLOLEDB &apos;, &apos;sqlæœåŠ¡å™¨å &apos;; &apos;ç”¨æˆ·å &apos;; &apos;å¯†ç  &apos;,æ•°æ®åº“å.dbo.è¡¨å)as a inner join æœ¬åœ°è¡¨ b    on a.column1=b.column1
</code></pre><ul>
<li><ol>
<li>openqueryç”¨æ³•éœ€è¦åˆ›å»ºä¸€ä¸ªè¿æ¥<br>é¦–å…ˆåˆ›å»ºä¸€ä¸ªè¿æ¥åˆ›å»ºé“¾æ¥æœåŠ¡å™¨</li>
</ol>
</li>
</ul>
<pre><code>exec sp_addlinkedserver &apos;ITSV &apos;, &apos; &apos;, &apos;SQLOLEDB &apos;, &apos;è¿œç¨‹æœåŠ¡å™¨åæˆ–ipåœ°å€ &apos;
</code></pre><p>æŸ¥è¯¢</p>
<pre><code>select *
FROM openquery(ITSV, &apos;SELECT * FROM æ•°æ®åº“.dbo.è¡¨å &apos;)
</code></pre><p>æŠŠæœ¬åœ°è¡¨å¯¼å…¥è¿œç¨‹è¡¨</p>
<pre><code>insert openquery(ITSV, &apos;SELECT * FROM æ•°æ®åº“.dbo.è¡¨å &apos;)
select * from æœ¬åœ°è¡¨
</code></pre><p>æ›´æ–°æœ¬åœ°è¡¨</p>
<pre><code>update b
set b.åˆ—B=a.åˆ—B
FROM openquery(ITSV, &apos;SELECT * FROM æ•°æ®åº“.dbo.è¡¨å &apos;) as a
inner join æœ¬åœ°è¡¨ b on a.åˆ—A=b.åˆ—A
</code></pre><ul>
<li><ol>
<li>opendatasource/openrowset</li>
</ol>
</li>
</ul>
<pre><code>SELECT *
FROM opendatasource( &apos;SQLOLEDB &apos;, &apos;Data Source=ip/ServerName;User ID=ç™»é™†å;Password=å¯†ç  &apos; ).test.dbo.roy_ta
</code></pre><p>æŠŠæœ¬åœ°è¡¨å¯¼å…¥è¿œç¨‹è¡¨</p>
<pre><code>insert opendatasource( &apos;SQLOLEDB &apos;, &apos;Data Source=ip/ServerName;User ID=ç™»é™†å;Password=å¯†ç  &apos;).æ•°æ®åº“.dbo.è¡¨å
select * from æœ¬åœ°è¡¨
</code></pre><h2 id="26-åˆ é™¤æ•°æ®åº“ä¸‹é¢çš„æ‰€æœ‰è¡¨"><a href="#26-åˆ é™¤æ•°æ®åº“ä¸‹é¢çš„æ‰€æœ‰è¡¨" class="headerlink" title="26. åˆ é™¤æ•°æ®åº“ä¸‹é¢çš„æ‰€æœ‰è¡¨"></a>26. åˆ é™¤æ•°æ®åº“ä¸‹é¢çš„æ‰€æœ‰è¡¨</h2><pre><code>use æ•°æ®åº“å(æ˜¯è¦åˆ é™¤è¡¨çš„æ‰€åœ¨çš„é‚£ä¸ªæ•°æ®åº“çš„åç§°)
GO
declare @sql varchar(8000)
while (select count(*) from sysobjects where type=&apos;U&apos;)&gt;0
begin
SELECT @sql=&apos;drop table &apos; + name
FROM sysobjects
WHERE (type = &apos;U&apos;)
ORDER BY &apos;drop table &apos; + name
exec(@sql) 
end
</code></pre><h2 id="27-æŸ¥çœ‹æ•°æ®åº“æ–‡ä»¶ä½¿ç”¨æƒ…å†µ"><a href="#27-æŸ¥çœ‹æ•°æ®åº“æ–‡ä»¶ä½¿ç”¨æƒ…å†µ" class="headerlink" title="27. æŸ¥çœ‹æ•°æ®åº“æ–‡ä»¶ä½¿ç”¨æƒ…å†µ"></a>27. æŸ¥çœ‹æ•°æ®åº“æ–‡ä»¶ä½¿ç”¨æƒ…å†µ</h2><pre><code>SELECT  A.name                                                     AS &quot;é€»è¾‘åç§°&quot;
       ,CONVERT(FLOAT ,A.size)             * (8192.0/1024.0)/1024  AS &quot;å·²ç”¨å¤§å°MB&quot;
       ,CONVERT(FLOAT ,A.maxSize - A.size) * (8192.0/1024.0)/1024  AS &quot;å¯ç”¨å¤§å°MB&quot;
       ,CONVERT(FLOAT ,A.maxSize)          * (8192.0/1024.0)/1024  AS &quot;åˆ†é…å¤§å°MB&quot;
       ,A.fileName                                                 AS &quot;æ–‡ä»¶è·¯å¾„&quot;
       ,(
         SELECT  SA.groupName
           FROM  SysFileGroups  SA
          WHERE  SA.groupID = A.groupID
        )                                                          AS &quot;æ–‡ä»¶ç»„&quot;
       ,CASE WHEN A.status = 1081346 THEN &apos;ç£ç›˜æ–‡ä»¶&apos;               
             WHEN A.status = 1081410 THEN &apos;æ—¥å¿—è®¾å¤‡&apos;
             ELSE CONVERT(VARCHAR ,A.status) END                   AS &quot;æ–‡ä»¶ç±»å‹&quot;
  FROM  SysFiles  A
</code></pre><h2 id="28-ä¿®æ”¹saçš„å¯†ç "><a href="#28-ä¿®æ”¹saçš„å¯†ç " class="headerlink" title="28. ä¿®æ”¹saçš„å¯†ç "></a>28. ä¿®æ”¹saçš„å¯†ç </h2><pre><code>EXEC sp_password NULL,NULL,&apos;sa&apos;;
</code></pre><hr>
<h1 id="å¸¸è¯†"><a href="#å¸¸è¯†" class="headerlink" title="å¸¸è¯†"></a>å¸¸è¯†</h1><ul>
<li>åœ¨SQLæŸ¥è¯¢ä¸­ï¼Œfromåæœ€å¤šå¯ä»¥è·Ÿ256å¼ è¡¨æˆ–è§†å›¾</li>
<li>åœ¨SQLè¯­å¥ä¸­å‡ºç° Order byï¼ŒæŸ¥è¯¢æ—¶ï¼Œå…ˆæ’åºï¼Œåå–å€¼</li>
<li>åœ¨SQLä¸­ï¼Œä¸€ä¸ªå­—æ®µçš„æœ€å¤§å®¹é‡æ˜¯8000</li>
</ul>

        </div>
        <div class="post-tool">
            <a class="btn-thumbs-up" href="javascript:void(0);" data-cid="52" title="95">
                <i class="fa fa-thumbs-up" aria-hidden="true"></i> Donate
            </a>
        </div>
        
        <div class="post-tags">Tagsï¼š
            
            <a href="/tags/SQL/">SQL</a>
            
            <a href="/tags/ç»å…¸è¯­å¥/">ç»å…¸è¯­å¥</a>
            
        </div>
        
    </article>
    
    <p style="text-align: center">This article just represents my own viewpoint. If there is something wrong, please correct me.</p>
    
    

    

</div>
<script src="/js/busuanzi.pure.mini.js"></script>


        </div><!-- end #main-->
    </div><!-- end #body -->
    <footer class="footer">
    <div class="footer-inner" style="text-align: center">
        <p>
            <a href="/about" title="About">About</a>&nbsp;&nbsp<em>Â·</em>&nbsp;&nbsp
            <!-- è‡ªå®šä¹‰é“¾æ¥ -->
            <a href="/help" title="Help">Help</a>&nbsp;&nbsp<em>Â·</em>&nbsp;&nbsp
            <a href="/links" title="Links">Links</a>&nbsp;&nbsp<em>Â·</em>&nbsp;&nbsp
            <a href="/sitemap.xml" title="SiteMap">SiteMap</a>
        </p>
        <p>
            Has been established&nbsp<a href="/timeline" id="siteBuildingTime"></a>&nbspDaysï¼Œ<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="licence">Based on Attribution-NonCommercial-ShareAlike 4.0 International (CC BY-NC-SA 4.0)</a><br>
            Â©2017-<span id="cpYear"></span> Based on&nbsp<a href="http://hexo.io" target="_blank" rel="nofollow">Hexo</a>
            ï¼ŒTheme by&nbsp&nbsp<a href="https://github.com/tangkunyin/hexo-theme-jsimple" target="_blank" rel="bookmark">JSimple</a>
            ï¼ŒAuthor&nbsp<a href="https://shuoit.net" target="_blank" rel="friend">çº ç»“ä¼¦</a>
            ï¼ŒHosted by <a href="https://pages.github.com/" target="_blank" rel="nofollow">GitHub Pages</a>
        </p>
    </div>
</footer>
<script src="/js/SimpleCore.js"></script>

</div>
<!-- search pop -->
<div class="popup search-popup local-search-popup">
    <div class="local-search-header clearfix">
        <span class="search-icon">
            <i class="fa fa-search"></i>
        </span>
        <span class="popup-btn-close">
            <i class="fa fa-times-circle"></i>
        </span>
        <div class="local-search-input-wrapper">
            <input id="local-search-input" spellcheck="false" type="text" autocomplete="off" placeholder="Input query keywords here...">
        </div>
    </div>
    <div id="local-search-result"></div>
</div>
<div class="fixed-btn">
    <a class="btn-gotop" href="javascript:"> <i class="fa fa-angle-up"></i></a>
</div>
<script>
    $(function () {
        var jsi_config = {
            buildingTime: '01/20/2018',
            current: $('.post-tags').length > 0 ? 'post' : 'archive',
            snsQRCode: '/images/sns-qrcode.png',
            donateImg: '/images/donate-qr.png',
            localSearch: { dbPath: '' },
            readMode: 'day'
        };
        
        SimpleCore.init(jsi_config);
        
    });
</script>
</body>
</html>
