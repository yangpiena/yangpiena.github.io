<!DOCTYPE HTML>
<html class="no-js" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
    <!--[if lte IE 9]>
<meta http-equiv="refresh" content="0;url=http://yangpiena.coding.me/warn.html">
<![endif]-->
<meta charset="utf-8">
<meta http-equiv="X-DNS-Prefetch-Control" content="on">
<link rel="dns-prefetch" href="http://yangpiena.coding.me">
<link rel="dns-prefetch" href="//www.google-analytics.com">
<link rel="prefetch" href="http://yangpiena.coding.me">
<link rel="prefetch" href="//www.google-analytics.com">


<link rel="prerender" href="http://yangpiena.coding.me">

<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<meta name="renderer" content="webkit">
<meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=no">
<meta http-equiv="mobile-agent" content="format=html5; url=http://yangpiena.coding.me">
<meta name="author" content="昜丿捺">
<link rel="stylesheet" href="/css/JSimple.css">

<link rel="shortcut icon" href="/img/avatar/favicon.ico">


<title>sql经典语句 - 昜丿捺</title>

<meta name="keywords" content="undefined">

<meta name="description " content="没有阳光，沉默而居">

    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                processEscapes: true
            }
        });
    </script>


<!-- YPN Add 2019-03-25 增加相册所需js -->
<script type="text/javascript" src="/js/jquery-1.11.3.min.js"></script>
    

    

</head>
<body>
<div id="nav">
    <nav class="nav-menu">
        <a class="site-name current" href="/" title="昜">昜</a>
        <a class="site-index current" href="/"><i class="fa fa-home"></i><span>首页</span></a>
        <a href="/archives" title="归档"><i class="fa fa-archives"></i><span>归档</span></a>
        <a href="/tags" title="标签"><i class="fa fa-tags"></i><span>标签</span></a>
        <!-- custom single page of menus -->
        
        
        <a href="/links" title="收藏">
            <i class="fa fa-star"></i>
            <span>收藏</span>
        </a>
        
        
        <a href="/photos" title="相册">
            <i class="fa fa-camera"></i>
            <span>相册</span>
        </a>
        
    </nav>
</div>

<div class="nav-user">
    <a class="btn-search" href="#"><i class="fa fa-search"></i></a>
    <a class="btn-read-mode" href="#"><i class="fa fa-sun-o"></i></a>
	<!-- YPN Del 2019-03-22 -->
    <!-- <a class="btn-sns-qr" href="javascript:"><i class="fa fa-telegram"></i></a> -->
</div>

<div id="wrapper" class="clearfix">
    <div id="body">
        <div class="main" id="main">
            <div id="cover">
    <div class="cover-img"></div>
    <div class="cover-info">
        
        <h1 class="cover-siteName">昜丿捺</h1>
        <h3 class="cover-siteTitle">个人博客</h3>
        <p class="cover-siteDesc">没有阳光，沉默而居</p>
        <div class="cover-sns">
            
    &nbsp;&nbsp;<div class="btn btn-github">
        <a href="https://github.com/yangpiena" target="_blank" title="github" ref="friend">
            <i class="fa fa-github"></i>
        </a>
    </div>

    &nbsp;&nbsp;<div class="btn btn-github-alt">
        <a href="https://coding.net/u/yangpiena" target="_blank" title="github-alt" ref="friend">
            <i class="fa fa-github-alt"></i>
        </a>
    </div>

    &nbsp;&nbsp;<div class="btn btn-weibo">
        <a href="http://weibo.com/yangpiena" target="_blank" title="weibo" ref="friend">
            <i class="fa fa-weibo"></i>
        </a>
    </div>

    &nbsp;&nbsp;<div class="btn btn-envelope">
        <a href="yangpiena@163.com" target="_blank" title="envelope" ref="friend">
            <i class="fa fa-envelope"></i>
        </a>
    </div>


        </div>
    </div>
</div>

            <div class="page-title">
    <ul>
        <li><a href="/">最近</a></li>
        
            
        
        <li class="page-search">
    <form id="search" class="search-form">
        <input type="text" readonly="readonly" id="local-search-input-tip" placeholder="点击或按F键搜索">
        <button type="button" disabled="disabled" class="search-form-submit"><i class="fa fa-search"></i></button>
    </form>
</li>

    </ul>
</div>
<div class="main-inner">
    <article class="post" itemscope="" itemtype="http://schema.org/BlogPosting">
        <div class="post-header">
            <h2 class="post-title" style="text-align: center">SQL经典语句</h2>
			<div class="post-meta" style="text-align: center">
				<i class="fa fa-calendar-o"></i>&nbsp;
				<span title="最后编辑于&nbsp;2016-11-29">2016-11-29</span>
				<!-- YPN Edit 2019-03-25 -->
				<!-- 您是第&nbsp;<span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span>位看到它们的小伙伴 -->
				&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-eye"></i>&nbsp;
				<span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span>&nbsp;
			</div>
        </div>
        <div class="post-content markdown-body">
            <h1 id="一-基础篇"><a href="#一-基础篇" class="headerlink" title="一. 基础篇"></a>一. 基础篇</h1><h2 id="1-创建数据库"><a href="#1-创建数据库" class="headerlink" title="1. 创建数据库"></a>1. 创建数据库</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> <span class="keyword">database</span>-<span class="keyword">name</span></span><br></pre></td></tr></table></figure>
<h2 id="2-删除数据库"><a href="#2-删除数据库" class="headerlink" title="2. 删除数据库"></a>2. 删除数据库</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">database</span> dbname</span><br></pre></td></tr></table></figure>
<h2 id="3-备份sql-server"><a href="#3-备份sql-server" class="headerlink" title="3. 备份sql server"></a>3. 备份sql server</h2><p>创建 备份数据的 device<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> <span class="keyword">master</span></span><br><span class="line">EXEC sp_addumpdevice <span class="string">'disk'</span>, <span class="string">'testBack'</span>, <span class="string">'c:\mssql7backup\MyNwind_1.dat'</span></span><br></pre></td></tr></table></figure></p>
<p>开始 备份<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BACKUP</span> <span class="keyword">DATABASE</span> pubs <span class="keyword">TO</span> testBack</span><br></pre></td></tr></table></figure></p>
<a id="more"></a>
<h2 id="4-创建新表"><a href="#4-创建新表" class="headerlink" title="4. 创建新表"></a>4. 创建新表</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tabname(col1 type1 [<span class="keyword">not</span> <span class="literal">null</span>] [primary <span class="keyword">key</span>],col2 type2 [<span class="keyword">not</span> <span class="literal">null</span>],..)</span><br></pre></td></tr></table></figure>
<p>根据已有的表创建新表：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tab_new <span class="keyword">like</span> tab_old (使用旧表创建新表)</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tab_new <span class="keyword">as</span> <span class="keyword">select</span> col1,col2… <span class="keyword">from</span> tab_old definition <span class="keyword">only</span></span><br></pre></td></tr></table></figure></p>
<h2 id="5-删除新表"><a href="#5-删除新表" class="headerlink" title="5. 删除新表"></a>5. 删除新表</h2><pre><code>drop table tabname
</code></pre><h2 id="6-增加一个列"><a href="#6-增加一个列" class="headerlink" title="6. 增加一个列"></a>6. 增加一个列</h2><pre><code>Alter table tabname add column col type
</code></pre><blockquote>
<p>注：列增加后将不能删除。DB2中列加上后数据类型也不能改变，唯一能改变的是增加varchar类型的长度。</p>
</blockquote>
<h2 id="7-添加主键"><a href="#7-添加主键" class="headerlink" title="7. 添加主键"></a>7. 添加主键</h2><pre><code>ALTER TABLE tabname ADD PRIMARY KEY (col)
</code></pre><p>删除主键</p>
<pre><code>ALTER TABLE tabname DROP PRIMARY KEY (col)
</code></pre><h2 id="8-创建索引"><a href="#8-创建索引" class="headerlink" title="8. 创建索引"></a>8. 创建索引</h2><pre><code>create [unique] index idxname on tabname(col….) 
</code></pre><p>删除索引</p>
<pre><code>drop index idxname
</code></pre><blockquote>
<p>注：索引是不可更改的，想更改必须删除重新建。</p>
</blockquote>
<h2 id="9-创建视图"><a href="#9-创建视图" class="headerlink" title="9. 创建视图"></a>9. 创建视图</h2><pre><code>create view viewname as select statement 
</code></pre><p>删除视图</p>
<pre><code>drop view viewname
</code></pre><h2 id="10-几个简单的基本sql语句"><a href="#10-几个简单的基本sql语句" class="headerlink" title="10. 几个简单的基本sql语句"></a>10. 几个简单的基本sql语句</h2><p>选择</p>
<pre><code>select * from table1 where 范围
</code></pre><p>插入</p>
<pre><code>insert into table1(field1,field2) values(value1,value2)
</code></pre><p>删除</p>
<pre><code>delete from table1 where 范围
</code></pre><p>更新</p>
<pre><code>update table1 set field1=value1 where 范围
</code></pre><p>查找</p>
<pre><code>select * from table1 where field1 like ’%value1%’
</code></pre><p>排序</p>
<pre><code>select * from table1 order by field1,field2 [desc]
</code></pre><p>总数</p>
<pre><code>select count as totalcount from table1
</code></pre><p>求和</p>
<pre><code>select sum(field1) as sumvalue from table1
</code></pre><p>平均</p>
<pre><code>select avg(field1) as avgvalue from table1
</code></pre><p>最大</p>
<pre><code>select max(field1) as maxvalue from table1
</code></pre><p>最小</p>
<pre><code>select min(field1) as minvalue from table1
</code></pre><h2 id="11-几个高级查询运算词"><a href="#11-几个高级查询运算词" class="headerlink" title="11. 几个高级查询运算词"></a>11. 几个高级查询运算词</h2><ul>
<li>A： UNION 运算符<br>UNION 运算符通过组合其他两个结果表（例如 TABLE1 和 TABLE2）并消去表中任何重复行而派生出一个结果表。当 ALL 随 UNION一起使用时（即 UNION ALL），不消除重复行。两种情况下，派生表的每一行不是来自 TABLE1 就是来自 TABLE2。 </li>
<li>B： EXCEPT 运算符<br>EXCEPT 运算符通过包括所有在 TABLE1 中但不在 TABLE2 中的行并消除所有重复行而派生出一个结果表。当 ALL 随 EXCEPT 一起使用时 (EXCEPT ALL)，不消除重复行。 </li>
<li>C： INTERSECT 运算符<br>INTERSECT 运算符通过只包括 TABLE1 和 TABLE2 中都有的行并消除所有重复行而派生出一个结果表。当 ALL 随 INTERSECT 一起使用时 (INTERSECT ALL)，不消除重复行。 <blockquote>
<p>注：使用运算词的几个查询结果行必须是一致的。</p>
</blockquote>
</li>
</ul>
<h2 id="12-使用外连接"><a href="#12-使用外连接" class="headerlink" title="12. 使用外连接"></a>12. 使用外连接</h2><ul>
<li>A. left （outer） join：<br>左外连接（左连接）：结果集几包括连接表的匹配行，也包括左连接表的所有行。 </li>
</ul>
<pre><code>select a.a, a.b, a.c, b.c, b.d, b.f from a LEFT OUT JOIN b ON a.a = b.c
</code></pre><ul>
<li>B：right （outer） join:<br>右外连接(右连接)：结果集既包括连接表的匹配连接行，也包括右连接表的所有行。 </li>
<li>C：full/cross （outer） join：<br>全外连接：不仅包括符号连接表的匹配行，还包括两个连接表中的所有记录。</li>
</ul>
<h2 id="13-分组-Group-by"><a href="#13-分组-Group-by" class="headerlink" title="13. 分组:Group by"></a>13. 分组:Group by</h2><p>一张表，一旦分组 完成后，查询后只能得到组相关的信息。<br>组相关的信息：（统计信息） count,sum,max,min,avg 分组的标准)<br>在SQLServer中分组时：不能以text,ntext,image类型的字段作为分组依据<br>在selecte统计函数中的字段，不能和普通的字段放在一起；</p>
<h2 id="14-对数据库进行操作"><a href="#14-对数据库进行操作" class="headerlink" title="14. 对数据库进行操作"></a>14. 对数据库进行操作</h2><p>分离数据库： sp_detach_db; 附加数据库：sp_attach_db 后接表明，附加需要完整的路径名</p>
<h2 id="15-如何修改数据库的名称"><a href="#15-如何修改数据库的名称" class="headerlink" title="15. 如何修改数据库的名称"></a>15. 如何修改数据库的名称</h2><p>sp_renamedb ‘old_name’, ‘new_name’</p>
<h2 id="16-查询字段ID最大值的记录"><a href="#16-查询字段ID最大值的记录" class="headerlink" title="16. 查询字段ID最大值的记录"></a>16. 查询字段ID最大值的记录</h2><p>无索引</p>
<pre><code>select time from table t1 where not exists (select 1 from table where id &gt; t1.id) 
</code></pre><p>有索引</p>
<pre><code>select time from table where id in (select max(id) from table)
</code></pre><h2 id="17-查询某一列的重复项内容"><a href="#17-查询某一列的重复项内容" class="headerlink" title="17. 查询某一列的重复项内容"></a>17. 查询某一列的重复项内容</h2><pre><code>SELECT * FROM documentation AS A WHERE (SELECT COUNT(*) FROM documentation WHERE fileName=A.fileName)&gt;1 
</code></pre><h2 id="18-判断表中是否存在记录"><a href="#18-判断表中是否存在记录" class="headerlink" title="18. 判断表中是否存在记录"></a>18. 判断表中是否存在记录</h2><pre><code>SELECT COUNT (*) FROM tableName WHERE conditions
</code></pre><hr>
<h1 id="二-提升篇"><a href="#二-提升篇" class="headerlink" title="二. 提升篇"></a>二. 提升篇</h1><h2 id="1-复制表-只复制结构-源表名：a-新表名：b-Access可用"><a href="#1-复制表-只复制结构-源表名：a-新表名：b-Access可用" class="headerlink" title="1. 复制表(只复制结构,源表名：a 新表名：b) (Access可用)"></a>1. 复制表(只复制结构,源表名：a 新表名：b) (Access可用)</h2><p>法一</p>
<pre><code>select * into b from a where 1&lt;&gt;1（仅用于SQlServer）
</code></pre><p>法二</p>
<pre><code>select top 0 * into b from a
</code></pre><h2 id="2-拷贝表-拷贝数据-源表名：a-目标表名：b-Access可用"><a href="#2-拷贝表-拷贝数据-源表名：a-目标表名：b-Access可用" class="headerlink" title="2. 拷贝表(拷贝数据,源表名：a 目标表名：b) (Access可用)"></a>2. 拷贝表(拷贝数据,源表名：a 目标表名：b) (Access可用)</h2><pre><code>insert into b(a, b, c) select d,e,f from b;
</code></pre><h2 id="3-跨数据库之间表的拷贝-具体数据使用绝对路径-Access可用"><a href="#3-跨数据库之间表的拷贝-具体数据使用绝对路径-Access可用" class="headerlink" title="3. 跨数据库之间表的拷贝(具体数据使用绝对路径) (Access可用)"></a>3. 跨数据库之间表的拷贝(具体数据使用绝对路径) (Access可用)</h2><pre><code>insert into b(a, b, c) select d,e,f from b in ‘具体数据库’ where 条件
</code></pre><p>例子：..from b in ‘“&amp;Server.MapPath(“.”)&amp;”\data.mdb” &amp;”‘ where..</p>
<h2 id="4-子查询-表名1：a-表名2：b"><a href="#4-子查询-表名1：a-表名2：b" class="headerlink" title="4. 子查询(表名1：a 表名2：b)"></a>4. 子查询(表名1：a 表名2：b)</h2><pre><code>select a,b,c from a where a IN (select d from b ) 或者: select a,b,c from a where a IN (1,2,3)
</code></pre><h2 id="5-显示文章、提交人和最后回复时间"><a href="#5-显示文章、提交人和最后回复时间" class="headerlink" title="5. 显示文章、提交人和最后回复时间"></a>5. 显示文章、提交人和最后回复时间</h2><pre><code>select a.title,a.username,b.adddate from table a,(select max(adddate) adddate from table where table.title=a.title) b
</code></pre><h2 id="6-外连接查询-表名1：a-表名2：b"><a href="#6-外连接查询-表名1：a-表名2：b" class="headerlink" title="6. 外连接查询(表名1：a 表名2：b)"></a>6. 外连接查询(表名1：a 表名2：b)</h2><pre><code>select a.a, a.b, a.c, b.c, b.d, b.f from a LEFT OUT JOIN b ON a.a = b.c
</code></pre><h2 id="7-在线视图查询-表名1：a"><a href="#7-在线视图查询-表名1：a" class="headerlink" title="7. 在线视图查询(表名1：a )"></a>7. 在线视图查询(表名1：a )</h2><pre><code>select * from (SELECT a,b,c FROM a) T where t.a &gt; 1;
</code></pre><h2 id="8-between的用法-between限制查询数据范围时包括了边界值-not-between不包括"><a href="#8-between的用法-between限制查询数据范围时包括了边界值-not-between不包括" class="headerlink" title="8. between的用法,between限制查询数据范围时包括了边界值,not between不包括"></a>8. between的用法,between限制查询数据范围时包括了边界值,not between不包括</h2><pre><code>select * from table1 where time between time1 and time2
select a,b,c, from table1 where a not between 数值1 and 数值2
</code></pre><h2 id="9-in-的使用方法"><a href="#9-in-的使用方法" class="headerlink" title="9. in 的使用方法"></a>9. in 的使用方法</h2><pre><code>select * from table1 where a [not] in (‘值1’,’值2’,’值4’,’值6’)
</code></pre><h2 id="10-两张关联表，删除主表中已经在副表中没有的信息"><a href="#10-两张关联表，删除主表中已经在副表中没有的信息" class="headerlink" title="10. 两张关联表，删除主表中已经在副表中没有的信息"></a>10. 两张关联表，删除主表中已经在副表中没有的信息</h2><pre><code>delete from table1 where not exists ( select * from table2 where table1.field1=table2.field1 )
</code></pre><h2 id="11-四表联查问题"><a href="#11-四表联查问题" class="headerlink" title="11. 四表联查问题"></a>11. 四表联查问题</h2><pre><code>select * from a left inner join b on a.a=b.b right inner join c on a.a=c.c inner join d on a.a=d.d where .....
</code></pre><h2 id="12-日程安排提前五分钟提醒"><a href="#12-日程安排提前五分钟提醒" class="headerlink" title="12. 日程安排提前五分钟提醒"></a>12. 日程安排提前五分钟提醒</h2><pre><code>select * from 日程安排 where datediff(&apos;minute&apos;,f开始时间,getdate())&gt;5
</code></pre><h2 id="13-一条sql语句搞定数据库分页"><a href="#13-一条sql语句搞定数据库分页" class="headerlink" title="13. 一条sql语句搞定数据库分页"></a>13. 一条sql语句搞定数据库分页</h2><pre><code>select top 10 b.* from (select top 20 主键字段,排序字段 from 表名 order by 排序字段 desc) a,表名 b where b.主键字段 = a.主键字段 order by a.排序字段
</code></pre><p>关于数据库分页：</p>
<pre><code>declare @start int,@end int
@sql nvarchar(600)
set @sql=’select top’+str(@end-@start+1)+’+from T where rid not in(select top’+str(@str-1)+’Rid from T where Rid&gt;-1)’
exec sp_executesql @sql
</code></pre><blockquote>
<p>注意：在top后不能直接跟一个变量，所以在实际应用中只有这样的进行特殊的处理。Rid为一个标识列，如果top后还有具体的字段，这样做是非常有好处的。因为这样可以避免 top的字段如果是逻辑索引的，查询的结果后实际表中的不一致（逻辑索引中的数据有可能和数据表中的不一致，而查询时如果处在索引则首先查询索引）</p>
</blockquote>
<h2 id="14-前10条记录"><a href="#14-前10条记录" class="headerlink" title="14. 前10条记录"></a>14. 前10条记录</h2><pre><code>select top 10 * form table1 where 范围
</code></pre><h2 id="15-选择在每一组b值相同的数据中对应的a最大的记录的所有信息-类似这样的用法可以用于论坛每月排行榜-每月热销产品分析-按科目成绩排名-等等"><a href="#15-选择在每一组b值相同的数据中对应的a最大的记录的所有信息-类似这样的用法可以用于论坛每月排行榜-每月热销产品分析-按科目成绩排名-等等" class="headerlink" title="15. 选择在每一组b值相同的数据中对应的a最大的记录的所有信息(类似这样的用法可以用于论坛每月排行榜,每月热销产品分析,按科目成绩排名,等等.)"></a>15. 选择在每一组b值相同的数据中对应的a最大的记录的所有信息(类似这样的用法可以用于论坛每月排行榜,每月热销产品分析,按科目成绩排名,等等.)</h2><pre><code>select a,b,c from tablename ta where a=(select max(a) from tablename tb where tb.b=ta.b)
</code></pre><h2 id="16-包括所有在-TableA-中但不在-TableB和TableC-中的行并消除所有重复行而派生出一个结果表"><a href="#16-包括所有在-TableA-中但不在-TableB和TableC-中的行并消除所有重复行而派生出一个结果表" class="headerlink" title="16. 包括所有在 TableA 中但不在 TableB和TableC 中的行并消除所有重复行而派生出一个结果表"></a>16. 包括所有在 TableA 中但不在 TableB和TableC 中的行并消除所有重复行而派生出一个结果表</h2><pre><code>(select a from tableA ) except (select a from tableB) except (select a from tableC)
</code></pre><h2 id="17-随机取出10条数据"><a href="#17-随机取出10条数据" class="headerlink" title="17. 随机取出10条数据"></a>17. 随机取出10条数据</h2><pre><code>select top 10 * from tablename order by newid()
</code></pre><h2 id="18-随机选择记录"><a href="#18-随机选择记录" class="headerlink" title="18. 随机选择记录"></a>18. 随机选择记录</h2><pre><code>select newid()
</code></pre><h2 id="19-删除重复记录"><a href="#19-删除重复记录" class="headerlink" title="19. 删除重复记录"></a>19. 删除重复记录</h2><ul>
<li>方法一：</li>
</ul>
<pre><code>delete from tablename where id not in (select max(id) from tablename group by col1,col2,...)
</code></pre><ul>
<li>方法二：</li>
</ul>
<pre><code>select distinct * into temp from tablename
delete from tablename
insert into tablename select * from temp
</code></pre><blockquote>
<p>评价： 这种操作牵连大量的数据的移动，这种做法不适合大容量的数据操作</p>
</blockquote>
<ul>
<li>方法三： 例如：在一个外部表中导入数据，由于某些原因第一次只导入了一部分，但很难判断具体位置，这样只有在下一次全部导入，这样也就产生好多重复的字段，怎样删除重复字段</li>
</ul>
<pre><code>alter table tablename
add column_b int identity(1,1)    --添加一个自增列
delete from tablename where column_b not in(
select max(column_b) from tablename group by column1,column2,...)
alter table tablename drop column column_b
</code></pre><h2 id="20-列出数据库里所有的表名"><a href="#20-列出数据库里所有的表名" class="headerlink" title="20. 列出数据库里所有的表名"></a>20. 列出数据库里所有的表名</h2><pre><code>select name from sysobjects where type=&apos;U&apos; // U代表用户
</code></pre><h2 id="21-列出表里的所有的列名"><a href="#21-列出表里的所有的列名" class="headerlink" title="21. 列出表里的所有的列名"></a>21. 列出表里的所有的列名</h2><pre><code>select name from syscolumns where id=object_id(&apos;TableName&apos;)
</code></pre><h2 id="22-列示type、vender、pcs字段，以type字段排列，case可以方便地实现多重选择，类似select-中的case。"><a href="#22-列示type、vender、pcs字段，以type字段排列，case可以方便地实现多重选择，类似select-中的case。" class="headerlink" title="22. 列示type、vender、pcs字段，以type字段排列，case可以方便地实现多重选择，类似select 中的case。"></a>22. 列示type、vender、pcs字段，以type字段排列，case可以方便地实现多重选择，类似select 中的case。</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">type</span>,<span class="keyword">sum</span>(<span class="keyword">case</span> vender <span class="keyword">when</span> <span class="string">'A'</span> <span class="keyword">then</span> pcs <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>),<span class="keyword">sum</span>(<span class="keyword">case</span> vender <span class="keyword">when</span> <span class="string">'C'</span> <span class="keyword">then</span> pcs <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>),<span class="keyword">sum</span>(<span class="keyword">case</span> vender <span class="keyword">when</span> <span class="string">'B'</span> <span class="keyword">then</span> pcs <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>) <span class="keyword">FROM</span> tablename <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">type</span></span><br></pre></td></tr></table></figure>
<p>显示结果：</p>
<table>
<thead>
<tr>
<th>type</th>
<th>vender</th>
<th>pcs</th>
</tr>
</thead>
<tbody>
<tr>
<td>电脑</td>
<td>A</td>
<td>1</td>
</tr>
<tr>
<td>电脑</td>
<td>A</td>
<td>1</td>
</tr>
<tr>
<td>光盘</td>
<td>B</td>
<td>2</td>
</tr>
<tr>
<td>光盘</td>
<td>A</td>
<td>2</td>
</tr>
<tr>
<td>手机</td>
<td>B</td>
<td>3</td>
</tr>
<tr>
<td>手机</td>
<td>C</td>
<td>3</td>
</tr>
</tbody>
</table>
<h2 id="23-初始化表"><a href="#23-初始化表" class="headerlink" title="23. 初始化表"></a>23. 初始化表</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> table1</span><br></pre></td></tr></table></figure>
<h2 id="24-选择从10到15的记录"><a href="#24-选择从10到15的记录" class="headerlink" title="24. 选择从10到15的记录"></a>24. 选择从10到15的记录</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> top <span class="number">5</span> * <span class="keyword">from</span> (<span class="keyword">select</span> top <span class="number">15</span> * <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">id</span> <span class="keyword">asc</span>) table_别名 <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">id</span> <span class="keyword">desc</span></span><br></pre></td></tr></table></figure>
<h2 id="25-临时表"><a href="#25-临时表" class="headerlink" title="25. 临时表"></a>25. 临时表</h2><h4 id="创建临时表"><a href="#创建临时表" class="headerlink" title="创建临时表"></a>创建临时表</h4><ul>
<li><p>方法一：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> #临时表名(字段<span class="number">1</span> 约束条件,</span><br><span class="line">                       字段<span class="number">2</span> 约束条件,</span><br><span class="line">                      .....)</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> ##临时表名(字段<span class="number">1</span> 约束条件,</span><br><span class="line">                        字段<span class="number">2</span> 约束条件,</span><br><span class="line">                        .....)</span><br></pre></td></tr></table></figure>
<p>  例：</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> #Tmp <span class="comment">--创建临时表#Tmp</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">ID</span>   <span class="built_in">int</span> <span class="keyword">IDENTITY</span> (<span class="number">1</span>,<span class="number">1</span>)     <span class="keyword">not</span> <span class="literal">null</span>, <span class="comment">--创建列ID,并且每次新增一条记录就会加1</span></span><br><span class="line">    WokNo                <span class="built_in">varchar</span>(<span class="number">50</span>),   </span><br><span class="line">    primary <span class="keyword">key</span> (<span class="keyword">ID</span>)      <span class="comment">--定义ID为临时表#Tmp的主键      </span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li><p>方法二：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">into</span> #临时表名 <span class="keyword">from</span> 你的表;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">into</span> ##临时表名 <span class="keyword">from</span> 你的表;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>注：以上的#代表局部临时表，##代表全局临时表</p>
</blockquote>
<h4 id="查询临时表"><a href="#查询临时表" class="headerlink" title="查询临时表"></a>查询临时表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> #临时表名;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> ##临时表名;</span><br></pre></td></tr></table></figure>
<h4 id="删除临时表"><a href="#删除临时表" class="headerlink" title="删除临时表"></a>删除临时表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> #临时表名;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> ##临时表名;</span><br></pre></td></tr></table></figure>
<h2 id="26-关联表更新"><a href="#26-关联表更新" class="headerlink" title="26. 关联表更新"></a>26. 关联表更新</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> A <span class="keyword">SET</span> A.b=B.d <span class="keyword">FROM</span> tableA A <span class="keyword">INNER</span> <span class="keyword">JOIN</span> tableB B <span class="keyword">ON</span> A.a = B.a</span><br></pre></td></tr></table></figure>
<h2 id="27-查看表的所有外键关系"><a href="#27-查看表的所有外键关系" class="headerlink" title="27. 查看表的所有外键关系"></a>27. 查看表的所有外键关系</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> t1.*,t2.name,t3.name <span class="keyword">from</span> dbo.sysforeignkeys t1 <span class="keyword">left</span> <span class="keyword">join</span> sysobjects t2 <span class="keyword">on</span> t1.fkeyid=t2.id </span><br><span class="line">           <span class="keyword">left</span> <span class="keyword">join</span> sysobjects t3 <span class="keyword">on</span> t1.rkeyid=t3.id <span class="keyword">where</span> t3.name=<span class="string">'表名 '</span></span><br></pre></td></tr></table></figure>
<h2 id="28-删除所有约束"><a href="#28-删除所有约束" class="headerlink" title="28. 删除所有约束"></a>28. 删除所有约束</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> c1 <span class="keyword">cursor</span> <span class="keyword">for</span></span><br><span class="line">    <span class="keyword">select</span> <span class="string">'alter table ['</span>+ object_name(parent_obj) + <span class="string">'] drop constraint ['</span>+<span class="keyword">name</span>+<span class="string">']; '</span></span><br><span class="line">    <span class="keyword">from</span> sysobjects</span><br><span class="line">    <span class="keyword">where</span> xtype = <span class="string">'F'</span></span><br><span class="line"><span class="keyword">open</span> c1</span><br><span class="line"><span class="keyword">declare</span> @c1 <span class="built_in">varchar</span>(<span class="number">8000</span>)</span><br><span class="line"><span class="keyword">fetch</span> <span class="keyword">next</span> <span class="keyword">from</span> c1 <span class="keyword">into</span> @c1</span><br><span class="line"><span class="keyword">while</span>(@@fetch_status=<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        exec(@c1)</span><br><span class="line">        <span class="keyword">fetch</span> <span class="keyword">next</span> <span class="keyword">from</span> c1 <span class="keyword">into</span> @c1</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">close</span> c1</span><br><span class="line"><span class="keyword">deallocate</span> c1</span><br></pre></td></tr></table></figure>
<h2 id="29-删除数据库所有表"><a href="#29-删除数据库所有表" class="headerlink" title="29. 删除数据库所有表"></a>29. 删除数据库所有表</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> @tname <span class="built_in">varchar</span>(<span class="number">8000</span>)</span><br><span class="line"><span class="keyword">set</span> @tname=<span class="string">''</span></span><br><span class="line"><span class="keyword">select</span> @tname=@tname + <span class="keyword">Name</span> + <span class="string">','</span> <span class="keyword">from</span> sysobjects <span class="keyword">where</span> xtype=<span class="string">'U'</span></span><br><span class="line"><span class="keyword">select</span> @tname=<span class="string">'drop table '</span> + <span class="keyword">left</span>(@tname,<span class="keyword">len</span>(@tname)<span class="number">-1</span>)</span><br><span class="line">exec(@tname)</span><br></pre></td></tr></table></figure>
<h2 id="30-删除外键约束"><a href="#30-删除外键约束" class="headerlink" title="30. 删除外键约束"></a>30. 删除外键约束</h2><p>得到某个表被哪些外键引用，并且显示出外键表的表名<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    fk.name,</span><br><span class="line">    fk.object_id,</span><br><span class="line">    OBJECT_NAME(fk.parent_object_id) <span class="keyword">AS</span> referenceTableName</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    sys.foreign_keys <span class="keyword">AS</span> fk</span><br><span class="line"><span class="keyword">JOIN</span> sys.objects <span class="keyword">AS</span> o <span class="keyword">ON</span> fk.referenced_object_id = o.object_id</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">    o.name = <span class="string">'ATTACHMENTDOC'</span>;</span><br></pre></td></tr></table></figure></p>
<p>通过外键表的表名和外键名称执行以下语句即可删除外键<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> dbo.CONTRACTINFO <span class="keyword">DROP</span> <span class="keyword">CONSTRAINT</span> FK_CONTRACTINFO_ATTACHMENTDOC</span><br></pre></td></tr></table></figure></p>
<h2 id="31-查找指定数据库表的列名、数据类型、数据长度、注释"><a href="#31-查找指定数据库表的列名、数据类型、数据长度、注释" class="headerlink" title="31. 查找指定数据库表的列名、数据类型、数据长度、注释"></a>31. 查找指定数据库表的列名、数据类型、数据长度、注释</h2><p>SQL SERVER 2000<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">SELECT</span> sysobjects.name <span class="keyword">AS</span> 表名, syscolumns.name <span class="keyword">AS</span> 列名, systypes.name <span class="keyword">AS</span> 数据类型, syscolumns.length <span class="keyword">AS</span> 数据长度, sysproperties.[<span class="keyword">value</span>] <span class="keyword">AS</span> 注释</span><br><span class="line">      <span class="keyword">FROM</span> sysproperties</span><br><span class="line"><span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> sysobjects</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> syscolumns <span class="keyword">ON</span> sysobjects.id    = syscolumns.id</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> systypes   <span class="keyword">ON</span> syscolumns.xtype = systypes.xtype </span><br><span class="line">                      <span class="keyword">ON</span> sysproperties.id = syscolumns.id <span class="keyword">AND</span> sysproperties.smallid = syscolumns.colid</span><br><span class="line">     <span class="keyword">WHERE</span> (sysobjects.xtype = <span class="string">'u'</span> <span class="keyword">OR</span> sysobjects.xtype = <span class="string">'v'</span>)</span><br><span class="line">       <span class="keyword">AND</span> (systypes.name &lt;&gt; <span class="string">'sysname'</span>)</span><br><span class="line">       <span class="keyword">AND</span> sysproperties.[<span class="keyword">value</span>] <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="comment">--查询注释不为 NULL 的记录</span></span><br><span class="line">       <span class="keyword">AND</span> (sysobjects.name = <span class="string">'指定数据库表'</span>)</span><br><span class="line">  <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">1</span>, <span class="number">2</span>;</span><br></pre></td></tr></table></figure></p>
<p>SQL SERVER 2005及以上<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">SELECT</span> ta.name <span class="keyword">AS</span> 表名, c.name <span class="keyword">AS</span> 列名, t.name <span class="keyword">AS</span> 数据类型, c.max_length <span class="keyword">AS</span> 数据长度, ex.[<span class="keyword">value</span>] <span class="keyword">AS</span> 注释</span><br><span class="line">      <span class="keyword">FROM</span> sys.columns               <span class="keyword">AS</span> c</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> sys.tables                <span class="keyword">AS</span> ta <span class="keyword">ON</span> c.object_id = ta.object_id</span><br><span class="line"> <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> sys.extended_properties   <span class="keyword">AS</span> ex <span class="keyword">ON</span> ex.major_id = c.object_id <span class="keyword">AND</span> ex.minor_id = c.column_id</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> (<span class="keyword">SELECT</span> <span class="keyword">name</span>, system_type_id</span><br><span class="line">              <span class="keyword">FROM</span> sys.types</span><br><span class="line">             <span class="keyword">WHERE</span> <span class="keyword">name</span> &lt;&gt; <span class="string">'sysname'</span>) <span class="keyword">AS</span> t <span class="keyword">ON</span> c.system_type_id = t.system_type_id</span><br><span class="line">     <span class="keyword">WHERE</span> ta.name = <span class="string">'指定数据库表'</span></span><br><span class="line">       <span class="keyword">AND</span> ex.[<span class="keyword">value</span>] <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br><span class="line">  <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">1</span>, <span class="number">2</span>;</span><br></pre></td></tr></table></figure></p>
<h2 id="32-同步表数据"><a href="#32-同步表数据" class="headerlink" title="32. 同步表数据"></a>32. 同步表数据</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> 表<span class="number">2</span> </span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> 表<span class="number">1</span> <span class="keyword">AS</span> a <span class="keyword">WHERE</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>(<span class="keyword">SELECT</span> <span class="number">1</span> <span class="keyword">FROM</span> 表<span class="number">2</span> <span class="keyword">WHERE</span> <span class="keyword">ID</span> = a.ID);</span><br></pre></td></tr></table></figure>
<h2 id="33-判断某列中是否包含中文字符或者英文字符"><a href="#33-判断某列中是否包含中文字符或者英文字符" class="headerlink" title="33. 判断某列中是否包含中文字符或者英文字符"></a>33. 判断某列中是否包含中文字符或者英文字符</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> 表名 <span class="keyword">WHERE</span> 某列 <span class="keyword">LIKE</span> <span class="string">'%[吖-座]%'</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> 表名 <span class="keyword">WHERE</span> 某列 <span class="keyword">LIKE</span> <span class="string">'%[a-z]%'</span></span><br></pre></td></tr></table></figure>
<h2 id="34-行转列，将多行数据合并成一行（SQL-SERVER-2005以上支持）"><a href="#34-行转列，将多行数据合并成一行（SQL-SERVER-2005以上支持）" class="headerlink" title="34. 行转列，将多行数据合并成一行（SQL SERVER 2005以上支持）"></a>34. 行转列，将多行数据合并成一行（SQL SERVER 2005以上支持）</h2><p>例如，表Table1中有两列数据：</p>
<table>
<thead>
<tr>
<th>code</th>
<th>name</th>
</tr>
</thead>
<tbody>
<tr>
<td>AAA</td>
<td>姓名1</td>
</tr>
<tr>
<td>AAA</td>
<td>姓名2</td>
</tr>
<tr>
<td>AAA</td>
<td>姓名3</td>
</tr>
<tr>
<td>BBB</td>
<td>姓名4</td>
</tr>
<tr>
<td>BBB</td>
<td>姓名5</td>
</tr>
</tbody>
</table>
<p>行转列，想变成如下格式：</p>
<table>
<thead>
<tr>
<th>code</th>
<th>name</th>
</tr>
</thead>
<tbody>
<tr>
<td>AAA</td>
<td>姓名1,姓名2,姓名3</td>
</tr>
<tr>
<td>BBB</td>
<td>姓名4,姓名5</td>
</tr>
</tbody>
</table>
<p>可用如下SQL实现：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">SELECT</span> code, <span class="keyword">name</span> = (<span class="keyword">STUFF</span>((<span class="keyword">SELECT</span> <span class="string">','</span> + <span class="keyword">name</span> </span><br><span class="line">                                <span class="keyword">FROM</span> Table1 </span><br><span class="line">                               <span class="keyword">WHERE</span> code = a.code <span class="keyword">FOR</span> <span class="keyword">xml</span> <span class="keyword">PATH</span>(<span class="string">''</span>)),<span class="number">1</span>,<span class="number">1</span>,<span class="string">''</span>))</span><br><span class="line">    <span class="keyword">FROM</span> Table1 a </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> code</span><br></pre></td></tr></table></figure></p>
<h2 id="35-去除字段中空格、换行符、回车符"><a href="#35-去除字段中空格、换行符、回车符" class="headerlink" title="35. 去除字段中空格、换行符、回车符"></a>35. 去除字段中空格、换行符、回车符</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> xx_sjb <span class="keyword">SET</span> sl = <span class="keyword">LTRIM</span>(<span class="keyword">RTRIM</span>(<span class="keyword">REPLACE</span>(<span class="keyword">REPLACE</span>(sl, <span class="built_in">CHAR</span>(<span class="number">10</span>), <span class="string">''</span>), <span class="built_in">CHAR</span> (<span class="number">13</span>), <span class="string">''</span>)))</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="三-技巧篇"><a href="#三-技巧篇" class="headerlink" title="三. 技巧篇"></a>三. 技巧篇</h1><h2 id="1-1-1，1-2的使用，在SQL语句组合时用的较多"><a href="#1-1-1，1-2的使用，在SQL语句组合时用的较多" class="headerlink" title="1. 1=1，1=2的使用，在SQL语句组合时用的较多"></a>1. 1=1，1=2的使用，在SQL语句组合时用的较多</h2><pre><code>“where 1=1” 表示选择全部
“where 1=2” 表示全部不选
</code></pre><h2 id="2-收缩数据库"><a href="#2-收缩数据库" class="headerlink" title="2. 收缩数据库"></a>2. 收缩数据库</h2><ul>
<li><p>重建索引</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DBCC REINDEX</span><br><span class="line">DBCC INDEXDEFRAG</span><br></pre></td></tr></table></figure>
</li>
<li><p>收缩数据和日志</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DBCC SHRINKDB</span><br><span class="line">DBCC SHRINKFILE</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="3-压缩数据库"><a href="#3-压缩数据库" class="headerlink" title="3. 压缩数据库"></a>3. 压缩数据库</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dbcc shrinkdatabase(dbname)</span><br></pre></td></tr></table></figure>
<h2 id="4-转移数据库给新用户以已存在用户权限"><a href="#4-转移数据库给新用户以已存在用户权限" class="headerlink" title="4. 转移数据库给新用户以已存在用户权限"></a>4. 转移数据库给新用户以已存在用户权限</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exec sp_change_users_login 'update_one','newname','oldname'</span><br><span class="line">go</span><br></pre></td></tr></table></figure>
<h2 id="5-检查备份集"><a href="#5-检查备份集" class="headerlink" title="5. 检查备份集"></a>5. 检查备份集</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RESTORE</span> VERIFYONLY <span class="keyword">from</span> disk=<span class="string">'E:\dvbbs.bak'</span></span><br></pre></td></tr></table></figure>
<h2 id="6-修复数据库"><a href="#6-修复数据库" class="headerlink" title="6. 修复数据库"></a>6. 修复数据库</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> [dvbbs] <span class="keyword">SET</span> SINGLE_USER</span><br><span class="line"><span class="keyword">GO</span></span><br><span class="line">DBCC CHECKDB(<span class="string">'dvbbs'</span>,repair_allow_data_loss) <span class="keyword">WITH</span> TABLOCK</span><br><span class="line"><span class="keyword">GO</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> [dvbbs] <span class="keyword">SET</span> MULTI_USER</span><br><span class="line"><span class="keyword">GO</span></span><br></pre></td></tr></table></figure>
<h2 id="7-日志清除"><a href="#7-日志清除" class="headerlink" title="7. 日志清除"></a>7. 日志清除</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> NOCOUNT <span class="keyword">ON</span></span><br><span class="line"><span class="keyword">DECLARE</span> @LogicalFileName sysname,</span><br><span class="line">@MaxMinutes <span class="built_in">INT</span>,</span><br><span class="line">@NewSize <span class="built_in">INT</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">USE</span> tablename <span class="comment">-- 要操作的数据库名</span></span><br><span class="line"><span class="keyword">SELECT</span>  @LogicalFileName = <span class="string">'tablename_log'</span>, <span class="comment">-- 日志文件名</span></span><br><span class="line">@MaxMinutes = <span class="number">10</span>, <span class="comment">-- Limit on time allowed to wrap log.</span></span><br><span class="line">@NewSize = <span class="number">1</span>  <span class="comment">-- 你想设定的日志文件的大小(M)</span></span><br><span class="line">Setup / initialize</span><br><span class="line"><span class="keyword">DECLARE</span> @OriginalSize <span class="built_in">int</span></span><br><span class="line"><span class="keyword">SELECT</span> @OriginalSize = <span class="keyword">size</span> </span><br><span class="line"><span class="keyword">FROM</span> sysfiles</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">name</span> = @LogicalFileName</span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">'Original Size of '</span> + db_name() + <span class="string">' LOG is '</span> + </span><br><span class="line"><span class="keyword">CONVERT</span>(<span class="built_in">VARCHAR</span>(<span class="number">30</span>),@OriginalSize) + <span class="string">' 8K pages or '</span> + </span><br><span class="line"><span class="keyword">CONVERT</span>(<span class="built_in">VARCHAR</span>(<span class="number">30</span>),(@OriginalSize*<span class="number">8</span>/<span class="number">1024</span>)) + <span class="string">'MB'</span></span><br><span class="line"><span class="keyword">FROM</span> sysfiles</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">name</span> = @LogicalFileName</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> DummyTrans</span><br><span class="line">(DummyColumn <span class="built_in">char</span> (<span class="number">8000</span>) <span class="keyword">not</span> <span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">DECLARE</span> @Counter    <span class="built_in">INT</span>,</span><br><span class="line">@StartTime DATETIME,</span><br><span class="line">@TruncLog   <span class="built_in">VARCHAR</span>(<span class="number">255</span>)</span><br><span class="line"><span class="keyword">SELECT</span> @StartTime = <span class="keyword">GETDATE</span>(),</span><br><span class="line">@TruncLog = <span class="string">'BACKUP LOG '</span> + db_name() + <span class="string">' WITH TRUNCATE_ONLY'</span></span><br><span class="line">DBCC SHRINKFILE (@LogicalFileName, @NewSize)</span><br><span class="line">EXEC (@TruncLog)</span><br><span class="line"><span class="comment">-- Wrap the log if necessary.</span></span><br><span class="line"><span class="keyword">WHILE</span> @MaxMinutes &gt; <span class="keyword">DATEDIFF</span> (mi, @StartTime, <span class="keyword">GETDATE</span>()) <span class="comment">-- time has not expired</span></span><br><span class="line"><span class="keyword">AND</span> @OriginalSize = (<span class="keyword">SELECT</span> <span class="keyword">size</span> <span class="keyword">FROM</span> sysfiles <span class="keyword">WHERE</span> <span class="keyword">name</span> = @LogicalFileName)  </span><br><span class="line"><span class="keyword">AND</span> (@OriginalSize * <span class="number">8</span> /<span class="number">1024</span>) &gt; @NewSize  </span><br><span class="line"><span class="keyword">BEGIN</span> <span class="comment">-- Outer loop.</span></span><br><span class="line"><span class="keyword">SELECT</span> @Counter = <span class="number">0</span></span><br><span class="line"><span class="keyword">WHILE</span>   ((@Counter &lt; @OriginalSize / <span class="number">16</span>) <span class="keyword">AND</span> (@Counter &lt; <span class="number">50000</span>))</span><br><span class="line"><span class="keyword">BEGIN</span> <span class="comment">-- update</span></span><br><span class="line"><span class="keyword">INSERT</span> DummyTrans <span class="keyword">VALUES</span> (<span class="string">'Fill Log'</span>) <span class="keyword">DELETE</span> DummyTrans</span><br><span class="line"><span class="keyword">SELECT</span> @Counter = @Counter + <span class="number">1</span></span><br><span class="line"><span class="keyword">END</span></span><br><span class="line">EXEC (@TruncLog)  </span><br><span class="line"><span class="keyword">END</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">'Final Size of '</span> + db_name() + <span class="string">' LOG is '</span> +</span><br><span class="line"><span class="keyword">CONVERT</span>(<span class="built_in">VARCHAR</span>(<span class="number">30</span>),<span class="keyword">size</span>) + <span class="string">' 8K pages or '</span> + </span><br><span class="line"><span class="keyword">CONVERT</span>(<span class="built_in">VARCHAR</span>(<span class="number">30</span>),(<span class="keyword">size</span>*<span class="number">8</span>/<span class="number">1024</span>)) + <span class="string">'MB'</span></span><br><span class="line"><span class="keyword">FROM</span> sysfiles </span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">name</span> = @LogicalFileName</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> DummyTrans</span><br><span class="line"><span class="keyword">SET</span> NOCOUNT <span class="keyword">OFF</span></span><br></pre></td></tr></table></figure>
<h2 id="8-更改某个表"><a href="#8-更改某个表" class="headerlink" title="8. 更改某个表"></a>8. 更改某个表</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exec sp_changeobjectowner 'tablename','dbo'</span><br></pre></td></tr></table></figure>
<h2 id="9-存储更改全部表"><a href="#9-存储更改全部表" class="headerlink" title="9. 存储更改全部表"></a>9. 存储更改全部表</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> dbo.User_ChangeObjectOwnerBatch</span><br><span class="line">@OldOwner <span class="keyword">as</span> <span class="keyword">NVARCHAR</span>(<span class="number">128</span>),</span><br><span class="line">@NewOwner <span class="keyword">as</span> <span class="keyword">NVARCHAR</span>(<span class="number">128</span>)</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">DECLARE</span> @<span class="keyword">Name</span>    <span class="keyword">as</span> <span class="keyword">NVARCHAR</span>(<span class="number">128</span>)</span><br><span class="line"><span class="keyword">DECLARE</span> @Owner   <span class="keyword">as</span> <span class="keyword">NVARCHAR</span>(<span class="number">128</span>)</span><br><span class="line"><span class="keyword">DECLARE</span> @OwnerName   <span class="keyword">as</span> <span class="keyword">NVARCHAR</span>(<span class="number">128</span>)</span><br><span class="line"><span class="keyword">DECLARE</span> curObject <span class="keyword">CURSOR</span> <span class="keyword">FOR</span> </span><br><span class="line"><span class="keyword">select</span> <span class="string">'Name'</span>    = <span class="keyword">name</span>,</span><br><span class="line">   <span class="string">'Owner'</span>    = user_name(uid)</span><br><span class="line"><span class="keyword">from</span> sysobjects</span><br><span class="line"><span class="keyword">where</span> user_name(uid)=@OldOwner</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">name</span></span><br><span class="line"><span class="keyword">OPEN</span>   curObject</span><br><span class="line"><span class="keyword">FETCH</span> <span class="keyword">NEXT</span> <span class="keyword">FROM</span> curObject <span class="keyword">INTO</span> @<span class="keyword">Name</span>, @Owner</span><br><span class="line"><span class="keyword">WHILE</span>(@@FETCH_STATUS=<span class="number">0</span>)</span><br><span class="line"><span class="keyword">BEGIN</span>     </span><br><span class="line"><span class="keyword">if</span> @Owner=@OldOwner </span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">   <span class="keyword">set</span> @OwnerName = @OldOwner + <span class="string">'.'</span> + <span class="keyword">rtrim</span>(@<span class="keyword">Name</span>)</span><br><span class="line">   exec sp_changeobjectowner @OwnerName, @NewOwner</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- select @name,@NewOwner,@OldOwner</span></span><br><span class="line"><span class="keyword">FETCH</span> <span class="keyword">NEXT</span> <span class="keyword">FROM</span> curObject <span class="keyword">INTO</span> @<span class="keyword">Name</span>, @Owner</span><br><span class="line"><span class="keyword">END</span></span><br><span class="line"><span class="keyword">close</span> curObject</span><br><span class="line"><span class="keyword">deallocate</span> curObject</span><br><span class="line"><span class="keyword">GO</span></span><br></pre></td></tr></table></figure>
<h2 id="10-SQL-SERVER中直接循环写入数据"><a href="#10-SQL-SERVER中直接循环写入数据" class="headerlink" title="10. SQL SERVER中直接循环写入数据"></a>10. SQL SERVER中直接循环写入数据</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> @i <span class="built_in">int</span></span><br><span class="line"><span class="keyword">set</span> @i=<span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> @i&lt;<span class="number">30</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">test</span> (userid) <span class="keyword">values</span>(@i)</span><br><span class="line"><span class="keyword">set</span> @i=@i+<span class="number">1</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>案例：有如下表，要求就表中所有沒有及格的成绩，在每次增长0.1的基础上，使他们刚好及格:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th style="text-align:right">score</th>
</tr>
</thead>
<tbody>
<tr>
<td>Zhangshan</td>
<td style="text-align:right">80</td>
</tr>
<tr>
<td>Lishi</td>
<td style="text-align:right">59</td>
</tr>
<tr>
<td>Wangwu</td>
<td style="text-align:right">50</td>
</tr>
<tr>
<td>Songquan</td>
<td style="text-align:right">69</td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">while((<span class="keyword">select</span> <span class="keyword">min</span>(score) <span class="keyword">from</span> tb_table)&lt;<span class="number">60</span>)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">update</span> tb_table <span class="keyword">set</span> score =score*<span class="number">1.01</span></span><br><span class="line"><span class="keyword">where</span> score&lt;<span class="number">60</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">select</span> <span class="keyword">min</span>(score) <span class="keyword">from</span> tb_table)&gt;<span class="number">60</span></span><br><span class="line">break</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">continue</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h2 id="11-查看数据库属性"><a href="#11-查看数据库属性" class="headerlink" title="11. 查看数据库属性"></a>11. 查看数据库属性</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sp_helpdb 数据库名</span><br></pre></td></tr></table></figure>
<h2 id="12-按姓氏笔画排序"><a href="#12-按姓氏笔画排序" class="headerlink" title="12. 按姓氏笔画排序:"></a>12. 按姓氏笔画排序:</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> * <span class="keyword">From</span> TableName <span class="keyword">Order</span> <span class="keyword">By</span> CustomerName <span class="keyword">Collate</span> Chinese_PRC_Stroke_ci_as //从少到多</span><br></pre></td></tr></table></figure>
<h2 id="13-数据库加密"><a href="#13-数据库加密" class="headerlink" title="13. 数据库加密:"></a>13. 数据库加密:</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">encrypt</span>(<span class="string">'原始密码'</span>)</span><br><span class="line"><span class="keyword">select</span> pwdencrypt(<span class="string">'原始密码'</span>)</span><br><span class="line"><span class="keyword">select</span> pwdcompare(<span class="string">'原始密码'</span>,<span class="string">'加密后密码'</span>) = <span class="number">1</span><span class="comment">--相同；否则不相同 encrypt('原始密码')</span></span><br><span class="line"><span class="keyword">select</span> pwdencrypt(<span class="string">'原始密码'</span>)</span><br><span class="line"><span class="keyword">select</span> pwdcompare(<span class="string">'原始密码'</span>,<span class="string">'加密后密码'</span>) = <span class="number">1</span><span class="comment">--相同；否则不相同</span></span><br></pre></td></tr></table></figure>
<h2 id="14-取回表中字段"><a href="#14-取回表中字段" class="headerlink" title="14. 取回表中字段:"></a>14. 取回表中字段:</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> @<span class="keyword">list</span> <span class="built_in">varchar</span>(<span class="number">1000</span>),</span><br><span class="line">@<span class="keyword">sql</span> <span class="keyword">nvarchar</span>(<span class="number">1000</span>) </span><br><span class="line"><span class="keyword">select</span> @<span class="keyword">list</span>=@<span class="keyword">list</span>+<span class="string">','</span>+b.name <span class="keyword">from</span> sysobjects a,syscolumns b <span class="keyword">where</span> a.id=b.id <span class="keyword">and</span> a.name=<span class="string">'表A'</span></span><br><span class="line"><span class="keyword">set</span> @<span class="keyword">sql</span>=<span class="string">'select '</span>+<span class="keyword">right</span>(@<span class="keyword">list</span>,<span class="keyword">len</span>(@<span class="keyword">list</span>)<span class="number">-1</span>)+<span class="string">' from 表A'</span> </span><br><span class="line">exec (@<span class="keyword">sql</span>)</span><br></pre></td></tr></table></figure>
<h2 id="15-查看硬盘分区"><a href="#15-查看硬盘分区" class="headerlink" title="15. 查看硬盘分区:"></a>15. 查看硬盘分区:</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXEC master..xp_fixeddrives</span><br></pre></td></tr></table></figure>
<h2 id="16-比较A-B表是否相等"><a href="#16-比较A-B表是否相等" class="headerlink" title="16. 比较A,B表是否相等:"></a>16. 比较A,B表是否相等:</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">if (<span class="keyword">select</span> <span class="keyword">checksum_agg</span>(binary_checksum(*)) <span class="keyword">from</span> A)</span><br><span class="line">     =</span><br><span class="line">    (<span class="keyword">select</span> <span class="keyword">checksum_agg</span>(binary_checksum(*)) <span class="keyword">from</span> B)</span><br><span class="line">print <span class="string">'相等'</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">print <span class="string">'不相等'</span></span><br></pre></td></tr></table></figure>
<h2 id="17-杀掉所有的事件探察器进程"><a href="#17-杀掉所有的事件探察器进程" class="headerlink" title="17. 杀掉所有的事件探察器进程:"></a>17. 杀掉所有的事件探察器进程:</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> hcforeach <span class="keyword">CURSOR</span> <span class="keyword">GLOBAL</span> <span class="keyword">FOR</span> <span class="keyword">SELECT</span> <span class="string">'kill '</span>+<span class="keyword">RTRIM</span>(spid) <span class="keyword">FROM</span> master.dbo.sysprocesses</span><br><span class="line"><span class="keyword">WHERE</span> program_name <span class="keyword">IN</span>(<span class="string">'SQL profiler'</span>,N<span class="string">'SQL 事件探查器'</span>)</span><br><span class="line">EXEC sp_msforeach_worker <span class="string">'?'</span></span><br></pre></td></tr></table></figure>
<h2 id="18-记录搜索"><a href="#18-记录搜索" class="headerlink" title="18. 记录搜索:"></a>18. 记录搜索:</h2><ul>
<li><p>开头到N条记录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> Top N * <span class="keyword">From</span> 表</span><br></pre></td></tr></table></figure>
</li>
<li><p>N到M条记录(要有主索引ID)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> Top M-N * <span class="keyword">From</span> 表 <span class="keyword">Where</span> <span class="keyword">ID</span> <span class="keyword">in</span> (<span class="keyword">Select</span> Top M <span class="keyword">ID</span> <span class="keyword">From</span> 表) <span class="keyword">Order</span> <span class="keyword">by</span> <span class="keyword">ID</span>   <span class="keyword">Desc</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>N到结尾记录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> Top N * <span class="keyword">From</span> 表 <span class="keyword">Order</span> <span class="keyword">by</span> <span class="keyword">ID</span> <span class="keyword">Desc</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="19-获取当前数据库中的所有用户表"><a href="#19-获取当前数据库中的所有用户表" class="headerlink" title="19. 获取当前数据库中的所有用户表"></a>19. 获取当前数据库中的所有用户表</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">Name</span> <span class="keyword">from</span> sysobjects <span class="keyword">where</span> xtype=<span class="string">'u'</span> <span class="keyword">and</span> <span class="keyword">status</span>&gt;=<span class="number">0</span></span><br></pre></td></tr></table></figure>
<h2 id="20-获取某一个表的所有字段"><a href="#20-获取某一个表的所有字段" class="headerlink" title="20. 获取某一个表的所有字段"></a>20. 获取某一个表的所有字段</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">name</span> <span class="keyword">from</span> syscolumns <span class="keyword">where</span> <span class="keyword">id</span>=object_id(<span class="string">'表名'</span>)</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">name</span> <span class="keyword">from</span> syscolumns <span class="keyword">where</span> <span class="keyword">id</span> <span class="keyword">in</span> (<span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> sysobjects <span class="keyword">where</span> <span class="keyword">type</span> = <span class="string">'u'</span> <span class="keyword">and</span> <span class="keyword">name</span> = <span class="string">'表名'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="21-查看与某一个表相关的视图、存储过程、函数"><a href="#21-查看与某一个表相关的视图、存储过程、函数" class="headerlink" title="21. 查看与某一个表相关的视图、存储过程、函数"></a>21. 查看与某一个表相关的视图、存储过程、函数</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.* <span class="keyword">from</span> sysobjects a, syscomments b <span class="keyword">where</span> a.id = b.id <span class="keyword">and</span> b.text <span class="keyword">like</span> <span class="string">'%表名%'</span></span><br></pre></td></tr></table></figure>
<h2 id="22-查看当前数据库中所有存储过程"><a href="#22-查看当前数据库中所有存储过程" class="headerlink" title="22. 查看当前数据库中所有存储过程"></a>22. 查看当前数据库中所有存储过程</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">name</span> <span class="keyword">as</span> 存储过程名称 <span class="keyword">from</span> sysobjects <span class="keyword">where</span> xtype=<span class="string">'P'</span></span><br></pre></td></tr></table></figure>
<h2 id="23-查询用户创建的所有数据库"><a href="#23-查询用户创建的所有数据库" class="headerlink" title="23. 查询用户创建的所有数据库"></a>23. 查询用户创建的所有数据库</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> master..sysdatabases D <span class="keyword">where</span> <span class="keyword">sid</span> <span class="keyword">not</span> <span class="keyword">in</span>(<span class="keyword">select</span> <span class="keyword">sid</span> <span class="keyword">from</span> master..syslogins <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'sa'</span>)</span><br><span class="line"><span class="keyword">select</span> dbid, <span class="keyword">name</span> <span class="keyword">AS</span> DB_NAME <span class="keyword">from</span> master..sysdatabases <span class="keyword">where</span> <span class="keyword">sid</span> &lt;&gt; <span class="number">0x01</span></span><br></pre></td></tr></table></figure>
<h2 id="24-查询某一个表的字段和数据类型"><a href="#24-查询某一个表的字段和数据类型" class="headerlink" title="24. 查询某一个表的字段和数据类型"></a>24. 查询某一个表的字段和数据类型</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column_name,data_type <span class="keyword">from</span> information_schema.columns</span><br><span class="line"><span class="keyword">where</span> table_name = <span class="string">'表名'</span></span><br></pre></td></tr></table></figure>
<h2 id="25-不同服务器数据库之间的数据操作"><a href="#25-不同服务器数据库之间的数据操作" class="headerlink" title="25. 不同服务器数据库之间的数据操作"></a>25. 不同服务器数据库之间的数据操作</h2><h4 id="25-1-创建链接服务器"><a href="#25-1-创建链接服务器" class="headerlink" title="25.1 创建链接服务器"></a>25.1 创建链接服务器</h4><ul>
<li><p>创建一个链接名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXEC sp_addlinkedserver 'LinkName ', ' ', 'SQLOLEDB ', '远程服务器名或IP地址 ' <span class="comment">--有自定义实例名时要加上"/实例名"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>创建登录信息（或叫创建链接服务器登录名映射）（只需选择一种方式即可）</p>
<ul>
<li><p>以windows认证的方式登录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXEC sp_addlinkedsrvlogin 'LinkName'  <span class="comment">--或EXEC sp_addlinkedsrvlogin 'LinkName','true'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>以SQL认证的方式登录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXEC sp_addlinkedsrvlogin 'LinkName ', 'false ',null, '用户名 ', '密码 '</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h4 id="25-2-链接服务器相关数据操作"><a href="#25-2-链接服务器相关数据操作" class="headerlink" title="25.2 链接服务器相关数据操作"></a>25.2 链接服务器相关数据操作</h4><ul>
<li>查询示例<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> LinkName.数据库名.架构名.表名</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="25-3-删除链接服务器"><a href="#25-3-删除链接服务器" class="headerlink" title="25.3 删除链接服务器"></a>25.3 删除链接服务器</h4><ul>
<li><p>删除登录信息(或叫删除链接服务器登录名映射)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXEC sp_droplinkedsrvlogin 'LinkName',NULL</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除链接服务器名称</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXEC sp_dropserver 'LinkName ', 'droplogins' <span class="comment">--如果指定droplogins，则在删除链接服务器之前要删除登录名映射</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="25-4-其它连接远程-局域网数据方法：OPENROWSET-OPENQUERY-opendatasource"><a href="#25-4-其它连接远程-局域网数据方法：OPENROWSET-OPENQUERY-opendatasource" class="headerlink" title="25.4 其它连接远程/局域网数据方法：OPENROWSET/OPENQUERY/opendatasource"></a>25.4 其它连接远程/局域网数据方法：OPENROWSET/OPENQUERY/opendatasource</h4><ul>
<li><h5 id="OPENROWSET方法（不需要用到创建好的链接名。如果连接的实例名不是默认的，需要在”sql服务器名或IP地址”后加上”-实例名”）"><a href="#OPENROWSET方法（不需要用到创建好的链接名。如果连接的实例名不是默认的，需要在”sql服务器名或IP地址”后加上”-实例名”）" class="headerlink" title="OPENROWSET方法（不需要用到创建好的链接名。如果连接的实例名不是默认的，需要在”sql服务器名或IP地址”后加上”/实例名”）"></a>OPENROWSET方法（不需要用到创建好的链接名。如果连接的实例名不是默认的，需要在”sql服务器名或IP地址”后加上”/实例名”）</h5><ul>
<li><p>查询示例</p>
<ul>
<li><p>Windows认证方式查询(以下方法之一即可)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OPENROWSET(<span class="string">'SQLOLEDB'</span>, <span class="string">'server=sql服务器名或IP地址;Trusted_Connection=yes'</span>,数据库名.架构名.表名)</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OPENROWSET(<span class="string">'SQLNCLI'</span>, <span class="string">'server=sql服务器名或IP地址;Trusted_Connection=yes'</span>,数据库名.架构名.表名)</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OPENROWSET(<span class="string">'SQLOLEDB'</span>, <span class="string">'server=sql服务器名或IP地址;Trusted_Connection=yes'</span>,<span class="string">'SELECT * FROM 数据库名.架构名.表名'</span>)</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OPENROWSET(<span class="string">'SQLNCLI'</span>, <span class="string">'server=sql服务器名或IP地址;Trusted_Connection=yes'</span>,<span class="string">'SELECT * FROM 数据库名.架构名.表名'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>SQL认证方式查询(以下方法之一即可)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OPENROWSET(<span class="string">'SQLOLEDB'</span>, <span class="string">'server=sql服务器名或IP地址;uid=用户名;pwd=密码'</span>,数据库名.架构名.表名)</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OPENROWSET(<span class="string">'SQLNCLI'</span>, <span class="string">'server=sql服务器名或IP地址;uid=用户名;pwd=密码'</span>,数据库名.架构名.表名)</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OPENROWSET(<span class="string">'SQLOLEDB'</span>, <span class="string">'server=sql服务器名或IP地址;uid=用户名;pwd=密码'</span>,<span class="string">'SELECT * FROM 数据库名.架构名.表名'</span>)</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OPENROWSET(<span class="string">'SQLNCLI'</span>, <span class="string">'server=sql服务器名或IP地址;uid=用户名;pwd=密码'</span>,<span class="string">'SELECT * FROM 数据库名.架构名.表名'</span>)</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OPENROWSET(<span class="string">'SQLOLEDB'</span>, <span class="string">'sql服务器名'</span>;'用户名';'密码',数据库名.架构名.表名)</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OPENROWSET(<span class="string">'SQLNCLI'</span>, <span class="string">'sql服务器名'</span>;'用户名';'密码',数据库名.架构名.表名)</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OPENROWSET(<span class="string">'SQLOLEDB'</span>, <span class="string">'sql服务器名'</span>;'用户名';'密码','<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> 数据库名.架构名.表名<span class="string">')</span></span><br><span class="line"><span class="string">SELECT * FROM OPENROWSET('</span>SQLNCLI<span class="string">', '</span><span class="keyword">sql</span>服务器名<span class="string">';'</span>用户名<span class="string">'; '</span>密码<span class="string">','</span><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> 数据库名.架构名.表名<span class="string">')</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>生成本地表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">INTO</span> 表 <span class="keyword">FROM</span> openrowset( <span class="string">'SQLOLEDB '</span>, <span class="string">'sql服务器名 '</span>; '用户名 '; '密码 ',数据库名.dbo.表名)</span><br></pre></td></tr></table></figure>
</li>
<li><p>把本地表导入远程表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> OPENROWSET(<span class="string">'SQLOLEDB'</span>, <span class="string">'server=sql服务器名或IP地址;uid=用户名;pwd=密码'</span>,数据库名.架构名.表名)</span><br><span class="line">   <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> 本地表</span><br></pre></td></tr></table></figure>
</li>
<li><p>关联更新本地表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">	<span class="keyword">UPDATE</span> b</span><br><span class="line">	   <span class="keyword">SET</span> b.列A = a.列A</span><br><span class="line">	  <span class="keyword">FROM</span> OPENROWSET( <span class="string">'SQLOLEDB '</span>, <span class="string">'sql服务器名 '</span>; '用户名 '; '密码 ',数据库名.dbo.表名) AS a</span><br><span class="line">INNER JOIN 本地表 b ON a.column1 = b.column1</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><h5 id="OPENQUERY方法（需要先创建一个链接）"><a href="#OPENQUERY方法（需要先创建一个链接）" class="headerlink" title="OPENQUERY方法（需要先创建一个链接）"></a>OPENQUERY方法（需要先创建一个链接）</h5><ul>
<li><p>查询示例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OPENQUERY(LinkName,<span class="string">'SELECT * FROM 数据库名.架构名.表名'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>把本地表导入远程表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> OPENQUERY(LinkName, <span class="string">'SELECT *  FROM 数据库名.架构名.表名'</span>) <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> 本地表</span><br></pre></td></tr></table></figure>
</li>
<li><p>关联更新本地表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">	<span class="keyword">UPDATE</span> b</span><br><span class="line">	   <span class="keyword">SET</span> b.列A = a.列A</span><br><span class="line">	  <span class="keyword">FROM</span> OPENQUERY(ITSV, <span class="string">'SELECT * FROM 数据库.dbo.表名 '</span>) <span class="keyword">AS</span> a</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> 本地表 b <span class="keyword">ON</span> a.column1 = b.column1</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><h5 id="OPENDATASOURCE方法-不需要用到创建好的链接名。如果连接的实例名不是默认的，需要在”sql服务器名或IP地址”后加上”-实例名”"><a href="#OPENDATASOURCE方法-不需要用到创建好的链接名。如果连接的实例名不是默认的，需要在”sql服务器名或IP地址”后加上”-实例名”" class="headerlink" title="OPENDATASOURCE方法(不需要用到创建好的链接名。如果连接的实例名不是默认的，需要在”sql服务器名或IP地址”后加上”/实例名”)"></a>OPENDATASOURCE方法(不需要用到创建好的链接名。如果连接的实例名不是默认的，需要在”sql服务器名或IP地址”后加上”/实例名”)</h5><ul>
<li><p>查询示例</p>
<ul>
<li><p>Windows认证方式查询(以下方法之一即可)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OPENDATASOURCE(<span class="string">'SQLOLEDB'</span>, <span class="string">'server=sql服务器名或IP地址;Trusted_Connection=yes'</span>).数据库名.架构名.表名</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OPENDATASOURCE(<span class="string">'SQLNCLI'</span>, <span class="string">'server=sql服务器名或IP地址;Trusted_Connection=yes'</span>).数据库名.架构名.表名</span><br></pre></td></tr></table></figure>
</li>
<li><p>SQL认证方式查询(以下方法之一即可)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OPENDATASOURCE(<span class="string">'SQLOLEDB'</span>, <span class="string">'server=sql服务器名或IP地址;uid=用户名;pwd=密码'</span>).数据库名.架构名.表名</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OPENDATASOURCE(<span class="string">'SQLNCLI'</span>, <span class="string">'server=sql服务器名或IP地址;uid=用户名;pwd=密码'</span>).数据库名.架构名.表名</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OPENDATASOURCE(<span class="string">'SQLOLEDB'</span>, <span class="string">'Data Source=sql服务器名或IP地址;uid=用户名;pwd=密码'</span>).数据库名.架构名.表名</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OPENDATASOURCE(<span class="string">'SQLNCLI'</span>, <span class="string">'Data Source=sql服务器名或IP地址;uid=用户名;pwd=密码'</span>).数据库名.架构名.表名</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>导入示例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> OPENDATASOURCE(<span class="string">'SQLOLEDB'</span>, <span class="string">'server=sql服务器名或IP地址;uid=用户名;pwd=密码'</span>).数据库名.架构名.表名</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> 本地表</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h2 id="26-删除数据库下面的所有表"><a href="#26-删除数据库下面的所有表" class="headerlink" title="26. 删除数据库下面的所有表"></a>26. 删除数据库下面的所有表</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> 数据库名(是要删除表的所在的那个数据库的名称)</span><br><span class="line"><span class="keyword">GO</span></span><br><span class="line"><span class="keyword">declare</span> @<span class="keyword">sql</span> <span class="built_in">varchar</span>(<span class="number">8000</span>)</span><br><span class="line"><span class="keyword">while</span> (<span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> sysobjects <span class="keyword">where</span> <span class="keyword">type</span>=<span class="string">'U'</span>)&gt;<span class="number">0</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">SELECT</span> @<span class="keyword">sql</span>=<span class="string">'drop table '</span> + <span class="keyword">name</span></span><br><span class="line"><span class="keyword">FROM</span> sysobjects</span><br><span class="line"><span class="keyword">WHERE</span> (<span class="keyword">type</span> = <span class="string">'U'</span>)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="string">'drop table '</span> + <span class="keyword">name</span></span><br><span class="line">exec(@<span class="keyword">sql</span>) </span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h2 id="27-查看数据库文件使用情况"><a href="#27-查看数据库文件使用情况" class="headerlink" title="27. 查看数据库文件使用情况"></a>27. 查看数据库文件使用情况</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  A.name                                                     <span class="keyword">AS</span> <span class="string">"逻辑名称"</span></span><br><span class="line">       ,<span class="keyword">CONVERT</span>(<span class="built_in">FLOAT</span> ,A.size)             * (<span class="number">8192.0</span>/<span class="number">1024.0</span>)/<span class="number">1024</span>  <span class="keyword">AS</span> <span class="string">"已用大小MB"</span></span><br><span class="line">       ,<span class="keyword">CONVERT</span>(<span class="built_in">FLOAT</span> ,A.maxSize - A.size) * (<span class="number">8192.0</span>/<span class="number">1024.0</span>)/<span class="number">1024</span>  <span class="keyword">AS</span> <span class="string">"可用大小MB"</span></span><br><span class="line">       ,<span class="keyword">CONVERT</span>(<span class="built_in">FLOAT</span> ,A.maxSize)          * (<span class="number">8192.0</span>/<span class="number">1024.0</span>)/<span class="number">1024</span>  <span class="keyword">AS</span> <span class="string">"分配大小MB"</span></span><br><span class="line">       ,A.fileName                                                 <span class="keyword">AS</span> <span class="string">"文件路径"</span></span><br><span class="line">       ,(</span><br><span class="line">         <span class="keyword">SELECT</span>  SA.groupName</span><br><span class="line">           <span class="keyword">FROM</span>  SysFileGroups  SA</span><br><span class="line">          <span class="keyword">WHERE</span>  SA.groupID = A.groupID</span><br><span class="line">        )                                                          <span class="keyword">AS</span> <span class="string">"文件组"</span></span><br><span class="line">       ,<span class="keyword">CASE</span> <span class="keyword">WHEN</span> A.status = <span class="number">1081346</span> <span class="keyword">THEN</span> <span class="string">'磁盘文件'</span>               </span><br><span class="line">             <span class="keyword">WHEN</span> A.status = <span class="number">1081410</span> <span class="keyword">THEN</span> <span class="string">'日志设备'</span></span><br><span class="line">             <span class="keyword">ELSE</span> <span class="keyword">CONVERT</span>(<span class="built_in">VARCHAR</span> ,A.status) <span class="keyword">END</span>                   <span class="keyword">AS</span> <span class="string">"文件类型"</span></span><br><span class="line">  <span class="keyword">FROM</span>  SysFiles  A</span><br></pre></td></tr></table></figure>
<h2 id="28-修改sa的密码"><a href="#28-修改sa的密码" class="headerlink" title="28. 修改sa的密码"></a>28. 修改sa的密码</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXEC sp_password 'OldPassword','NewPassword','sa';</span><br></pre></td></tr></table></figure>
<blockquote>
<p>不知道OldPassword时，可用NULL代替。</p>
</blockquote>
<hr>
<h1 id="常识"><a href="#常识" class="headerlink" title="常识"></a>常识</h1><ul>
<li>在SQL查询中，from后最多可以跟256张表或视图</li>
<li>在SQL语句中使用Order by查询时，先排序，后取值</li>
<li>在SQL中，一个字段的最大容量是8000</li>
</ul>

        </div>
        <div class="post-tool">
            <a class="btn-thumbs-up" href="javascript:void(0);" data-cid="52" title="95">
                <i class="fa fa-thumbs-up" aria-hidden="true"></i> 打赏
            </a>
        </div>
        
        <div class="post-tags">标签：
            
            <a href="/tags/sql/">sql</a>
            
            <a href="/tags/经典语句/">经典语句</a>
            
        </div>
        
    </article>
	<div class="post-author clearfix">
		<a class="avatar fleft" href="https://yangpiena.coding.me" target="_blank">
			<img width="48" src="/img/avatar/ironman.png" alt="avatar">
		</a>
		<p><span class="label">作者</span>
			<a href="https://yangpiena.coding.me" target="_blank">昜丿捺</a>
			<span title="最后编辑于&nbsp;2016-11-29">2016-11-29</span>
			，共 19694 字 
		</p>		
		<!-- <p>null</p> -->
		
		<!-- YPN Add 2019-03-22 没有authorDesc时，显示一言经典语句-->
		
			<!-- <script type="text/javascript" src="https://api.lwl12.com/hitokoto/v1?encode=js&charset=utf-8"></script>-->
			<!-- <p><span id="lwlhitokoto"><script>lwlhitokoto()</script></span></p>-->
			<p><span id="lwlhitokoto"><script>
				var binft = function (r) {
					function t() {
					return b[Math.floor(Math.random() * b.length)]
					}  
					function e() {
					return String.fromCharCode(94 * Math.random() + 33)
					}
					function n(r) {
					for (var n = document.createDocumentFragment(), i = 0; r > i; i++) {
					  var l = document.createElement("span");
					  l.textContent = e(), l.style.color = t(), n.appendChild(l)
					}
					return n
					}
					function i() {
						//var t = o[c.skillI];
						var t = v_yiYan;
						c.step ? c.step-- : (c.step = g, c.prefixP < l.length ? (c.prefixP >= 0 && (c.text += l[c.prefixP]), c.prefixP++) : "forward" === c.direction ? c.skillP < t.length ? (c.text += t[c.skillP], c.skillP++) : c.delay ? c.delay-- : (c.direction = "backward", c.delay = a) : c.skillP > 0 ? (c.text = c.text.slice(0, -1), c.skillP--) : (c.skillI = (c.skillI + 1) % o.length, c.direction = "forward")), r.textContent = c.text, r.appendChild(n(c.prefixP < l.length ? Math.min(s, s + c.prefixP) : Math.min(s, t.length - c.skillP))), setTimeout(i, d)
					}
					var l = "",
					o = ["青青陵上柏，磊磊涧中石。", "人生天地间，忽如远行客。","斗酒相娱乐，聊厚不为薄。", "驱车策驽马，游戏宛与洛。","洛中何郁郁，冠带自相索。","长衢罗夹巷，王侯多第宅。","两宫遥相望，双阙百余尺。","极宴娱心意，戚戚何所迫？"].map(function (r) {
						return r + ""
					}),
					a = 2,
					g = 1,
					s = 5,
					d = 75,
					b = ["rgb(110,64,170)", "rgb(150,61,179)", "rgb(191,60,175)", "rgb(228,65,157)", "rgb(254,75,131)", "rgb(255,94,99)", "rgb(255,120,71)", "rgb(251,150,51)", "rgb(226,183,47)", "rgb(198,214,60)", "rgb(175,240,91)", "rgb(127,246,88)", "rgb(82,246,103)", "rgb(48,239,130)", "rgb(29,223,163)", "rgb(26,199,194)", "rgb(35,171,216)", "rgb(54,140,225)", "rgb(76,110,219)", "rgb(96,84,200)"],
					c = {
						text: "",
						prefixP: -s,
						skillI: 0,
						skillP: 0,
						direction: "forward",
						delay: a,
						step: g
					};	  
					//YPN Add 2019-03-29 请求获得从7种分类中随机抽取一个句子，并以纯文本格式输出：https://v1.hitokoto.cn/?encode=text
					//https://v1.hitokoto.cn/（从7种分类中随机抽取）
					//https://v1.hitokoto.cn/?c=b （请求获得一个分类是漫画的句子）
					//https://v1.hitokoto.cn/?c=f&encode=text （请求获得一个来自网络的句子，并以纯文本格式输出）
					var v_yiYan = "让我安静一会儿";
					var xhr = new XMLHttpRequest();
					xhr.onreadystatechange = function () {
						if (xhr.readyState === 4) {
							v_yiYan = xhr.responseText;
						}
					}
					xhr.open("GET", "https://v1.hitokoto.cn/?encode=text",true);
					xhr.send();
					i()
				};
				binft(document.getElementById('lwlhitokoto'));
			</script></span></p>
		
	</div>
	
	<!-- YPN Add 2019-03-29 增加背景音乐Aplayer-->
	<!-- 参数如下：（粗体为必填项） -->
	<!-- data-id: 歌曲/专辑/歌单 ID -->	
		<!-- data-server: 音乐平台，支持如下参数 -->
		<!-- netease （网易云音乐） -->
		<!-- tencent （qq音乐） -->
		<!-- xiami （虾米音乐） -->
		<!-- kugou （酷狗音乐） -->
		<!-- baidu （百度音乐） -->	
	<!-- data-type: 请求类型，支持如下参数 -->
		<!-- song （单曲） -->
		<!-- album （专辑） -->
		<!-- playlist （歌单） -->
		<!-- search （搜索） -->
	<!-- data-mode: 播放模式 -->
		<!-- random （随机） -->
		<!-- single （单曲） -->
		<!-- circulation （列表循环） -->
		<!-- order （列表） -->
	<!-- data-autoplay: 自动播放  -->
		<!-- true -->
		<!-- false -->
	<section class="music">
		<div class="content material">
			<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.7.0/dist/APlayer.min.css">
			<div class="aplayer" data-theme="#1BCDFC" data-mode="random" data-server="netease" data-type="playlist" data-id="745065239" data-volume="0.7">
			</div>
			<script src="https://cdn.jsdelivr.net/npm/aplayer@1.7.0/dist/APlayer.min.js"></script>
			<script src="https://cdn.jsdelivr.net/npm/meting@1.1.0/dist/Meting.min.js"></script>
		</div>
	</section>
	
	<!-- 
    
    <p style="text-align: center">本文代表个人观点，内容仅供参考。若有不恰当之处，望不吝赐教！</p>
    
	-->
    

    

</div>
<script src="/js/busuanzi.pure.mini.js"></script>


        </div><!-- end #main-->
    </div><!-- end #body -->
    <footer class="footer">
    <div class="footer-inner" style="text-align: center">
        <p>
            <a href="/about" title="关于">关于</a>&nbsp;&nbsp<em>·</em>&nbsp;&nbsp
            <!-- 自定义链接 -->
            <a href="/help" title="帮助">帮助</a>&nbsp;&nbsp<em>·</em>&nbsp;&nbsp
            <a href="/links" title="友链">友链</a>&nbsp;&nbsp<em>·</em>&nbsp;&nbsp
            <a href="/sitemap.xml" title="地图">地图</a>
        </p>
        <p>
            本站已建立&nbsp<a href="/timeline" id="siteBuildingTime"></a>&nbsp天，<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="licence">采用知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议创作</a><br>
            ©2016-<span id="cpYear"></span> 基于&nbsp<a href="http://hexo.io" target="_blank" rel="nofollow">Hexo</a>
            ，主题采用&nbsp&nbsp<a href="https://github.com/tangkunyin/hexo-theme-jsimple" target="_blank" rel="bookmark">JSimple</a>
            ，作者&nbsp<a href="https://yangpiena.coding.me" target="_blank" rel="friend">昜丿捺</a>
            ，Hosted by <a href="https://coding.net/" target="_blank" rel="nofollow">Coding Pages</a>
        </p>
    </div>
</footer>
<script src="/js/SimpleCore.js"></script>


<!--2017-10-06 YPN Add 添加鼠标点击特效 -->
<script type="text/javascript">
  /* 鼠标点击特效 */
  var a_idx = 0;
  jQuery(document).ready(function($) {
      $("body").click(function(e) {
  var a = new Array("富强", "民主", "文明", "和谐", "自由", "平等", "公正" ,"法治", "爱国", "敬业", "诚信", "友善");
  var $i = $("<span/>").text(a[a_idx]);
          a_idx = (a_idx + 1) % a.length;
  var x = e.pageX,
          y = e.pageY;
          $i.css({
  "z-index": 999999999999999999999999999999999999999999999999999999999999999999999,
  "top": y - 20,
  "left": x,
  "cursor":"default",
  "position": "absolute",
  "font-weight": "bold",
  "color": "#ff6651"
          });
          $("body").append($i);
          $i.animate({
  "top": y - 180,
  "opacity": 0
          },
          1500,
  function() {
              $i.remove();
          });
      });
  });
</script>

<!--2017-10-06 YPN Add 添加输入框特效。 -->
<script src="/js/activate-power-mode.js"></script>
<script>
  POWERMODE.colorful = true;  // 控制开启/开启礼花特效  
  POWERMODE.shake    = false; // 控制开启/关闭屏幕震动特效  
  document.body.addEventListener('input', POWERMODE);
</script>

<!--动态线条背景
<script type="text/javascript" color="231,129,112" opacity='0.7' zIndex="-2" count="200" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>-->

<!-- YPN 2019-10-22 Create 搜索框 -->
<script>
	var favObj = {
		init: function() {
			var s = this;
			s.band();
		},
		band: function() {
			$('#b-btn, #q-btn, #m-btn, #d-btn, #p-btn, #w-btn').focus(function() {
					var id = this.id;
					var urlArr = {
						'b-btn': '//www.baidu.com/baidu',
						'q-btn': '//www.google.com/search',
						'm-btn': 'https://mijisou.com/',
						'd-btn': 'https://www.dogedoge.com/',
						'w-btn': 'https://cn.bing.com/'
					}
					$('#search-form').attr('action', urlArr[id]);
			});
			$('#search-form').on('submit', function() {
				$('#q-word').val($('#b-word').val());
			});
			//alert("");
		}
	};
	favObj.init();
</script>
</div>
<!-- search pop -->
<div class="popup search-popup local-search-popup">
    <div class="local-search-header clearfix">
        <span class="search-icon">
            <i class="fa fa-search"></i>
        </span>
        <span class="popup-btn-close">
            <i class="fa fa-times-circle"></i>
        </span>
        <div class="local-search-input-wrapper">
            <input id="local-search-input" spellcheck="false" type="text" autocomplete="off" placeholder="输入关键字开始搜索">
        </div>
    </div>
    <div id="local-search-result"></div>
</div>
<div class="fixed-btn">
    <a class="btn-gotop" href="javascript:"> <i class="fa fa-angle-up"></i></a>
</div>
<script>
    $(function () {
        var jsi_config = {
            buildingTime: '01/20/2018',
            current: $('.post-tags').length > 0 ? 'post' : 'archive',
            snsQRCode: '/images/sns-qrcode.png',
            donateImg: '/images/donate-qr.png',
            localSearch: { dbPath: '' },
            readMode: 'day'
        };
        
            jsi_config.localSearch = {
                dbPath: '/search.xml',
                trigger: 'auto',
                topN: '1',
                unescape: 'false'
            }
        
        SimpleCore.init(jsi_config);
        
    });
</script>
<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":70,"height":90,"hOffset":-37,"vOffset":-20},"mobile":{"show":false}});</script></body>
</html>
