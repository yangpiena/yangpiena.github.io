<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">




















  
  
  <link rel="stylesheet" href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5">







<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=6.7.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.7.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/img/avatar/ironman.png?v=6.7.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/img/avatar/favicon.ico?v=6.7.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.7.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.7.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="一. 基础篇1. 创建数据库1CREATE DATABASE database-name 2. 删除数据库1drop database dbname 3. 备份sql server创建 备份数据的 device12USE masterEXEC sp_addumpdevice &apos;disk&apos;, &apos;testBack&apos;, &apos;c:\mssql7backup\MyNwind_1.dat&apos; 开始 备份1BACK">
<meta name="keywords" content="sql,经典语句">
<meta property="og:type" content="article">
<meta property="og:title" content="SQL经典语句">
<meta property="og:url" content="https://yangpiena.github.io/2016/11/29/SQL经典语句/index.html">
<meta property="og:site_name" content="昜丿捺">
<meta property="og:description" content="一. 基础篇1. 创建数据库1CREATE DATABASE database-name 2. 删除数据库1drop database dbname 3. 备份sql server创建 备份数据的 device12USE masterEXEC sp_addumpdevice &apos;disk&apos;, &apos;testBack&apos;, &apos;c:\mssql7backup\MyNwind_1.dat&apos; 开始 备份1BACK">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2021-11-04T01:49:25.508Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="SQL经典语句">
<meta name="twitter:description" content="一. 基础篇1. 创建数据库1CREATE DATABASE database-name 2. 删除数据库1drop database dbname 3. 备份sql server创建 备份数据的 device12USE masterEXEC sp_addumpdevice &apos;disk&apos;, &apos;testBack&apos;, &apos;c:\mssql7backup\MyNwind_1.dat&apos; 开始 备份1BACK">






  <link rel="canonical" href="https://yangpiena.github.io/2016/11/29/SQL经典语句/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>SQL经典语句 | 昜丿捺</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">昜丿捺</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">没有阳光，沉默而居</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-links">

    
    
    
      
    

    

    <a href="/links" rel="section"><i class="menu-item-icon fa fa-fw fa-star"></i> <br>收藏</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-photos">

    
    
    
      
    

    

    <a href="/photos" rel="section"><i class="menu-item-icon fa fa-fw fa-camera"></i> <br>相册</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://yangpiena.github.io/2016/11/29/SQL经典语句/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="昜丿捺">
      <meta itemprop="description" content="没有阳光，沉默而居">
      <meta itemprop="image" content="/img/avatar/ironman.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="昜丿捺">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">SQL经典语句

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2016-11-29 15:38:32" itemprop="dateCreated datePublished" datetime="2016-11-29T15:38:32+08:00">2016-11-29</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2021-11-04 09:49:25" itemprop="dateModified" datetime="2021-11-04T09:49:25+08:00">2021-11-04</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/tech-notes/" itemprop="url" rel="index"><span itemprop="name">技术</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon">
            <i class="fa fa-eye"></i>
             阅读次数： 
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">93k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">1:25</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="一-基础篇"><a href="#一-基础篇" class="headerlink" title="一. 基础篇"></a>一. 基础篇</h1><h2 id="1-创建数据库"><a href="#1-创建数据库" class="headerlink" title="1. 创建数据库"></a>1. 创建数据库</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> <span class="keyword">database</span>-<span class="keyword">name</span></span><br></pre></td></tr></table></figure>
<h2 id="2-删除数据库"><a href="#2-删除数据库" class="headerlink" title="2. 删除数据库"></a>2. 删除数据库</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">database</span> dbname</span><br></pre></td></tr></table></figure>
<h2 id="3-备份sql-server"><a href="#3-备份sql-server" class="headerlink" title="3. 备份sql server"></a>3. 备份sql server</h2><p>创建 备份数据的 device<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">USE</span> <span class="keyword">master</span></span><br><span class="line">EXEC sp_addumpdevice <span class="string">'disk'</span>, <span class="string">'testBack'</span>, <span class="string">'c:\mssql7backup\MyNwind_1.dat'</span></span><br></pre></td></tr></table></figure></p>
<p>开始 备份<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BACKUP</span> <span class="keyword">DATABASE</span> pubs <span class="keyword">TO</span> testBack</span><br></pre></td></tr></table></figure></p>
<a id="more"></a>
<h2 id="4-创建新表"><a href="#4-创建新表" class="headerlink" title="4. 创建新表"></a>4. 创建新表</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tabname(col1 type1 [<span class="keyword">not</span> <span class="literal">null</span>] [primary <span class="keyword">key</span>],col2 type2 [<span class="keyword">not</span> <span class="literal">null</span>],..)</span><br></pre></td></tr></table></figure>
<p>根据已有的表创建新表：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tab_new <span class="keyword">like</span> tab_old (使用旧表创建新表)</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tab_new <span class="keyword">as</span> <span class="keyword">select</span> col1,col2… <span class="keyword">from</span> tab_old definition <span class="keyword">only</span></span><br></pre></td></tr></table></figure></p>
<h2 id="5-删除新表"><a href="#5-删除新表" class="headerlink" title="5. 删除新表"></a>5. 删除新表</h2><pre><code>drop table tabname
</code></pre><h2 id="6-增加一个列"><a href="#6-增加一个列" class="headerlink" title="6. 增加一个列"></a>6. 增加一个列</h2><pre><code>Alter table tabname add column col type
</code></pre><blockquote>
<p>注：列增加后将不能删除。DB2中列加上后数据类型也不能改变，唯一能改变的是增加varchar类型的长度。</p>
</blockquote>
<h2 id="7-添加主键"><a href="#7-添加主键" class="headerlink" title="7. 添加主键"></a>7. 添加主键</h2><pre><code>ALTER TABLE tabname ADD PRIMARY KEY (col)
</code></pre><p>删除主键</p>
<pre><code>ALTER TABLE tabname DROP PRIMARY KEY (col)
</code></pre><h2 id="8-创建索引"><a href="#8-创建索引" class="headerlink" title="8. 创建索引"></a>8. 创建索引</h2><pre><code>create [unique] index idxname on tabname(col….) 
</code></pre><p>删除索引</p>
<pre><code>drop index idxname
</code></pre><blockquote>
<p>注：索引是不可更改的，想更改必须删除重新建。</p>
</blockquote>
<h2 id="9-创建视图"><a href="#9-创建视图" class="headerlink" title="9. 创建视图"></a>9. 创建视图</h2><pre><code>create view viewname as select statement 
</code></pre><p>删除视图</p>
<pre><code>drop view viewname
</code></pre><h2 id="10-几个简单的基本sql语句"><a href="#10-几个简单的基本sql语句" class="headerlink" title="10. 几个简单的基本sql语句"></a>10. 几个简单的基本sql语句</h2><p>选择</p>
<pre><code>select * from table1 where 范围
</code></pre><p>插入</p>
<pre><code>insert into table1(field1,field2) values(value1,value2)
</code></pre><p>删除</p>
<pre><code>delete from table1 where 范围
</code></pre><p>更新</p>
<pre><code>update table1 set field1=value1 where 范围
</code></pre><p>查找</p>
<pre><code>select * from table1 where field1 like ’%value1%’
</code></pre><p>排序</p>
<pre><code>select * from table1 order by field1,field2 [desc]
</code></pre><p>总数</p>
<pre><code>select count as totalcount from table1
</code></pre><p>求和</p>
<pre><code>select sum(field1) as sumvalue from table1
</code></pre><p>平均</p>
<pre><code>select avg(field1) as avgvalue from table1
</code></pre><p>最大</p>
<pre><code>select max(field1) as maxvalue from table1
</code></pre><p>最小</p>
<pre><code>select min(field1) as minvalue from table1
</code></pre><h2 id="11-几个高级查询运算词"><a href="#11-几个高级查询运算词" class="headerlink" title="11. 几个高级查询运算词"></a>11. 几个高级查询运算词</h2><ul>
<li>A： UNION 运算符<br>UNION 运算符通过组合其他两个结果表（例如 TABLE1 和 TABLE2）并消去表中任何重复行而派生出一个结果表。当 ALL 随 UNION一起使用时（即 UNION ALL），不消除重复行。两种情况下，派生表的每一行不是来自 TABLE1 就是来自 TABLE2。 </li>
<li>B： EXCEPT 运算符<br>EXCEPT 运算符通过包括所有在 TABLE1 中但不在 TABLE2 中的行并消除所有重复行而派生出一个结果表。当 ALL 随 EXCEPT 一起使用时 (EXCEPT ALL)，不消除重复行。 </li>
<li>C： INTERSECT 运算符<br>INTERSECT 运算符通过只包括 TABLE1 和 TABLE2 中都有的行并消除所有重复行而派生出一个结果表。当 ALL 随 INTERSECT 一起使用时 (INTERSECT ALL)，不消除重复行。 <blockquote>
<p>注：使用运算词的几个查询结果行必须是一致的。</p>
</blockquote>
</li>
</ul>
<h2 id="12-使用外连接"><a href="#12-使用外连接" class="headerlink" title="12. 使用外连接"></a>12. 使用外连接</h2><ul>
<li>A. left （outer） join：<br>左外连接（左连接）：结果集几包括连接表的匹配行，也包括左连接表的所有行。 </li>
</ul>
<pre><code>select a.a, a.b, a.c, b.c, b.d, b.f from a LEFT OUT JOIN b ON a.a = b.c
</code></pre><ul>
<li>B：right （outer） join:<br>右外连接(右连接)：结果集既包括连接表的匹配连接行，也包括右连接表的所有行。 </li>
<li>C：full/cross （outer） join：<br>全外连接：不仅包括符号连接表的匹配行，还包括两个连接表中的所有记录。</li>
</ul>
<h2 id="13-分组-Group-by"><a href="#13-分组-Group-by" class="headerlink" title="13. 分组:Group by"></a>13. 分组:Group by</h2><p>一张表，一旦分组 完成后，查询后只能得到组相关的信息。<br>组相关的信息：（统计信息） count,sum,max,min,avg 分组的标准)<br>在SQLServer中分组时：不能以text,ntext,image类型的字段作为分组依据<br>在selecte统计函数中的字段，不能和普通的字段放在一起；</p>
<h2 id="14-对数据库进行操作"><a href="#14-对数据库进行操作" class="headerlink" title="14. 对数据库进行操作"></a>14. 对数据库进行操作</h2><p>分离数据库： sp_detach_db; 附加数据库：sp_attach_db 后接表明，附加需要完整的路径名</p>
<h2 id="15-如何修改数据库的名称"><a href="#15-如何修改数据库的名称" class="headerlink" title="15. 如何修改数据库的名称"></a>15. 如何修改数据库的名称</h2><p>sp_renamedb ‘old_name’, ‘new_name’</p>
<h2 id="16-查询字段ID最大值的记录"><a href="#16-查询字段ID最大值的记录" class="headerlink" title="16. 查询字段ID最大值的记录"></a>16. 查询字段ID最大值的记录</h2><p>无索引</p>
<pre><code>select time from table t1 where not exists (select 1 from table where id &gt; t1.id) 
</code></pre><p>有索引</p>
<pre><code>select time from table where id in (select max(id) from table)
</code></pre><h2 id="17-查询某一列的重复项内容"><a href="#17-查询某一列的重复项内容" class="headerlink" title="17. 查询某一列的重复项内容"></a>17. 查询某一列的重复项内容</h2><pre><code>SELECT * FROM documentation AS A WHERE (SELECT COUNT(*) FROM documentation WHERE fileName=A.fileName)&gt;1 
</code></pre><h2 id="18-判断表中是否存在记录"><a href="#18-判断表中是否存在记录" class="headerlink" title="18. 判断表中是否存在记录"></a>18. 判断表中是否存在记录</h2><pre><code>SELECT COUNT (*) FROM tableName WHERE conditions
</code></pre><hr>
<h1 id="二-提升篇"><a href="#二-提升篇" class="headerlink" title="二. 提升篇"></a>二. 提升篇</h1><h2 id="1-复制表-只复制结构-源表名：a-新表名：b-Access可用"><a href="#1-复制表-只复制结构-源表名：a-新表名：b-Access可用" class="headerlink" title="1. 复制表(只复制结构,源表名：a 新表名：b) (Access可用)"></a>1. 复制表(只复制结构,源表名：a 新表名：b) (Access可用)</h2><p>法一</p>
<pre><code>select * into b from a where 1&lt;&gt;1（仅用于SQlServer）
</code></pre><p>法二</p>
<pre><code>select top 0 * into b from a
</code></pre><h2 id="2-拷贝表-拷贝数据-源表名：a-目标表名：b-Access可用"><a href="#2-拷贝表-拷贝数据-源表名：a-目标表名：b-Access可用" class="headerlink" title="2. 拷贝表(拷贝数据,源表名：a 目标表名：b) (Access可用)"></a>2. 拷贝表(拷贝数据,源表名：a 目标表名：b) (Access可用)</h2><pre><code>insert into b(a, b, c) select d,e,f from b;
</code></pre><h2 id="3-跨数据库之间表的拷贝-具体数据使用绝对路径-Access可用"><a href="#3-跨数据库之间表的拷贝-具体数据使用绝对路径-Access可用" class="headerlink" title="3. 跨数据库之间表的拷贝(具体数据使用绝对路径) (Access可用)"></a>3. 跨数据库之间表的拷贝(具体数据使用绝对路径) (Access可用)</h2><pre><code>insert into b(a, b, c) select d,e,f from b in ‘具体数据库’ where 条件
</code></pre><p>例子：..from b in ‘“&amp;Server.MapPath(“.”)&amp;”\data.mdb” &amp;”‘ where..</p>
<h2 id="4-子查询-表名1：a-表名2：b"><a href="#4-子查询-表名1：a-表名2：b" class="headerlink" title="4. 子查询(表名1：a 表名2：b)"></a>4. 子查询(表名1：a 表名2：b)</h2><pre><code>select a,b,c from a where a IN (select d from b ) 或者: select a,b,c from a where a IN (1,2,3)
</code></pre><h2 id="5-显示文章、提交人和最后回复时间"><a href="#5-显示文章、提交人和最后回复时间" class="headerlink" title="5. 显示文章、提交人和最后回复时间"></a>5. 显示文章、提交人和最后回复时间</h2><pre><code>select a.title,a.username,b.adddate from table a,(select max(adddate) adddate from table where table.title=a.title) b
</code></pre><h2 id="6-外连接查询-表名1：a-表名2：b"><a href="#6-外连接查询-表名1：a-表名2：b" class="headerlink" title="6. 外连接查询(表名1：a 表名2：b)"></a>6. 外连接查询(表名1：a 表名2：b)</h2><pre><code>select a.a, a.b, a.c, b.c, b.d, b.f from a LEFT OUT JOIN b ON a.a = b.c
</code></pre><h2 id="7-在线视图查询-表名1：a"><a href="#7-在线视图查询-表名1：a" class="headerlink" title="7. 在线视图查询(表名1：a )"></a>7. 在线视图查询(表名1：a )</h2><pre><code>select * from (SELECT a,b,c FROM a) T where t.a &gt; 1;
</code></pre><h2 id="8-between的用法-between限制查询数据范围时包括了边界值-not-between不包括"><a href="#8-between的用法-between限制查询数据范围时包括了边界值-not-between不包括" class="headerlink" title="8. between的用法,between限制查询数据范围时包括了边界值,not between不包括"></a>8. between的用法,between限制查询数据范围时包括了边界值,not between不包括</h2><pre><code>select * from table1 where time between time1 and time2
select a,b,c, from table1 where a not between 数值1 and 数值2
</code></pre><h2 id="9-in-的使用方法"><a href="#9-in-的使用方法" class="headerlink" title="9. in 的使用方法"></a>9. in 的使用方法</h2><pre><code>select * from table1 where a [not] in (‘值1’,’值2’,’值4’,’值6’)
</code></pre><h2 id="10-两张关联表，删除主表中已经在副表中没有的信息"><a href="#10-两张关联表，删除主表中已经在副表中没有的信息" class="headerlink" title="10. 两张关联表，删除主表中已经在副表中没有的信息"></a>10. 两张关联表，删除主表中已经在副表中没有的信息</h2><pre><code>delete from table1 where not exists ( select * from table2 where table1.field1=table2.field1 )
</code></pre><h2 id="11-四表联查问题"><a href="#11-四表联查问题" class="headerlink" title="11. 四表联查问题"></a>11. 四表联查问题</h2><pre><code>select * from a left inner join b on a.a=b.b right inner join c on a.a=c.c inner join d on a.a=d.d where .....
</code></pre><h2 id="12-日程安排提前五分钟提醒"><a href="#12-日程安排提前五分钟提醒" class="headerlink" title="12. 日程安排提前五分钟提醒"></a>12. 日程安排提前五分钟提醒</h2><pre><code>select * from 日程安排 where datediff(&#39;minute&#39;,f开始时间,getdate())&gt;5
</code></pre><h2 id="13-一条sql语句搞定数据库分页"><a href="#13-一条sql语句搞定数据库分页" class="headerlink" title="13. 一条sql语句搞定数据库分页"></a>13. 一条sql语句搞定数据库分页</h2><pre><code>select top 10 b.* from (select top 20 主键字段,排序字段 from 表名 order by 排序字段 desc) a,表名 b where b.主键字段 = a.主键字段 order by a.排序字段
</code></pre><p>关于数据库分页：</p>
<pre><code>declare @start int,@end int
@sql nvarchar(600)
set @sql=’select top’+str(@end-@start+1)+’+from T where rid not in(select top’+str(@str-1)+’Rid from T where Rid&gt;-1)’
exec sp_executesql @sql
</code></pre><blockquote>
<p>注意：在top后不能直接跟一个变量，所以在实际应用中只有这样的进行特殊的处理。Rid为一个标识列，如果top后还有具体的字段，这样做是非常有好处的。因为这样可以避免 top的字段如果是逻辑索引的，查询的结果后实际表中的不一致（逻辑索引中的数据有可能和数据表中的不一致，而查询时如果处在索引则首先查询索引）</p>
</blockquote>
<h2 id="14-前10条记录"><a href="#14-前10条记录" class="headerlink" title="14. 前10条记录"></a>14. 前10条记录</h2><pre><code>select top 10 * form table1 where 范围
</code></pre><h2 id="15-选择在每一组b值相同的数据中对应的a最大的记录的所有信息-类似这样的用法可以用于论坛每月排行榜-每月热销产品分析-按科目成绩排名-等等"><a href="#15-选择在每一组b值相同的数据中对应的a最大的记录的所有信息-类似这样的用法可以用于论坛每月排行榜-每月热销产品分析-按科目成绩排名-等等" class="headerlink" title="15. 选择在每一组b值相同的数据中对应的a最大的记录的所有信息(类似这样的用法可以用于论坛每月排行榜,每月热销产品分析,按科目成绩排名,等等.)"></a>15. 选择在每一组b值相同的数据中对应的a最大的记录的所有信息(类似这样的用法可以用于论坛每月排行榜,每月热销产品分析,按科目成绩排名,等等.)</h2><pre><code>select a,b,c from tablename ta where a=(select max(a) from tablename tb where tb.b=ta.b)
</code></pre><h2 id="16-包括所有在-TableA-中但不在-TableB和TableC-中的行并消除所有重复行而派生出一个结果表"><a href="#16-包括所有在-TableA-中但不在-TableB和TableC-中的行并消除所有重复行而派生出一个结果表" class="headerlink" title="16. 包括所有在 TableA 中但不在 TableB和TableC 中的行并消除所有重复行而派生出一个结果表"></a>16. 包括所有在 TableA 中但不在 TableB和TableC 中的行并消除所有重复行而派生出一个结果表</h2><pre><code>(select a from tableA ) except (select a from tableB) except (select a from tableC)
</code></pre><h2 id="17-随机取出10条数据"><a href="#17-随机取出10条数据" class="headerlink" title="17. 随机取出10条数据"></a>17. 随机取出10条数据</h2><pre><code>select top 10 * from tablename order by newid()
</code></pre><h2 id="18-随机选择记录"><a href="#18-随机选择记录" class="headerlink" title="18. 随机选择记录"></a>18. 随机选择记录</h2><pre><code>select newid()
</code></pre><h2 id="19-删除重复记录"><a href="#19-删除重复记录" class="headerlink" title="19. 删除重复记录"></a>19. 删除重复记录</h2><ul>
<li>方法一：</li>
</ul>
<pre><code>delete from tablename where id not in (select max(id) from tablename group by col1,col2,...)
</code></pre><ul>
<li>方法二：</li>
</ul>
<pre><code>select distinct * into temp from tablename
delete from tablename
insert into tablename select * from temp
</code></pre><blockquote>
<p>评价： 这种操作牵连大量的数据的移动，这种做法不适合大容量的数据操作</p>
</blockquote>
<ul>
<li>方法三： 例如：在一个外部表中导入数据，由于某些原因第一次只导入了一部分，但很难判断具体位置，这样只有在下一次全部导入，这样也就产生好多重复的字段，怎样删除重复字段</li>
</ul>
<pre><code>alter table tablename
add column_b int identity(1,1)    --添加一个自增列
delete from tablename where column_b not in(
select max(column_b) from tablename group by column1,column2,...)
alter table tablename drop column column_b
</code></pre><h2 id="20-列出数据库里所有的表名"><a href="#20-列出数据库里所有的表名" class="headerlink" title="20. 列出数据库里所有的表名"></a>20. 列出数据库里所有的表名</h2><pre><code>select name from sysobjects where type=&#39;U&#39; // U代表用户
</code></pre><h2 id="21-列出表里的所有的列名"><a href="#21-列出表里的所有的列名" class="headerlink" title="21. 列出表里的所有的列名"></a>21. 列出表里的所有的列名</h2><pre><code>select name from syscolumns where id=object_id(&#39;TableName&#39;)
</code></pre><h2 id="22-列示type、vender、pcs字段，以type字段排列，case可以方便地实现多重选择，类似select-中的case。"><a href="#22-列示type、vender、pcs字段，以type字段排列，case可以方便地实现多重选择，类似select-中的case。" class="headerlink" title="22. 列示type、vender、pcs字段，以type字段排列，case可以方便地实现多重选择，类似select 中的case。"></a>22. 列示type、vender、pcs字段，以type字段排列，case可以方便地实现多重选择，类似select 中的case。</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">type</span>,<span class="keyword">sum</span>(<span class="keyword">case</span> vender <span class="keyword">when</span> <span class="string">'A'</span> <span class="keyword">then</span> pcs <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>),<span class="keyword">sum</span>(<span class="keyword">case</span> vender <span class="keyword">when</span> <span class="string">'C'</span> <span class="keyword">then</span> pcs <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>),<span class="keyword">sum</span>(<span class="keyword">case</span> vender <span class="keyword">when</span> <span class="string">'B'</span> <span class="keyword">then</span> pcs <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>) <span class="keyword">FROM</span> tablename <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">type</span></span><br></pre></td></tr></table></figure>
<p>显示结果：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>type</th>
<th>vender</th>
<th>pcs</th>
</tr>
</thead>
<tbody>
<tr>
<td>电脑</td>
<td>A</td>
<td>1</td>
</tr>
<tr>
<td>电脑</td>
<td>A</td>
<td>1</td>
</tr>
<tr>
<td>光盘</td>
<td>B</td>
<td>2</td>
</tr>
<tr>
<td>光盘</td>
<td>A</td>
<td>2</td>
</tr>
<tr>
<td>手机</td>
<td>B</td>
<td>3</td>
</tr>
<tr>
<td>手机</td>
<td>C</td>
<td>3</td>
</tr>
</tbody>
</table>
</div>
<h2 id="23-初始化表"><a href="#23-初始化表" class="headerlink" title="23. 初始化表"></a>23. 初始化表</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> table1</span><br></pre></td></tr></table></figure>
<h2 id="24-选择从10到15的记录"><a href="#24-选择从10到15的记录" class="headerlink" title="24. 选择从10到15的记录"></a>24. 选择从10到15的记录</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> top <span class="number">5</span> * <span class="keyword">from</span> (<span class="keyword">select</span> top <span class="number">15</span> * <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">id</span> <span class="keyword">asc</span>) table_别名 <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">id</span> <span class="keyword">desc</span></span><br></pre></td></tr></table></figure>
<h2 id="25-临时表"><a href="#25-临时表" class="headerlink" title="25. 临时表"></a>25. 临时表</h2><h4 id="创建临时表"><a href="#创建临时表" class="headerlink" title="创建临时表"></a>创建临时表</h4><ul>
<li><p>方法一：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> #临时表名(字段<span class="number">1</span> 约束条件,</span><br><span class="line">                       字段<span class="number">2</span> 约束条件,</span><br><span class="line">                      .....)</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> ##临时表名(字段<span class="number">1</span> 约束条件,</span><br><span class="line">                        字段<span class="number">2</span> 约束条件,</span><br><span class="line">                        .....)</span><br></pre></td></tr></table></figure>
<p>  例：</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> #Tmp <span class="comment">--创建临时表#Tmp</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">ID</span>   <span class="built_in">int</span> <span class="keyword">IDENTITY</span> (<span class="number">1</span>,<span class="number">1</span>)     <span class="keyword">not</span> <span class="literal">null</span>, <span class="comment">--创建列ID,并且每次新增一条记录就会加1</span></span><br><span class="line">    WokNo                <span class="built_in">varchar</span>(<span class="number">50</span>),   </span><br><span class="line">    primary <span class="keyword">key</span> (<span class="keyword">ID</span>)      <span class="comment">--定义ID为临时表#Tmp的主键      </span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li><p>方法二：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">into</span> #临时表名 <span class="keyword">from</span> 你的表;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">into</span> ##临时表名 <span class="keyword">from</span> 你的表;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>注：以上的#代表局部临时表，##代表全局临时表</p>
</blockquote>
<h4 id="查询临时表"><a href="#查询临时表" class="headerlink" title="查询临时表"></a>查询临时表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> #临时表名;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> ##临时表名;</span><br></pre></td></tr></table></figure>
<h4 id="删除临时表"><a href="#删除临时表" class="headerlink" title="删除临时表"></a>删除临时表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> #临时表名;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> ##临时表名;</span><br></pre></td></tr></table></figure>
<h2 id="26-关联表更新"><a href="#26-关联表更新" class="headerlink" title="26. 关联表更新"></a>26. 关联表更新</h2><p>SQL SERVER<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> A <span class="keyword">SET</span> A.b=B.d <span class="keyword">FROM</span> tableA A <span class="keyword">INNER</span> <span class="keyword">JOIN</span> tableB B <span class="keyword">ON</span> A.a = B.a;</span><br></pre></td></tr></table></figure></p>
<p>MYSQL<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> tableA A <span class="keyword">INNER</span> <span class="keyword">JOIN</span> tableB B <span class="keyword">ON</span> A.a = B.a <span class="keyword">SET</span> A.b=B.d;</span><br></pre></td></tr></table></figure></p>
<h2 id="27-查看表的所有外键关系"><a href="#27-查看表的所有外键关系" class="headerlink" title="27. 查看表的所有外键关系"></a>27. 查看表的所有外键关系</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> t1.*,t2.name,t3.name <span class="keyword">from</span> dbo.sysforeignkeys t1 <span class="keyword">left</span> <span class="keyword">join</span> sysobjects t2 <span class="keyword">on</span> t1.fkeyid=t2.id </span><br><span class="line">           <span class="keyword">left</span> <span class="keyword">join</span> sysobjects t3 <span class="keyword">on</span> t1.rkeyid=t3.id <span class="keyword">where</span> t3.name=<span class="string">'表名 '</span></span><br></pre></td></tr></table></figure>
<h2 id="28-删除所有约束"><a href="#28-删除所有约束" class="headerlink" title="28. 删除所有约束"></a>28. 删除所有约束</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> c1 <span class="keyword">cursor</span> <span class="keyword">for</span></span><br><span class="line">    <span class="keyword">select</span> <span class="string">'alter table ['</span>+ object_name(parent_obj) + <span class="string">'] drop constraint ['</span>+<span class="keyword">name</span>+<span class="string">']; '</span></span><br><span class="line">    <span class="keyword">from</span> sysobjects</span><br><span class="line">    <span class="keyword">where</span> xtype = <span class="string">'F'</span></span><br><span class="line"><span class="keyword">open</span> c1</span><br><span class="line"><span class="keyword">declare</span> @c1 <span class="built_in">varchar</span>(<span class="number">8000</span>)</span><br><span class="line"><span class="keyword">fetch</span> <span class="keyword">next</span> <span class="keyword">from</span> c1 <span class="keyword">into</span> @c1</span><br><span class="line"><span class="keyword">while</span>(@@fetch_status=<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        exec(@c1)</span><br><span class="line">        <span class="keyword">fetch</span> <span class="keyword">next</span> <span class="keyword">from</span> c1 <span class="keyword">into</span> @c1</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">close</span> c1</span><br><span class="line"><span class="keyword">deallocate</span> c1</span><br></pre></td></tr></table></figure>
<h2 id="29-删除数据库所有表"><a href="#29-删除数据库所有表" class="headerlink" title="29. 删除数据库所有表"></a>29. 删除数据库所有表</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> @tname <span class="built_in">varchar</span>(<span class="number">8000</span>)</span><br><span class="line"><span class="keyword">set</span> @tname=<span class="string">''</span></span><br><span class="line"><span class="keyword">select</span> @tname=@tname + <span class="keyword">Name</span> + <span class="string">','</span> <span class="keyword">from</span> sysobjects <span class="keyword">where</span> xtype=<span class="string">'U'</span></span><br><span class="line"><span class="keyword">select</span> @tname=<span class="string">'drop table '</span> + <span class="keyword">left</span>(@tname,<span class="keyword">len</span>(@tname)<span class="number">-1</span>)</span><br><span class="line">exec(@tname)</span><br></pre></td></tr></table></figure>
<h2 id="30-删除外键约束"><a href="#30-删除外键约束" class="headerlink" title="30. 删除外键约束"></a>30. 删除外键约束</h2><p>得到某个表被哪些外键引用，并且显示出外键表的表名<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    fk.name,</span><br><span class="line">    fk.object_id,</span><br><span class="line">    OBJECT_NAME(fk.parent_object_id) <span class="keyword">AS</span> referenceTableName</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    sys.foreign_keys <span class="keyword">AS</span> fk</span><br><span class="line"><span class="keyword">JOIN</span> sys.objects <span class="keyword">AS</span> o <span class="keyword">ON</span> fk.referenced_object_id = o.object_id</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">    o.name = <span class="string">'ATTACHMENTDOC'</span>;</span><br></pre></td></tr></table></figure></p>
<p>通过外键表的表名和外键名称执行以下语句即可删除外键<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> dbo.CONTRACTINFO <span class="keyword">DROP</span> <span class="keyword">CONSTRAINT</span> FK_CONTRACTINFO_ATTACHMENTDOC</span><br></pre></td></tr></table></figure></p>
<h2 id="31-查找指定数据库表的列名、数据类型、数据长度、注释"><a href="#31-查找指定数据库表的列名、数据类型、数据长度、注释" class="headerlink" title="31. 查找指定数据库表的列名、数据类型、数据长度、注释"></a>31. 查找指定数据库表的列名、数据类型、数据长度、注释</h2><p>SQL SERVER 2000<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">SELECT</span> sysobjects.name <span class="keyword">AS</span> 表名, syscolumns.name <span class="keyword">AS</span> 列名, systypes.name <span class="keyword">AS</span> 数据类型, syscolumns.length <span class="keyword">AS</span> 数据长度, sysproperties.[<span class="keyword">value</span>] <span class="keyword">AS</span> 注释</span><br><span class="line">      <span class="keyword">FROM</span> sysproperties</span><br><span class="line"><span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> sysobjects</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> syscolumns <span class="keyword">ON</span> sysobjects.id    = syscolumns.id</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> systypes   <span class="keyword">ON</span> syscolumns.xtype = systypes.xtype </span><br><span class="line">                      <span class="keyword">ON</span> sysproperties.id = syscolumns.id <span class="keyword">AND</span> sysproperties.smallid = syscolumns.colid</span><br><span class="line">     <span class="keyword">WHERE</span> (sysobjects.xtype = <span class="string">'u'</span> <span class="keyword">OR</span> sysobjects.xtype = <span class="string">'v'</span>)</span><br><span class="line">       <span class="keyword">AND</span> (systypes.name &lt;&gt; <span class="string">'sysname'</span>)</span><br><span class="line">       <span class="keyword">AND</span> sysproperties.[<span class="keyword">value</span>] <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="comment">--查询注释不为 NULL 的记录</span></span><br><span class="line">       <span class="keyword">AND</span> (sysobjects.name = <span class="string">'指定数据库表'</span>)</span><br><span class="line">  <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">1</span>, <span class="number">2</span>;</span><br></pre></td></tr></table></figure></p>
<p>SQL SERVER 2005及以上<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">SELECT</span> ta.name <span class="keyword">AS</span> 表名, c.name <span class="keyword">AS</span> 列名, t.name <span class="keyword">AS</span> 数据类型, c.max_length <span class="keyword">AS</span> 数据长度, ex.[<span class="keyword">value</span>] <span class="keyword">AS</span> 注释</span><br><span class="line">      <span class="keyword">FROM</span> sys.columns               <span class="keyword">AS</span> c</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> sys.tables                <span class="keyword">AS</span> ta <span class="keyword">ON</span> c.object_id = ta.object_id</span><br><span class="line"> <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> sys.extended_properties   <span class="keyword">AS</span> ex <span class="keyword">ON</span> ex.major_id = c.object_id <span class="keyword">AND</span> ex.minor_id = c.column_id</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> (<span class="keyword">SELECT</span> <span class="keyword">name</span>, system_type_id</span><br><span class="line">              <span class="keyword">FROM</span> sys.types</span><br><span class="line">             <span class="keyword">WHERE</span> <span class="keyword">name</span> &lt;&gt; <span class="string">'sysname'</span>) <span class="keyword">AS</span> t <span class="keyword">ON</span> c.system_type_id = t.system_type_id</span><br><span class="line">     <span class="keyword">WHERE</span> ta.name = <span class="string">'指定数据库表'</span></span><br><span class="line">       <span class="keyword">AND</span> ex.[<span class="keyword">value</span>] <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br><span class="line">  <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">1</span>, <span class="number">2</span>;</span><br></pre></td></tr></table></figure></p>
<h2 id="32-同步表数据"><a href="#32-同步表数据" class="headerlink" title="32. 同步表数据"></a>32. 同步表数据</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> 表<span class="number">2</span> </span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> 表<span class="number">1</span> <span class="keyword">AS</span> a <span class="keyword">WHERE</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>(<span class="keyword">SELECT</span> <span class="number">1</span> <span class="keyword">FROM</span> 表<span class="number">2</span> <span class="keyword">WHERE</span> <span class="keyword">ID</span> = a.ID);</span><br></pre></td></tr></table></figure>
<h2 id="33-判断某列中是否包含中文字符或者英文字符"><a href="#33-判断某列中是否包含中文字符或者英文字符" class="headerlink" title="33. 判断某列中是否包含中文字符或者英文字符"></a>33. 判断某列中是否包含中文字符或者英文字符</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> 表名 <span class="keyword">WHERE</span> 某列 <span class="keyword">LIKE</span> <span class="string">'%[吖-座]%'</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> 表名 <span class="keyword">WHERE</span> 某列 <span class="keyword">LIKE</span> <span class="string">'%[a-z]%'</span></span><br></pre></td></tr></table></figure>
<h2 id="34-行转列，将多行数据合并成一行（SQL-SERVER-2005以上支持）"><a href="#34-行转列，将多行数据合并成一行（SQL-SERVER-2005以上支持）" class="headerlink" title="34. 行转列，将多行数据合并成一行（SQL SERVER 2005以上支持）"></a>34. 行转列，将多行数据合并成一行（SQL SERVER 2005以上支持）</h2><p>例如，表Table1中有两列数据：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>code</th>
<th>name</th>
</tr>
</thead>
<tbody>
<tr>
<td>AAA</td>
<td>姓名1</td>
</tr>
<tr>
<td>AAA</td>
<td>姓名2</td>
</tr>
<tr>
<td>AAA</td>
<td>姓名3</td>
</tr>
<tr>
<td>BBB</td>
<td>姓名4</td>
</tr>
<tr>
<td>BBB</td>
<td>姓名5</td>
</tr>
</tbody>
</table>
</div>
<p>行转列，想变成如下格式：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>code</th>
<th>name</th>
</tr>
</thead>
<tbody>
<tr>
<td>AAA</td>
<td>姓名1,姓名2,姓名3</td>
</tr>
<tr>
<td>BBB</td>
<td>姓名4,姓名5</td>
</tr>
</tbody>
</table>
</div>
<p>可用如下SQL实现：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">SELECT</span> code, <span class="keyword">name</span> = (<span class="keyword">STUFF</span>((<span class="keyword">SELECT</span> <span class="string">','</span> + <span class="keyword">name</span> </span><br><span class="line">                                <span class="keyword">FROM</span> Table1 </span><br><span class="line">                               <span class="keyword">WHERE</span> code = a.code <span class="keyword">FOR</span> <span class="keyword">xml</span> <span class="keyword">PATH</span>(<span class="string">''</span>)),<span class="number">1</span>,<span class="number">1</span>,<span class="string">''</span>))</span><br><span class="line">    <span class="keyword">FROM</span> Table1 a </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> code</span><br></pre></td></tr></table></figure></p>
<h2 id="35-去除字段中空格、换行符、回车符"><a href="#35-去除字段中空格、换行符、回车符" class="headerlink" title="35. 去除字段中空格、换行符、回车符"></a>35. 去除字段中空格、换行符、回车符</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> xx_sjb <span class="keyword">SET</span> sl = <span class="keyword">LTRIM</span>(<span class="keyword">RTRIM</span>(<span class="keyword">REPLACE</span>(<span class="keyword">REPLACE</span>(sl, <span class="built_in">CHAR</span>(<span class="number">10</span>), <span class="string">''</span>), <span class="built_in">CHAR</span> (<span class="number">13</span>), <span class="string">''</span>)))</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="三-技巧篇"><a href="#三-技巧篇" class="headerlink" title="三. 技巧篇"></a>三. 技巧篇</h1><h2 id="1-1-1，1-2的使用，在SQL语句组合时用的较多"><a href="#1-1-1，1-2的使用，在SQL语句组合时用的较多" class="headerlink" title="1. 1=1，1=2的使用，在SQL语句组合时用的较多"></a>1. 1=1，1=2的使用，在SQL语句组合时用的较多</h2><pre><code>“where 1=1” 表示选择全部
“where 1=2” 表示全部不选
</code></pre><h2 id="2-收缩数据库"><a href="#2-收缩数据库" class="headerlink" title="2. 收缩数据库"></a>2. 收缩数据库</h2><ul>
<li><p>重建索引</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DBCC REINDEX</span><br><span class="line">DBCC INDEXDEFRAG</span><br></pre></td></tr></table></figure>
</li>
<li><p>收缩数据和日志</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DBCC SHRINKDB</span><br><span class="line">DBCC SHRINKFILE</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="3-压缩数据库"><a href="#3-压缩数据库" class="headerlink" title="3. 压缩数据库"></a>3. 压缩数据库</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dbcc shrinkdatabase(dbname)</span><br></pre></td></tr></table></figure>
<h2 id="4-转移数据库给新用户以已存在用户权限"><a href="#4-转移数据库给新用户以已存在用户权限" class="headerlink" title="4. 转移数据库给新用户以已存在用户权限"></a>4. 转移数据库给新用户以已存在用户权限</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exec sp_change_users_login 'update_one','newname','oldname'</span><br><span class="line">go</span><br></pre></td></tr></table></figure>
<h2 id="5-检查备份集"><a href="#5-检查备份集" class="headerlink" title="5. 检查备份集"></a>5. 检查备份集</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">RESTORE</span> VERIFYONLY <span class="keyword">from</span> disk=<span class="string">'E:\dvbbs.bak'</span></span><br></pre></td></tr></table></figure>
<h2 id="6-修复数据库"><a href="#6-修复数据库" class="headerlink" title="6. 修复数据库"></a>6. 修复数据库</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> [dvbbs] <span class="keyword">SET</span> SINGLE_USER</span><br><span class="line"><span class="keyword">GO</span></span><br><span class="line">DBCC CHECKDB(<span class="string">'dvbbs'</span>,repair_allow_data_loss) <span class="keyword">WITH</span> TABLOCK</span><br><span class="line"><span class="keyword">GO</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> [dvbbs] <span class="keyword">SET</span> MULTI_USER</span><br><span class="line"><span class="keyword">GO</span></span><br></pre></td></tr></table></figure>
<h2 id="7-日志清除"><a href="#7-日志清除" class="headerlink" title="7. 日志清除"></a>7. 日志清除</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> NOCOUNT <span class="keyword">ON</span></span><br><span class="line"><span class="keyword">DECLARE</span> @LogicalFileName sysname,</span><br><span class="line">@MaxMinutes <span class="built_in">INT</span>,</span><br><span class="line">@NewSize <span class="built_in">INT</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">USE</span> tablename <span class="comment">-- 要操作的数据库名</span></span><br><span class="line"><span class="keyword">SELECT</span>  @LogicalFileName = <span class="string">'tablename_log'</span>, <span class="comment">-- 日志文件名</span></span><br><span class="line">@MaxMinutes = <span class="number">10</span>, <span class="comment">-- Limit on time allowed to wrap log.</span></span><br><span class="line">@NewSize = <span class="number">1</span>  <span class="comment">-- 你想设定的日志文件的大小(M)</span></span><br><span class="line">Setup / initialize</span><br><span class="line"><span class="keyword">DECLARE</span> @OriginalSize <span class="built_in">int</span></span><br><span class="line"><span class="keyword">SELECT</span> @OriginalSize = <span class="keyword">size</span> </span><br><span class="line"><span class="keyword">FROM</span> sysfiles</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">name</span> = @LogicalFileName</span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">'Original Size of '</span> + db_name() + <span class="string">' LOG is '</span> + </span><br><span class="line"><span class="keyword">CONVERT</span>(<span class="built_in">VARCHAR</span>(<span class="number">30</span>),@OriginalSize) + <span class="string">' 8K pages or '</span> + </span><br><span class="line"><span class="keyword">CONVERT</span>(<span class="built_in">VARCHAR</span>(<span class="number">30</span>),(@OriginalSize*<span class="number">8</span>/<span class="number">1024</span>)) + <span class="string">'MB'</span></span><br><span class="line"><span class="keyword">FROM</span> sysfiles</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">name</span> = @LogicalFileName</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> DummyTrans</span><br><span class="line">(DummyColumn <span class="built_in">char</span> (<span class="number">8000</span>) <span class="keyword">not</span> <span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">DECLARE</span> @Counter    <span class="built_in">INT</span>,</span><br><span class="line">@StartTime DATETIME,</span><br><span class="line">@TruncLog   <span class="built_in">VARCHAR</span>(<span class="number">255</span>)</span><br><span class="line"><span class="keyword">SELECT</span> @StartTime = <span class="keyword">GETDATE</span>(),</span><br><span class="line">@TruncLog = <span class="string">'BACKUP LOG '</span> + db_name() + <span class="string">' WITH TRUNCATE_ONLY'</span></span><br><span class="line">DBCC SHRINKFILE (@LogicalFileName, @NewSize)</span><br><span class="line">EXEC (@TruncLog)</span><br><span class="line"><span class="comment">-- Wrap the log if necessary.</span></span><br><span class="line"><span class="keyword">WHILE</span> @MaxMinutes &gt; <span class="keyword">DATEDIFF</span> (mi, @StartTime, <span class="keyword">GETDATE</span>()) <span class="comment">-- time has not expired</span></span><br><span class="line"><span class="keyword">AND</span> @OriginalSize = (<span class="keyword">SELECT</span> <span class="keyword">size</span> <span class="keyword">FROM</span> sysfiles <span class="keyword">WHERE</span> <span class="keyword">name</span> = @LogicalFileName)  </span><br><span class="line"><span class="keyword">AND</span> (@OriginalSize * <span class="number">8</span> /<span class="number">1024</span>) &gt; @NewSize  </span><br><span class="line"><span class="keyword">BEGIN</span> <span class="comment">-- Outer loop.</span></span><br><span class="line"><span class="keyword">SELECT</span> @Counter = <span class="number">0</span></span><br><span class="line"><span class="keyword">WHILE</span>   ((@Counter &lt; @OriginalSize / <span class="number">16</span>) <span class="keyword">AND</span> (@Counter &lt; <span class="number">50000</span>))</span><br><span class="line"><span class="keyword">BEGIN</span> <span class="comment">-- update</span></span><br><span class="line"><span class="keyword">INSERT</span> DummyTrans <span class="keyword">VALUES</span> (<span class="string">'Fill Log'</span>) <span class="keyword">DELETE</span> DummyTrans</span><br><span class="line"><span class="keyword">SELECT</span> @Counter = @Counter + <span class="number">1</span></span><br><span class="line"><span class="keyword">END</span></span><br><span class="line">EXEC (@TruncLog)  </span><br><span class="line"><span class="keyword">END</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">'Final Size of '</span> + db_name() + <span class="string">' LOG is '</span> +</span><br><span class="line"><span class="keyword">CONVERT</span>(<span class="built_in">VARCHAR</span>(<span class="number">30</span>),<span class="keyword">size</span>) + <span class="string">' 8K pages or '</span> + </span><br><span class="line"><span class="keyword">CONVERT</span>(<span class="built_in">VARCHAR</span>(<span class="number">30</span>),(<span class="keyword">size</span>*<span class="number">8</span>/<span class="number">1024</span>)) + <span class="string">'MB'</span></span><br><span class="line"><span class="keyword">FROM</span> sysfiles </span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">name</span> = @LogicalFileName</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> DummyTrans</span><br><span class="line"><span class="keyword">SET</span> NOCOUNT <span class="keyword">OFF</span></span><br></pre></td></tr></table></figure>
<h2 id="8-更改某个表"><a href="#8-更改某个表" class="headerlink" title="8. 更改某个表"></a>8. 更改某个表</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exec sp_changeobjectowner 'tablename','dbo'</span><br></pre></td></tr></table></figure>
<h2 id="9-存储更改全部表"><a href="#9-存储更改全部表" class="headerlink" title="9. 存储更改全部表"></a>9. 存储更改全部表</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> dbo.User_ChangeObjectOwnerBatch</span><br><span class="line">@OldOwner <span class="keyword">as</span> <span class="keyword">NVARCHAR</span>(<span class="number">128</span>),</span><br><span class="line">@NewOwner <span class="keyword">as</span> <span class="keyword">NVARCHAR</span>(<span class="number">128</span>)</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">DECLARE</span> @<span class="keyword">Name</span>    <span class="keyword">as</span> <span class="keyword">NVARCHAR</span>(<span class="number">128</span>)</span><br><span class="line"><span class="keyword">DECLARE</span> @Owner   <span class="keyword">as</span> <span class="keyword">NVARCHAR</span>(<span class="number">128</span>)</span><br><span class="line"><span class="keyword">DECLARE</span> @OwnerName   <span class="keyword">as</span> <span class="keyword">NVARCHAR</span>(<span class="number">128</span>)</span><br><span class="line"><span class="keyword">DECLARE</span> curObject <span class="keyword">CURSOR</span> <span class="keyword">FOR</span> </span><br><span class="line"><span class="keyword">select</span> <span class="string">'Name'</span>    = <span class="keyword">name</span>,</span><br><span class="line">   <span class="string">'Owner'</span>    = user_name(uid)</span><br><span class="line"><span class="keyword">from</span> sysobjects</span><br><span class="line"><span class="keyword">where</span> user_name(uid)=@OldOwner</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">name</span></span><br><span class="line"><span class="keyword">OPEN</span>   curObject</span><br><span class="line"><span class="keyword">FETCH</span> <span class="keyword">NEXT</span> <span class="keyword">FROM</span> curObject <span class="keyword">INTO</span> @<span class="keyword">Name</span>, @Owner</span><br><span class="line"><span class="keyword">WHILE</span>(@@FETCH_STATUS=<span class="number">0</span>)</span><br><span class="line"><span class="keyword">BEGIN</span>     </span><br><span class="line"><span class="keyword">if</span> @Owner=@OldOwner </span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">   <span class="keyword">set</span> @OwnerName = @OldOwner + <span class="string">'.'</span> + <span class="keyword">rtrim</span>(@<span class="keyword">Name</span>)</span><br><span class="line">   exec sp_changeobjectowner @OwnerName, @NewOwner</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- select @name,@NewOwner,@OldOwner</span></span><br><span class="line"><span class="keyword">FETCH</span> <span class="keyword">NEXT</span> <span class="keyword">FROM</span> curObject <span class="keyword">INTO</span> @<span class="keyword">Name</span>, @Owner</span><br><span class="line"><span class="keyword">END</span></span><br><span class="line"><span class="keyword">close</span> curObject</span><br><span class="line"><span class="keyword">deallocate</span> curObject</span><br><span class="line"><span class="keyword">GO</span></span><br></pre></td></tr></table></figure>
<h2 id="10-SQL-SERVER中直接循环写入数据"><a href="#10-SQL-SERVER中直接循环写入数据" class="headerlink" title="10. SQL SERVER中直接循环写入数据"></a>10. SQL SERVER中直接循环写入数据</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> @i <span class="built_in">int</span></span><br><span class="line"><span class="keyword">set</span> @i=<span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> @i&lt;<span class="number">30</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">test</span> (userid) <span class="keyword">values</span>(@i)</span><br><span class="line"><span class="keyword">set</span> @i=@i+<span class="number">1</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>案例：有如下表，要求就表中所有沒有及格的成绩，在每次增长0.1的基础上，使他们刚好及格:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Name</th>
<th style="text-align:right">score</th>
</tr>
</thead>
<tbody>
<tr>
<td>Zhangshan</td>
<td style="text-align:right">80</td>
</tr>
<tr>
<td>Lishi</td>
<td style="text-align:right">59</td>
</tr>
<tr>
<td>Wangwu</td>
<td style="text-align:right">50</td>
</tr>
<tr>
<td>Songquan</td>
<td style="text-align:right">69</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">while((<span class="keyword">select</span> <span class="keyword">min</span>(score) <span class="keyword">from</span> tb_table)&lt;<span class="number">60</span>)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">update</span> tb_table <span class="keyword">set</span> score =score*<span class="number">1.01</span></span><br><span class="line"><span class="keyword">where</span> score&lt;<span class="number">60</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">select</span> <span class="keyword">min</span>(score) <span class="keyword">from</span> tb_table)&gt;<span class="number">60</span></span><br><span class="line">break</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">continue</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h2 id="11-查看数据库属性"><a href="#11-查看数据库属性" class="headerlink" title="11. 查看数据库属性"></a>11. 查看数据库属性</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sp_helpdb 数据库名</span><br></pre></td></tr></table></figure>
<h2 id="12-按姓氏笔画排序"><a href="#12-按姓氏笔画排序" class="headerlink" title="12. 按姓氏笔画排序:"></a>12. 按姓氏笔画排序:</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> * <span class="keyword">From</span> TableName <span class="keyword">Order</span> <span class="keyword">By</span> CustomerName <span class="keyword">Collate</span> Chinese_PRC_Stroke_ci_as //从少到多</span><br></pre></td></tr></table></figure>
<h2 id="13-数据库加密"><a href="#13-数据库加密" class="headerlink" title="13. 数据库加密:"></a>13. 数据库加密:</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">encrypt</span>(<span class="string">'原始密码'</span>)</span><br><span class="line"><span class="keyword">select</span> pwdencrypt(<span class="string">'原始密码'</span>)</span><br><span class="line"><span class="keyword">select</span> pwdcompare(<span class="string">'原始密码'</span>,<span class="string">'加密后密码'</span>) = <span class="number">1</span><span class="comment">--相同；否则不相同 encrypt('原始密码')</span></span><br><span class="line"><span class="keyword">select</span> pwdencrypt(<span class="string">'原始密码'</span>)</span><br><span class="line"><span class="keyword">select</span> pwdcompare(<span class="string">'原始密码'</span>,<span class="string">'加密后密码'</span>) = <span class="number">1</span><span class="comment">--相同；否则不相同</span></span><br></pre></td></tr></table></figure>
<h2 id="14-取回表中字段"><a href="#14-取回表中字段" class="headerlink" title="14. 取回表中字段:"></a>14. 取回表中字段:</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> @<span class="keyword">list</span> <span class="built_in">varchar</span>(<span class="number">1000</span>),</span><br><span class="line">@<span class="keyword">sql</span> <span class="keyword">nvarchar</span>(<span class="number">1000</span>) </span><br><span class="line"><span class="keyword">select</span> @<span class="keyword">list</span>=@<span class="keyword">list</span>+<span class="string">','</span>+b.name <span class="keyword">from</span> sysobjects a,syscolumns b <span class="keyword">where</span> a.id=b.id <span class="keyword">and</span> a.name=<span class="string">'表A'</span></span><br><span class="line"><span class="keyword">set</span> @<span class="keyword">sql</span>=<span class="string">'select '</span>+<span class="keyword">right</span>(@<span class="keyword">list</span>,<span class="keyword">len</span>(@<span class="keyword">list</span>)<span class="number">-1</span>)+<span class="string">' from 表A'</span> </span><br><span class="line">exec (@<span class="keyword">sql</span>)</span><br></pre></td></tr></table></figure>
<h2 id="15-查看硬盘分区"><a href="#15-查看硬盘分区" class="headerlink" title="15. 查看硬盘分区:"></a>15. 查看硬盘分区:</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXEC master..xp_fixeddrives</span><br></pre></td></tr></table></figure>
<h2 id="16-比较A-B表是否相等"><a href="#16-比较A-B表是否相等" class="headerlink" title="16. 比较A,B表是否相等:"></a>16. 比较A,B表是否相等:</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">if (<span class="keyword">select</span> <span class="keyword">checksum_agg</span>(binary_checksum(*)) <span class="keyword">from</span> A)</span><br><span class="line">     =</span><br><span class="line">    (<span class="keyword">select</span> <span class="keyword">checksum_agg</span>(binary_checksum(*)) <span class="keyword">from</span> B)</span><br><span class="line">print <span class="string">'相等'</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">print <span class="string">'不相等'</span></span><br></pre></td></tr></table></figure>
<h2 id="17-杀掉所有的事件探察器进程"><a href="#17-杀掉所有的事件探察器进程" class="headerlink" title="17. 杀掉所有的事件探察器进程:"></a>17. 杀掉所有的事件探察器进程:</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> hcforeach <span class="keyword">CURSOR</span> <span class="keyword">GLOBAL</span> <span class="keyword">FOR</span> <span class="keyword">SELECT</span> <span class="string">'kill '</span>+<span class="keyword">RTRIM</span>(spid) <span class="keyword">FROM</span> master.dbo.sysprocesses</span><br><span class="line"><span class="keyword">WHERE</span> program_name <span class="keyword">IN</span>(<span class="string">'SQL profiler'</span>,N<span class="string">'SQL 事件探查器'</span>)</span><br><span class="line">EXEC sp_msforeach_worker <span class="string">'?'</span></span><br></pre></td></tr></table></figure>
<h2 id="18-记录搜索"><a href="#18-记录搜索" class="headerlink" title="18. 记录搜索:"></a>18. 记录搜索:</h2><ul>
<li><p>开头到N条记录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> Top N * <span class="keyword">From</span> 表</span><br></pre></td></tr></table></figure>
</li>
<li><p>N到M条记录(要有主索引ID)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> Top M-N * <span class="keyword">From</span> 表 <span class="keyword">Where</span> <span class="keyword">ID</span> <span class="keyword">in</span> (<span class="keyword">Select</span> Top M <span class="keyword">ID</span> <span class="keyword">From</span> 表) <span class="keyword">Order</span> <span class="keyword">by</span> <span class="keyword">ID</span>   <span class="keyword">Desc</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>N到结尾记录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> Top N * <span class="keyword">From</span> 表 <span class="keyword">Order</span> <span class="keyword">by</span> <span class="keyword">ID</span> <span class="keyword">Desc</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="19-获取当前数据库中的所有用户表"><a href="#19-获取当前数据库中的所有用户表" class="headerlink" title="19. 获取当前数据库中的所有用户表"></a>19. 获取当前数据库中的所有用户表</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">Name</span> <span class="keyword">from</span> sysobjects <span class="keyword">where</span> xtype=<span class="string">'u'</span> <span class="keyword">and</span> <span class="keyword">status</span>&gt;=<span class="number">0</span></span><br></pre></td></tr></table></figure>
<h2 id="20-获取某一个表的所有字段"><a href="#20-获取某一个表的所有字段" class="headerlink" title="20. 获取某一个表的所有字段"></a>20. 获取某一个表的所有字段</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">name</span> <span class="keyword">from</span> syscolumns <span class="keyword">where</span> <span class="keyword">id</span>=object_id(<span class="string">'表名'</span>)</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">name</span> <span class="keyword">from</span> syscolumns <span class="keyword">where</span> <span class="keyword">id</span> <span class="keyword">in</span> (<span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> sysobjects <span class="keyword">where</span> <span class="keyword">type</span> = <span class="string">'u'</span> <span class="keyword">and</span> <span class="keyword">name</span> = <span class="string">'表名'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="21-查看与某一个表相关的视图、存储过程、函数"><a href="#21-查看与某一个表相关的视图、存储过程、函数" class="headerlink" title="21. 查看与某一个表相关的视图、存储过程、函数"></a>21. 查看与某一个表相关的视图、存储过程、函数</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.* <span class="keyword">from</span> sysobjects a, syscomments b <span class="keyword">where</span> a.id = b.id <span class="keyword">and</span> b.text <span class="keyword">like</span> <span class="string">'%表名%'</span></span><br></pre></td></tr></table></figure>
<h2 id="22-查看当前数据库中所有存储过程"><a href="#22-查看当前数据库中所有存储过程" class="headerlink" title="22. 查看当前数据库中所有存储过程"></a>22. 查看当前数据库中所有存储过程</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">name</span> <span class="keyword">as</span> 存储过程名称 <span class="keyword">from</span> sysobjects <span class="keyword">where</span> xtype=<span class="string">'P'</span></span><br></pre></td></tr></table></figure>
<h2 id="23-查询用户创建的所有数据库"><a href="#23-查询用户创建的所有数据库" class="headerlink" title="23. 查询用户创建的所有数据库"></a>23. 查询用户创建的所有数据库</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> master..sysdatabases D <span class="keyword">where</span> <span class="keyword">sid</span> <span class="keyword">not</span> <span class="keyword">in</span>(<span class="keyword">select</span> <span class="keyword">sid</span> <span class="keyword">from</span> master..syslogins <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'sa'</span>)</span><br><span class="line"><span class="keyword">select</span> dbid, <span class="keyword">name</span> <span class="keyword">AS</span> DB_NAME <span class="keyword">from</span> master..sysdatabases <span class="keyword">where</span> <span class="keyword">sid</span> &lt;&gt; <span class="number">0x01</span></span><br></pre></td></tr></table></figure>
<h2 id="24-查询某一个表的字段和数据类型"><a href="#24-查询某一个表的字段和数据类型" class="headerlink" title="24. 查询某一个表的字段和数据类型"></a>24. 查询某一个表的字段和数据类型</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> column_name,data_type <span class="keyword">from</span> information_schema.columns</span><br><span class="line"><span class="keyword">where</span> table_name = <span class="string">'表名'</span></span><br></pre></td></tr></table></figure>
<h2 id="25-不同服务器数据库之间的数据操作"><a href="#25-不同服务器数据库之间的数据操作" class="headerlink" title="25. 不同服务器数据库之间的数据操作"></a>25. 不同服务器数据库之间的数据操作</h2><h4 id="25-1-创建链接服务器"><a href="#25-1-创建链接服务器" class="headerlink" title="25.1 创建链接服务器"></a>25.1 创建链接服务器</h4><ul>
<li><p>创建一个链接名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXEC sp_addlinkedserver 'LinkName ', ' ', 'SQLOLEDB ', '远程服务器名或IP地址 ' <span class="comment">--有自定义实例名时要加上"/实例名"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>创建登录信息（或叫创建链接服务器登录名映射）（只需选择一种方式即可）</p>
<ul>
<li><p>以windows认证的方式登录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXEC sp_addlinkedsrvlogin 'LinkName'  <span class="comment">--或EXEC sp_addlinkedsrvlogin 'LinkName','true'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>以SQL认证的方式登录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXEC sp_addlinkedsrvlogin 'LinkName ', 'false ',null, '用户名 ', '密码 '</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h4 id="25-2-链接服务器相关数据操作"><a href="#25-2-链接服务器相关数据操作" class="headerlink" title="25.2 链接服务器相关数据操作"></a>25.2 链接服务器相关数据操作</h4><ul>
<li>查询示例<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> LinkName.数据库名.架构名.表名</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="25-3-删除链接服务器"><a href="#25-3-删除链接服务器" class="headerlink" title="25.3 删除链接服务器"></a>25.3 删除链接服务器</h4><ul>
<li><p>删除登录信息(或叫删除链接服务器登录名映射)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXEC sp_droplinkedsrvlogin 'LinkName',NULL</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除链接服务器名称</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXEC sp_dropserver 'LinkName ', 'droplogins' <span class="comment">--如果指定droplogins，则在删除链接服务器之前要删除登录名映射</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="25-4-其它连接远程-局域网数据方法：OPENROWSET-OPENQUERY-opendatasource"><a href="#25-4-其它连接远程-局域网数据方法：OPENROWSET-OPENQUERY-opendatasource" class="headerlink" title="25.4 其它连接远程/局域网数据方法：OPENROWSET/OPENQUERY/opendatasource"></a>25.4 其它连接远程/局域网数据方法：OPENROWSET/OPENQUERY/opendatasource</h4><ul>
<li><h5 id="OPENROWSET方法（不需要用到创建好的链接名。如果连接的实例名不是默认的，需要在”sql服务器名或IP地址”后加上”-实例名”）"><a href="#OPENROWSET方法（不需要用到创建好的链接名。如果连接的实例名不是默认的，需要在”sql服务器名或IP地址”后加上”-实例名”）" class="headerlink" title="OPENROWSET方法（不需要用到创建好的链接名。如果连接的实例名不是默认的，需要在”sql服务器名或IP地址”后加上”/实例名”）"></a>OPENROWSET方法（不需要用到创建好的链接名。如果连接的实例名不是默认的，需要在”sql服务器名或IP地址”后加上”/实例名”）</h5><ul>
<li><p>查询示例</p>
<ul>
<li><p>Windows认证方式查询(以下方法之一即可)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OPENROWSET(<span class="string">'SQLOLEDB'</span>, <span class="string">'server=sql服务器名或IP地址;Trusted_Connection=yes'</span>,数据库名.架构名.表名)</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OPENROWSET(<span class="string">'SQLNCLI'</span>, <span class="string">'server=sql服务器名或IP地址;Trusted_Connection=yes'</span>,数据库名.架构名.表名)</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OPENROWSET(<span class="string">'SQLOLEDB'</span>, <span class="string">'server=sql服务器名或IP地址;Trusted_Connection=yes'</span>,<span class="string">'SELECT * FROM 数据库名.架构名.表名'</span>)</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OPENROWSET(<span class="string">'SQLNCLI'</span>, <span class="string">'server=sql服务器名或IP地址;Trusted_Connection=yes'</span>,<span class="string">'SELECT * FROM 数据库名.架构名.表名'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>SQL认证方式查询(以下方法之一即可)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OPENROWSET(<span class="string">'SQLOLEDB'</span>, <span class="string">'server=sql服务器名或IP地址;uid=用户名;pwd=密码'</span>,数据库名.架构名.表名)</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OPENROWSET(<span class="string">'SQLNCLI'</span>, <span class="string">'server=sql服务器名或IP地址;uid=用户名;pwd=密码'</span>,数据库名.架构名.表名)</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OPENROWSET(<span class="string">'SQLOLEDB'</span>, <span class="string">'server=sql服务器名或IP地址;uid=用户名;pwd=密码'</span>,<span class="string">'SELECT * FROM 数据库名.架构名.表名'</span>)</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OPENROWSET(<span class="string">'SQLNCLI'</span>, <span class="string">'server=sql服务器名或IP地址;uid=用户名;pwd=密码'</span>,<span class="string">'SELECT * FROM 数据库名.架构名.表名'</span>)</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OPENROWSET(<span class="string">'SQLOLEDB'</span>, <span class="string">'sql服务器名'</span>;'用户名';'密码',数据库名.架构名.表名)</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OPENROWSET(<span class="string">'SQLNCLI'</span>, <span class="string">'sql服务器名'</span>;'用户名';'密码',数据库名.架构名.表名)</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OPENROWSET(<span class="string">'SQLOLEDB'</span>, <span class="string">'sql服务器名'</span>;'用户名';'密码','<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> 数据库名.架构名.表名<span class="string">')</span></span><br><span class="line"><span class="string">SELECT * FROM OPENROWSET('</span>SQLNCLI<span class="string">', '</span><span class="keyword">sql</span>服务器名<span class="string">';'</span>用户名<span class="string">'; '</span>密码<span class="string">','</span><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> 数据库名.架构名.表名<span class="string">')</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>生成本地表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">INTO</span> 表 <span class="keyword">FROM</span> openrowset( <span class="string">'SQLOLEDB '</span>, <span class="string">'sql服务器名 '</span>; '用户名 '; '密码 ',数据库名.dbo.表名)</span><br></pre></td></tr></table></figure>
</li>
<li><p>把本地表导入远程表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> OPENROWSET(<span class="string">'SQLOLEDB'</span>, <span class="string">'server=sql服务器名或IP地址;uid=用户名;pwd=密码'</span>,数据库名.架构名.表名)</span><br><span class="line">   <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> 本地表</span><br></pre></td></tr></table></figure>
</li>
<li><p>关联更新本地表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">	<span class="keyword">UPDATE</span> b</span><br><span class="line">	   <span class="keyword">SET</span> b.列A = a.列A</span><br><span class="line">	  <span class="keyword">FROM</span> OPENROWSET( <span class="string">'SQLOLEDB '</span>, <span class="string">'sql服务器名 '</span>; '用户名 '; '密码 ',数据库名.dbo.表名) AS a</span><br><span class="line">INNER JOIN 本地表 b ON a.column1 = b.column1</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><h5 id="OPENQUERY方法（需要先创建一个链接）"><a href="#OPENQUERY方法（需要先创建一个链接）" class="headerlink" title="OPENQUERY方法（需要先创建一个链接）"></a>OPENQUERY方法（需要先创建一个链接）</h5><ul>
<li><p>查询示例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OPENQUERY(LinkName,<span class="string">'SELECT * FROM 数据库名.架构名.表名'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>把本地表导入远程表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> OPENQUERY(LinkName, <span class="string">'SELECT *  FROM 数据库名.架构名.表名'</span>) <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> 本地表</span><br></pre></td></tr></table></figure>
</li>
<li><p>关联更新本地表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">	<span class="keyword">UPDATE</span> b</span><br><span class="line">	   <span class="keyword">SET</span> b.列A = a.列A</span><br><span class="line">	  <span class="keyword">FROM</span> OPENQUERY(ITSV, <span class="string">'SELECT * FROM 数据库.dbo.表名 '</span>) <span class="keyword">AS</span> a</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> 本地表 b <span class="keyword">ON</span> a.column1 = b.column1</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><h5 id="OPENDATASOURCE方法-不需要用到创建好的链接名。如果连接的实例名不是默认的，需要在”sql服务器名或IP地址”后加上”-实例名”"><a href="#OPENDATASOURCE方法-不需要用到创建好的链接名。如果连接的实例名不是默认的，需要在”sql服务器名或IP地址”后加上”-实例名”" class="headerlink" title="OPENDATASOURCE方法(不需要用到创建好的链接名。如果连接的实例名不是默认的，需要在”sql服务器名或IP地址”后加上”/实例名”)"></a>OPENDATASOURCE方法(不需要用到创建好的链接名。如果连接的实例名不是默认的，需要在”sql服务器名或IP地址”后加上”/实例名”)</h5><ul>
<li><p>查询示例</p>
<ul>
<li><p>Windows认证方式查询(以下方法之一即可)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OPENDATASOURCE(<span class="string">'SQLOLEDB'</span>, <span class="string">'server=sql服务器名或IP地址;Trusted_Connection=yes'</span>).数据库名.架构名.表名</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OPENDATASOURCE(<span class="string">'SQLNCLI'</span>, <span class="string">'server=sql服务器名或IP地址;Trusted_Connection=yes'</span>).数据库名.架构名.表名</span><br></pre></td></tr></table></figure>
</li>
<li><p>SQL认证方式查询(以下方法之一即可)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OPENDATASOURCE(<span class="string">'SQLOLEDB'</span>, <span class="string">'server=sql服务器名或IP地址;uid=用户名;pwd=密码'</span>).数据库名.架构名.表名</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OPENDATASOURCE(<span class="string">'SQLNCLI'</span>, <span class="string">'server=sql服务器名或IP地址;uid=用户名;pwd=密码'</span>).数据库名.架构名.表名</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OPENDATASOURCE(<span class="string">'SQLOLEDB'</span>, <span class="string">'Data Source=sql服务器名或IP地址;uid=用户名;pwd=密码'</span>).数据库名.架构名.表名</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> OPENDATASOURCE(<span class="string">'SQLNCLI'</span>, <span class="string">'Data Source=sql服务器名或IP地址;uid=用户名;pwd=密码'</span>).数据库名.架构名.表名</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>导入示例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> OPENDATASOURCE(<span class="string">'SQLOLEDB'</span>, <span class="string">'server=sql服务器名或IP地址;uid=用户名;pwd=密码'</span>).数据库名.架构名.表名</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> 本地表</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>如果出现如下错误：SQL Server 阻止了对组件“Ad Hoc Distributed Queries”的STATEMENT“OpenRowset/OpenDatasource”的访问，因为此组件已作为此服务器安全配置的一部分而被关闭。系统管理员可以通过使用 sp_configure 启用“Ad Hoc Distributed Queries”。有关启用“Ad Hoc Distributed Queries”<br>则解决办法是参照下面命令：</p>
</blockquote>
<ol>
<li><p>开启Ad Hoc Distributed Queries组件，在sql查询编辑器中执行如下语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">exec sp_configure '<span class="keyword">show</span> <span class="keyword">advanced</span> options<span class="string">',1</span></span><br><span class="line"><span class="string">reconfigure</span></span><br><span class="line"><span class="string">exec sp_configure '</span>Ad Hoc <span class="keyword">Distributed</span> Queries<span class="string">',1</span></span><br><span class="line"><span class="string">reconfigure</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>关闭Ad Hoc Distributed Queries组件，在sql查询编辑器中执行如下语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">exec sp_configure 'Ad Hoc Distributed Queries',0</span><br><span class="line">reconfigure</span><br><span class="line">exec sp_configure '<span class="keyword">show</span> <span class="keyword">advanced</span> options<span class="string">',0</span></span><br><span class="line"><span class="string">reconfigure</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="26-删除数据库下面的所有表"><a href="#26-删除数据库下面的所有表" class="headerlink" title="26. 删除数据库下面的所有表"></a>26. 删除数据库下面的所有表</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> 数据库名(是要删除表的所在的那个数据库的名称)</span><br><span class="line"><span class="keyword">GO</span></span><br><span class="line"><span class="keyword">declare</span> @<span class="keyword">sql</span> <span class="built_in">varchar</span>(<span class="number">8000</span>)</span><br><span class="line"><span class="keyword">while</span> (<span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> sysobjects <span class="keyword">where</span> <span class="keyword">type</span>=<span class="string">'U'</span>)&gt;<span class="number">0</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">SELECT</span> @<span class="keyword">sql</span>=<span class="string">'drop table '</span> + <span class="keyword">name</span></span><br><span class="line"><span class="keyword">FROM</span> sysobjects</span><br><span class="line"><span class="keyword">WHERE</span> (<span class="keyword">type</span> = <span class="string">'U'</span>)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="string">'drop table '</span> + <span class="keyword">name</span></span><br><span class="line">exec(@<span class="keyword">sql</span>) </span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h2 id="27-查看数据库文件使用情况"><a href="#27-查看数据库文件使用情况" class="headerlink" title="27. 查看数据库文件使用情况"></a>27. 查看数据库文件使用情况</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  A.name                                                     <span class="keyword">AS</span> <span class="string">"逻辑名称"</span></span><br><span class="line">       ,<span class="keyword">CONVERT</span>(<span class="built_in">FLOAT</span> ,A.size)             * (<span class="number">8192.0</span>/<span class="number">1024.0</span>)/<span class="number">1024</span>  <span class="keyword">AS</span> <span class="string">"已用大小MB"</span></span><br><span class="line">       ,<span class="keyword">CONVERT</span>(<span class="built_in">FLOAT</span> ,A.maxSize - A.size) * (<span class="number">8192.0</span>/<span class="number">1024.0</span>)/<span class="number">1024</span>  <span class="keyword">AS</span> <span class="string">"可用大小MB"</span></span><br><span class="line">       ,<span class="keyword">CONVERT</span>(<span class="built_in">FLOAT</span> ,A.maxSize)          * (<span class="number">8192.0</span>/<span class="number">1024.0</span>)/<span class="number">1024</span>  <span class="keyword">AS</span> <span class="string">"分配大小MB"</span></span><br><span class="line">       ,A.fileName                                                 <span class="keyword">AS</span> <span class="string">"文件路径"</span></span><br><span class="line">       ,(</span><br><span class="line">         <span class="keyword">SELECT</span>  SA.groupName</span><br><span class="line">           <span class="keyword">FROM</span>  SysFileGroups  SA</span><br><span class="line">          <span class="keyword">WHERE</span>  SA.groupID = A.groupID</span><br><span class="line">        )                                                          <span class="keyword">AS</span> <span class="string">"文件组"</span></span><br><span class="line">       ,<span class="keyword">CASE</span> <span class="keyword">WHEN</span> A.status = <span class="number">1081346</span> <span class="keyword">THEN</span> <span class="string">'磁盘文件'</span>               </span><br><span class="line">             <span class="keyword">WHEN</span> A.status = <span class="number">1081410</span> <span class="keyword">THEN</span> <span class="string">'日志设备'</span></span><br><span class="line">             <span class="keyword">ELSE</span> <span class="keyword">CONVERT</span>(<span class="built_in">VARCHAR</span> ,A.status) <span class="keyword">END</span>                   <span class="keyword">AS</span> <span class="string">"文件类型"</span></span><br><span class="line">  <span class="keyword">FROM</span>  SysFiles  A</span><br></pre></td></tr></table></figure>
<h2 id="28-修改sa的密码"><a href="#28-修改sa的密码" class="headerlink" title="28. 修改sa的密码"></a>28. 修改sa的密码</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXEC sp_password 'OldPassword','NewPassword','sa';</span><br></pre></td></tr></table></figure>
<blockquote>
<p>不知道OldPassword时，可用NULL代替。</p>
</blockquote>
<h2 id="29-查询表的索引"><a href="#29-查询表的索引" class="headerlink" title="29. 查询表的索引"></a>29. 查询表的索引</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">SELECT</span> 表名 = c.name,</span><br><span class="line">         索引名称 = a.name,</span><br><span class="line">         索引字段名 = d.name,</span><br><span class="line">         索引字段位置 = d.colid,</span><br><span class="line">         c.status</span><br><span class="line">    <span class="keyword">FROM</span> sysindexes   a</span><br><span class="line">    <span class="keyword">JOIN</span> sysindexkeys b <span class="keyword">ON</span> a.id = b.id <span class="keyword">AND</span> a.indid = b.indid</span><br><span class="line">    <span class="keyword">JOIN</span> sysobjects   c <span class="keyword">ON</span> b.id = c.id</span><br><span class="line">    <span class="keyword">JOIN</span> syscolumns   d <span class="keyword">ON</span> b.id = d.id <span class="keyword">AND</span> b.colid = d.colid</span><br><span class="line">   <span class="keyword">WHERE</span> a.indid <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="number">0</span>, <span class="number">255</span>)</span><br><span class="line">     <span class="keyword">AND</span> c.xtype = <span class="string">'U'</span></span><br><span class="line">  <span class="comment">-- AND c.status &gt; 0 --查所有用户表</span></span><br><span class="line">     <span class="keyword">AND</span> c.name = <span class="string">'order'</span> <span class="comment">--查指定表</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> c.name,a.name,d.name;</span><br></pre></td></tr></table></figure>
<h2 id="30-查询没有索引的表"><a href="#30-查询没有索引的表" class="headerlink" title="30. 查询没有索引的表"></a>30. 查询没有索引的表</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">SELECT</span> *</span><br><span class="line">    <span class="keyword">FROM</span> sysobjects</span><br><span class="line">   <span class="keyword">WHERE</span> xtype = <span class="string">'U'</span></span><br><span class="line">     <span class="keyword">AND</span> <span class="keyword">name</span> <span class="keyword">NOT</span> <span class="keyword">IN</span> (</span><br><span class="line">	       <span class="keyword">SELECT</span> c.name</span><br><span class="line">	         <span class="keyword">FROM</span> sysindexes   a</span><br><span class="line">	         <span class="keyword">JOIN</span> sysindexkeys b <span class="keyword">ON</span> a.id = b.id <span class="keyword">AND</span> a.indid = b.indid</span><br><span class="line">	         <span class="keyword">JOIN</span> sysobjects   c <span class="keyword">ON</span> b.id = c.id</span><br><span class="line">	         <span class="keyword">JOIN</span> syscolumns   d <span class="keyword">ON</span> b.id = d.id <span class="keyword">AND</span> b.colid = d.colid</span><br><span class="line">	        <span class="keyword">WHERE</span> a.indid <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="number">0</span>, <span class="number">255</span>)</span><br><span class="line">	          <span class="keyword">AND</span> c.xtype = <span class="string">'U'</span></span><br><span class="line">            <span class="comment">--AND c.status &gt; 0 --查所有用户表</span></span><br><span class="line">	        <span class="comment">--AND c.name = 'order' --查指定表</span></span><br><span class="line">         )</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">name</span></span><br></pre></td></tr></table></figure>
<hr>
<h1 id="常识"><a href="#常识" class="headerlink" title="常识"></a>常识</h1><ul>
<li>在SQL查询中，from后最多可以跟256张表或视图</li>
<li>在SQL语句中使用Order by查询时，先排序，后取值</li>
<li>在SQL中，一个字段的最大容量是8000</li>
</ul>

      
    </div>

    
      


    

	<!-- YPN 2020-06-18 增加 每篇文章末尾添加致谢 -->
	<div>
		
			<div>
    
        <div style="color: red;text-align: center;">-------------------本文结束 <i class="fa fa-paw"></i> 感谢您的阅读-------------------</div>
    
</div>
		
	</div>
	
    
    
    

    

    
      
    
    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>坚持原创技术分享，感谢您的支持和鼓励！</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/img/YPN_wechatpay-32x32.png" alt="昜丿捺 微信支付">
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/img/YPN_alipay-32x32.jpg" alt="昜丿捺 支付宝">
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    
	
	<!-- YPN 2020-06-18 增加 版权 -->
	<div>
      
        
<div class="my_post_copyright">
  <script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

  <!-- JS库 sweetalert 可修改路径 -->
  <script src="https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <p><span>本文标题:</span><a href="/2016/11/29/SQL经典语句/">SQL经典语句</a></p>
  <p><span>文章作者:</span><a href="/" title="访问 昜丿捺 的个人博客">昜丿捺</a></p>
  <p><span>发布时间:</span>2016年11月29日 - 15:38:32</p>
  <p><span>最后更新:</span>2021年11月04日 - 09:49:25</p>
  <p><span>原始链接:</span><a href="/2016/11/29/SQL经典语句/" title="SQL经典语句">https://yangpiena.github.io/2016/11/29/SQL经典语句/</a>
    <span class="copy-path" title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="https://yangpiena.github.io/2016/11/29/SQL经典语句/" aria-label="复制成功！"></i></span>
  </p>
  <p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p>
</div>
<script>
    var clipboard = new Clipboard('.fa-clipboard');
    $(".fa-clipboard").click(function(){
      clipboard.on('success', function(){
        swal({
          title: "",
          text: '复制成功',
          icon: "success",
          showConfirmButton: true
          });
    });
    });
</script>

      	  
	</div>
	 
    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/sql/" rel="tag"># sql</a>
          
            <a href="/tags/经典语句/" rel="tag"># 经典语句</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/11/29/SQL获取字符串最后出现的位置/" rel="next" title="SQL获取字符串最后出现的位置">
                <i class="fa fa-chevron-left"></i> SQL获取字符串最后出现的位置
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/12/22/FPSpread属性说明/" rel="prev" title="fpSpread属性说明">
                fpSpread属性说明 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>
  

          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/img/avatar/ironman.png" alt="昜丿捺">
            
              <p class="site-author-name" itemprop="name">昜丿捺</p>
              <p class="site-description motion-element" itemprop="description">
				<!-- 没有阳光，沉默而居 -->
				<!-- YPN 2020-06-19 显示一言经典语句 -->
				<span id="lwlhitokoto"></span>			
			  </p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">85</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">2</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">47</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/yangpiena" title="GitHub &rarr; https://github.com/yangpiena" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://yangpiena.coding.net" title="CODING &rarr; https://yangpiena.coding.net" rel="noopener" target="_blank"><i class="fa fa-fw fa-github-alt"></i>CODING</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://gitee.com/yangpiena" title="Gitee &rarr; https://gitee.com/yangpiena" rel="noopener" target="_blank"><i class="fa fa-fw fa-glide"></i>Gitee</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:yangpiena@gmail.com" title="E-Mail &rarr; mailto:yangpiena@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://weibo.com/yangpiena" title="Weibo &rarr; https://weibo.com/yangpiena" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i>Weibo</a>
                </span>
              
            </div>
          

          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://yangpiena.gitee.io/" title="https://yangpiena.gitee.io/" rel="noopener" target="_blank">昜丿捺(Gitee)</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://yangpiena.github.io/" title="https://yangpiena.github.io/">昜丿捺(GitHub)</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://coding-pages-bucket-407450-1059047-17379-602648-1258146968.cos-website.ap-hongkong.myqcloud.com/" title="http://coding-pages-bucket-407450-1059047-17379-602648-1258146968.cos-website.ap-hongkong.myqcloud.com/" rel="noopener" target="_blank">昜丿捺(Coding)</a>
                  </li>
                
              </ul>
            </div>
          

          
            
          
          

        </div>
	
	
		<!-- YPN Add 2019-03-29 增加背景音乐Aplayer-->
		<!-- 参数如下：（粗体为必填项） -->
		<!-- data-id: 歌曲/专辑/歌单 ID -->	
			<!-- data-server: 音乐平台，支持如下参数 -->
			<!-- netease （网易云音乐） -->
			<!-- tencent （qq音乐） -->
			<!-- xiami （虾米音乐） -->
			<!-- kugou （酷狗音乐） -->
			<!-- baidu （百度音乐） -->	
		<!-- data-type: 请求类型，支持如下参数 -->
			<!-- song （单曲） -->
			<!-- album （专辑） -->
			<!-- playlist （歌单） -->
			<!-- search （搜索） -->
		<!-- data-mode: 播放模式 -->
			<!-- random （随机） -->
			<!-- single （单曲） -->
			<!-- circulation （列表循环） -->
			<!-- order （列表） -->
		<!-- data-autoplay: 自动播放  -->
			<!-- true -->
			<!-- false -->
		<section class="music">
			<div class="content material">
				<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.7.0/dist/APlayer.min.css">
				<div class="aplayer" data-theme="#1BCDFC" data-mode="random" data-server="netease" data-type="playlist" data-list-folded="false" data-id="745065239" data-volume="0.7">
				</div>
				<script src="https://cdn.jsdelivr.net/npm/aplayer@1.7.0/dist/APlayer.min.js"></script>
				<script src="https://cdn.jsdelivr.net/npm/meting@1.1.0/dist/Meting.min.js"></script>
			</div>
		</section>


      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#一-基础篇"><span class="nav-number">1.</span> <span class="nav-text">一. 基础篇</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-创建数据库"><span class="nav-number">1.1.</span> <span class="nav-text">1. 创建数据库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-删除数据库"><span class="nav-number">1.2.</span> <span class="nav-text">2. 删除数据库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-备份sql-server"><span class="nav-number">1.3.</span> <span class="nav-text">3. 备份sql server</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-创建新表"><span class="nav-number">1.4.</span> <span class="nav-text">4. 创建新表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-删除新表"><span class="nav-number">1.5.</span> <span class="nav-text">5. 删除新表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-增加一个列"><span class="nav-number">1.6.</span> <span class="nav-text">6. 增加一个列</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-添加主键"><span class="nav-number">1.7.</span> <span class="nav-text">7. 添加主键</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-创建索引"><span class="nav-number">1.8.</span> <span class="nav-text">8. 创建索引</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-创建视图"><span class="nav-number">1.9.</span> <span class="nav-text">9. 创建视图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-几个简单的基本sql语句"><span class="nav-number">1.10.</span> <span class="nav-text">10. 几个简单的基本sql语句</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-几个高级查询运算词"><span class="nav-number">1.11.</span> <span class="nav-text">11. 几个高级查询运算词</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-使用外连接"><span class="nav-number">1.12.</span> <span class="nav-text">12. 使用外连接</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-分组-Group-by"><span class="nav-number">1.13.</span> <span class="nav-text">13. 分组:Group by</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-对数据库进行操作"><span class="nav-number">1.14.</span> <span class="nav-text">14. 对数据库进行操作</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-如何修改数据库的名称"><span class="nav-number">1.15.</span> <span class="nav-text">15. 如何修改数据库的名称</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#16-查询字段ID最大值的记录"><span class="nav-number">1.16.</span> <span class="nav-text">16. 查询字段ID最大值的记录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#17-查询某一列的重复项内容"><span class="nav-number">1.17.</span> <span class="nav-text">17. 查询某一列的重复项内容</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#18-判断表中是否存在记录"><span class="nav-number">1.18.</span> <span class="nav-text">18. 判断表中是否存在记录</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#二-提升篇"><span class="nav-number">2.</span> <span class="nav-text">二. 提升篇</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-复制表-只复制结构-源表名：a-新表名：b-Access可用"><span class="nav-number">2.1.</span> <span class="nav-text">1. 复制表(只复制结构,源表名：a 新表名：b) (Access可用)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-拷贝表-拷贝数据-源表名：a-目标表名：b-Access可用"><span class="nav-number">2.2.</span> <span class="nav-text">2. 拷贝表(拷贝数据,源表名：a 目标表名：b) (Access可用)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-跨数据库之间表的拷贝-具体数据使用绝对路径-Access可用"><span class="nav-number">2.3.</span> <span class="nav-text">3. 跨数据库之间表的拷贝(具体数据使用绝对路径) (Access可用)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-子查询-表名1：a-表名2：b"><span class="nav-number">2.4.</span> <span class="nav-text">4. 子查询(表名1：a 表名2：b)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-显示文章、提交人和最后回复时间"><span class="nav-number">2.5.</span> <span class="nav-text">5. 显示文章、提交人和最后回复时间</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-外连接查询-表名1：a-表名2：b"><span class="nav-number">2.6.</span> <span class="nav-text">6. 外连接查询(表名1：a 表名2：b)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-在线视图查询-表名1：a"><span class="nav-number">2.7.</span> <span class="nav-text">7. 在线视图查询(表名1：a )</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-between的用法-between限制查询数据范围时包括了边界值-not-between不包括"><span class="nav-number">2.8.</span> <span class="nav-text">8. between的用法,between限制查询数据范围时包括了边界值,not between不包括</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-in-的使用方法"><span class="nav-number">2.9.</span> <span class="nav-text">9. in 的使用方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-两张关联表，删除主表中已经在副表中没有的信息"><span class="nav-number">2.10.</span> <span class="nav-text">10. 两张关联表，删除主表中已经在副表中没有的信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-四表联查问题"><span class="nav-number">2.11.</span> <span class="nav-text">11. 四表联查问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-日程安排提前五分钟提醒"><span class="nav-number">2.12.</span> <span class="nav-text">12. 日程安排提前五分钟提醒</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-一条sql语句搞定数据库分页"><span class="nav-number">2.13.</span> <span class="nav-text">13. 一条sql语句搞定数据库分页</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-前10条记录"><span class="nav-number">2.14.</span> <span class="nav-text">14. 前10条记录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-选择在每一组b值相同的数据中对应的a最大的记录的所有信息-类似这样的用法可以用于论坛每月排行榜-每月热销产品分析-按科目成绩排名-等等"><span class="nav-number">2.15.</span> <span class="nav-text">15. 选择在每一组b值相同的数据中对应的a最大的记录的所有信息(类似这样的用法可以用于论坛每月排行榜,每月热销产品分析,按科目成绩排名,等等.)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#16-包括所有在-TableA-中但不在-TableB和TableC-中的行并消除所有重复行而派生出一个结果表"><span class="nav-number">2.16.</span> <span class="nav-text">16. 包括所有在 TableA 中但不在 TableB和TableC 中的行并消除所有重复行而派生出一个结果表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#17-随机取出10条数据"><span class="nav-number">2.17.</span> <span class="nav-text">17. 随机取出10条数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#18-随机选择记录"><span class="nav-number">2.18.</span> <span class="nav-text">18. 随机选择记录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#19-删除重复记录"><span class="nav-number">2.19.</span> <span class="nav-text">19. 删除重复记录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#20-列出数据库里所有的表名"><span class="nav-number">2.20.</span> <span class="nav-text">20. 列出数据库里所有的表名</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#21-列出表里的所有的列名"><span class="nav-number">2.21.</span> <span class="nav-text">21. 列出表里的所有的列名</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#22-列示type、vender、pcs字段，以type字段排列，case可以方便地实现多重选择，类似select-中的case。"><span class="nav-number">2.22.</span> <span class="nav-text">22. 列示type、vender、pcs字段，以type字段排列，case可以方便地实现多重选择，类似select 中的case。</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#23-初始化表"><span class="nav-number">2.23.</span> <span class="nav-text">23. 初始化表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#24-选择从10到15的记录"><span class="nav-number">2.24.</span> <span class="nav-text">24. 选择从10到15的记录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#25-临时表"><span class="nav-number">2.25.</span> <span class="nav-text">25. 临时表</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#创建临时表"><span class="nav-number">2.25.0.1.</span> <span class="nav-text">创建临时表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#查询临时表"><span class="nav-number">2.25.0.2.</span> <span class="nav-text">查询临时表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#删除临时表"><span class="nav-number">2.25.0.3.</span> <span class="nav-text">删除临时表</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#26-关联表更新"><span class="nav-number">2.26.</span> <span class="nav-text">26. 关联表更新</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#27-查看表的所有外键关系"><span class="nav-number">2.27.</span> <span class="nav-text">27. 查看表的所有外键关系</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#28-删除所有约束"><span class="nav-number">2.28.</span> <span class="nav-text">28. 删除所有约束</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#29-删除数据库所有表"><span class="nav-number">2.29.</span> <span class="nav-text">29. 删除数据库所有表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#30-删除外键约束"><span class="nav-number">2.30.</span> <span class="nav-text">30. 删除外键约束</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#31-查找指定数据库表的列名、数据类型、数据长度、注释"><span class="nav-number">2.31.</span> <span class="nav-text">31. 查找指定数据库表的列名、数据类型、数据长度、注释</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#32-同步表数据"><span class="nav-number">2.32.</span> <span class="nav-text">32. 同步表数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#33-判断某列中是否包含中文字符或者英文字符"><span class="nav-number">2.33.</span> <span class="nav-text">33. 判断某列中是否包含中文字符或者英文字符</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#34-行转列，将多行数据合并成一行（SQL-SERVER-2005以上支持）"><span class="nav-number">2.34.</span> <span class="nav-text">34. 行转列，将多行数据合并成一行（SQL SERVER 2005以上支持）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#35-去除字段中空格、换行符、回车符"><span class="nav-number">2.35.</span> <span class="nav-text">35. 去除字段中空格、换行符、回车符</span></a></li></ol><li class="nav-item nav-level-1"><a class="nav-link" href="#三-技巧篇"><span class="nav-number">3.</span> <span class="nav-text">三. 技巧篇</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-1，1-2的使用，在SQL语句组合时用的较多"><span class="nav-number">3.1.</span> <span class="nav-text">1. 1=1，1=2的使用，在SQL语句组合时用的较多</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-收缩数据库"><span class="nav-number">3.2.</span> <span class="nav-text">2. 收缩数据库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-压缩数据库"><span class="nav-number">3.3.</span> <span class="nav-text">3. 压缩数据库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-转移数据库给新用户以已存在用户权限"><span class="nav-number">3.4.</span> <span class="nav-text">4. 转移数据库给新用户以已存在用户权限</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-检查备份集"><span class="nav-number">3.5.</span> <span class="nav-text">5. 检查备份集</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-修复数据库"><span class="nav-number">3.6.</span> <span class="nav-text">6. 修复数据库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-日志清除"><span class="nav-number">3.7.</span> <span class="nav-text">7. 日志清除</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-更改某个表"><span class="nav-number">3.8.</span> <span class="nav-text">8. 更改某个表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-存储更改全部表"><span class="nav-number">3.9.</span> <span class="nav-text">9. 存储更改全部表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-SQL-SERVER中直接循环写入数据"><span class="nav-number">3.10.</span> <span class="nav-text">10. SQL SERVER中直接循环写入数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-查看数据库属性"><span class="nav-number">3.11.</span> <span class="nav-text">11. 查看数据库属性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-按姓氏笔画排序"><span class="nav-number">3.12.</span> <span class="nav-text">12. 按姓氏笔画排序:</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-数据库加密"><span class="nav-number">3.13.</span> <span class="nav-text">13. 数据库加密:</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-取回表中字段"><span class="nav-number">3.14.</span> <span class="nav-text">14. 取回表中字段:</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-查看硬盘分区"><span class="nav-number">3.15.</span> <span class="nav-text">15. 查看硬盘分区:</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#16-比较A-B表是否相等"><span class="nav-number">3.16.</span> <span class="nav-text">16. 比较A,B表是否相等:</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#17-杀掉所有的事件探察器进程"><span class="nav-number">3.17.</span> <span class="nav-text">17. 杀掉所有的事件探察器进程:</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#18-记录搜索"><span class="nav-number">3.18.</span> <span class="nav-text">18. 记录搜索:</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#19-获取当前数据库中的所有用户表"><span class="nav-number">3.19.</span> <span class="nav-text">19. 获取当前数据库中的所有用户表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#20-获取某一个表的所有字段"><span class="nav-number">3.20.</span> <span class="nav-text">20. 获取某一个表的所有字段</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#21-查看与某一个表相关的视图、存储过程、函数"><span class="nav-number">3.21.</span> <span class="nav-text">21. 查看与某一个表相关的视图、存储过程、函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#22-查看当前数据库中所有存储过程"><span class="nav-number">3.22.</span> <span class="nav-text">22. 查看当前数据库中所有存储过程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#23-查询用户创建的所有数据库"><span class="nav-number">3.23.</span> <span class="nav-text">23. 查询用户创建的所有数据库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#24-查询某一个表的字段和数据类型"><span class="nav-number">3.24.</span> <span class="nav-text">24. 查询某一个表的字段和数据类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#25-不同服务器数据库之间的数据操作"><span class="nav-number">3.25.</span> <span class="nav-text">25. 不同服务器数据库之间的数据操作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#25-1-创建链接服务器"><span class="nav-number">3.25.0.1.</span> <span class="nav-text">25.1 创建链接服务器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#25-2-链接服务器相关数据操作"><span class="nav-number">3.25.0.2.</span> <span class="nav-text">25.2 链接服务器相关数据操作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#25-3-删除链接服务器"><span class="nav-number">3.25.0.3.</span> <span class="nav-text">25.3 删除链接服务器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#25-4-其它连接远程-局域网数据方法：OPENROWSET-OPENQUERY-opendatasource"><span class="nav-number">3.25.0.4.</span> <span class="nav-text">25.4 其它连接远程/局域网数据方法：OPENROWSET/OPENQUERY/opendatasource</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#OPENROWSET方法（不需要用到创建好的链接名。如果连接的实例名不是默认的，需要在”sql服务器名或IP地址”后加上”-实例名”）"><span class="nav-number">3.25.0.4.1.</span> <span class="nav-text">OPENROWSET方法（不需要用到创建好的链接名。如果连接的实例名不是默认的，需要在”sql服务器名或IP地址”后加上”/实例名”）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#OPENQUERY方法（需要先创建一个链接）"><span class="nav-number">3.25.0.4.2.</span> <span class="nav-text">OPENQUERY方法（需要先创建一个链接）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#OPENDATASOURCE方法-不需要用到创建好的链接名。如果连接的实例名不是默认的，需要在”sql服务器名或IP地址”后加上”-实例名”"><span class="nav-number">3.25.0.4.3.</span> <span class="nav-text">OPENDATASOURCE方法(不需要用到创建好的链接名。如果连接的实例名不是默认的，需要在”sql服务器名或IP地址”后加上”/实例名”)</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#26-删除数据库下面的所有表"><span class="nav-number">3.26.</span> <span class="nav-text">26. 删除数据库下面的所有表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#27-查看数据库文件使用情况"><span class="nav-number">3.27.</span> <span class="nav-text">27. 查看数据库文件使用情况</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#28-修改sa的密码"><span class="nav-number">3.28.</span> <span class="nav-text">28. 修改sa的密码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#29-查询表的索引"><span class="nav-number">3.29.</span> <span class="nav-text">29. 查询表的索引</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#30-查询没有索引的表"><span class="nav-number">3.30.</span> <span class="nav-text">30. 查询没有索引的表</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#常识"><span class="nav-number">4.</span> <span class="nav-text">常识</span></a></li></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>	
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2022</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">昜丿捺</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
    <span title="站点总字数">238k</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
    <span title="站点阅读时长">3:37</span>
  
</div>









<!-- YPN 2020-06-18 增加 网站运行时间-->
<div id="days"></div>
<script>
function show_date_time(){
    window.setTimeout("show_date_time()", 1000);
    BirthDay=new Date("11/09/2016 00:00:00");
    today=new Date();
    timeold=(today.getTime()-BirthDay.getTime());
    sectimeold=timeold/1000
    secondsold=Math.floor(sectimeold);
    msPerDay=24*60*60*1000
    e_daysold=timeold/msPerDay
    daysold=Math.floor(e_daysold);
    e_hrsold=(e_daysold-daysold)*24;
    hrsold=setzero(Math.floor(e_hrsold));
    e_minsold=(e_hrsold-hrsold)*60;
    minsold=setzero(Math.floor((e_hrsold-hrsold)*60));
    seconds=setzero(Math.floor((e_minsold-minsold)*60));
    document.getElementById('days').innerHTML="网站已运行 "+daysold+" 天 "+hrsold+" 小时 "+minsold+" 分 "+seconds+" 秒";
}
function setzero(i) {
    if (i<10) {
        i="0" + i
    };
    return i;
}
show_date_time();
</script>
        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv" title="总访客量">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="site-pv" title="总访问量">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>












  















  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script src="/js/src/utils.js?v=6.7.0"></script>

  <script src="/js/src/motion.js?v=6.7.0"></script>



  
  


  <script src="/js/src/affix.js?v=6.7.0"></script>

  <script src="/js/src/schemes/pisces.js?v=6.7.0"></script>



  
  <script src="/js/src/scrollspy.js?v=6.7.0"></script>
<script src="/js/src/post-details.js?v=6.7.0"></script>



  


  <script src="/js/src/bootstrap.js?v=6.7.0"></script>



  



  











  

  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  
  

  
  

  


  

  

  

  

  

  

  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
    }

    .highlight-wrap:hover .copy-btn,
    .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>
  <script>
    $('.highlight').each(function (i, e) {
      var $wrap = $('<div>').addClass('highlight-wrap');
      $(e).after($wrap);
      $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function (e) {
        var code = $(this).parent().find('.code').find('.line').map(function (i, e) {
          return $(e).text();
        }).toArray().join('\n');
        var ta = document.createElement('textarea');
        var range = document.createRange(); //For Chrome
        var sel = window.getSelection(); //For Chrome
        var yPosition = window.pageYOffset || document.documentElement.scrollTop;
        ta.style.top = yPosition + 'px'; //Prevent page scroll
        ta.style.position = 'absolute';
        ta.style.opacity = '0';
        ta.value = code;
        ta.textContent = code; //For FireFox
        ta.contentEditable = true;
        ta.readOnly = false;
        document.body.appendChild(ta);
        range.selectNode(ta);
        sel.removeAllRanges();
        sel.addRange(range);
        ta.setSelectionRange(0, code.length);
        var result = document.execCommand('copy');
        
          if (result) $(this).text('复制成功');
          else $(this).text('复制失败');
        
        ta.blur(); //For iOS
        $(this).blur();
      })).on('mouseleave', function (e) {
        var $b = $(this).find('.copy-btn');
        setTimeout(function () {
          $b.text('复制');
        }, 300);
      }).append(e);
    })
  </script>


  

  
  
    <script type="text/javascript" src="/js/ypn.js/text.js"></script>
  


<!-- 动态线条背景 -->
<script type="text/javascript" color="235,178,178" opacity="0.7" zindex="-2" count="100" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>

<!--2017-10-06 YPN Add 添加输入框特效。 -->
<script src="/js/ypn.js/activate-power-mode.js"></script>
<script>
  POWERMODE.colorful = true;  // 控制开启/开启礼花特效  
  POWERMODE.shake    = false; // 控制开启/关闭屏幕震动特效  
  document.body.addEventListener('input', POWERMODE);
</script>

<!-- 崩溃欺骗 -->
<script type="text/javascript" src="/js/ypn.js/crash-cheat.js"></script>

<!-- 收藏页搜索按钮动作 -->
<script type="text/javascript" src="/js/ypn.js/searchButton.js"></script>

<!-- 一言 -->
<script type="text/javascript" src="/js/ypn.js/yiYanJingDianYuJu.js"></script>

<!-- 图片点击放大效果 -->
<script type="text/javascript" src="/js/ypn.js/image.js"></script>

<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"left","width":70,"height":90,"hOffset":0,"vOffset":-20},"mobile":{"show":false}});</script></body>
</html>
