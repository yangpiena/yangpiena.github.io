<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="没有阳光，沉默而居">
    <meta name="keyword" content="">
    <link rel="shortcut icon" href="/img/ironman-draw.png">
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <title>
        
          【SQL】经典语句 - 昜丿捺 | Blog
        
    </title>

    <link rel="canonical" href="http://www.yangpiena.com/SQL/【SQL】经典语句/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS --> 
    <link rel="stylesheet" href="/css/beantech.min.css">

    <link rel="stylesheet" href="/css/donate.css">
    
    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css">

    <link rel="stylesheet" href="/css/widget.css">

    <link rel="stylesheet" href="/css/rocket.css">

    <link rel="stylesheet" href="/css/signature.css">

    <link rel="stylesheet" href="/css/toc.css">

    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">
	<!-- Modified by Yu-Hsuan Yen -->
<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        
            background-image: url('/img/article_header/article_bg.jpg')
            /*post*/
        
    }
    
</style>

<header class="intro-header">
    <!-- Signature -->
    <div id="signature">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                
                    <div class="post-heading">
                        <div class="tags">
                            
                              <a class="tag" href="/tags/#SQL" title="SQL">SQL</a>
                            
                              <a class="tag" href="/tags/#经典语句" title="经典语句">经典语句</a>
                            
                        </div>
                        <h1>【SQL】经典语句</h1>
                        <h2 class="subheading"></h2>
                        <span class="meta">
                            Posted by 昜丿捺 on
                            2016-11-29
                        </span>
                    </div>
                


                </div>
            </div>
        </div>
    </div>
</header>

	
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">昜丿捺</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    

                        
                    

                        
                        <li>
                            <a href="/archive/">归档</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/about/">关于</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">标签</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/links/">收藏夹</a>
                        </li>
                        
                    

                        
                    

                        
                        <li>
                            <a href="/photos/">相册</a>
                        </li>
                        
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    <!-- Modify by Yu-Hsuan Yen -->

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <h1 id="一-基础篇"><a href="#一-基础篇" class="headerlink" title="一. 基础篇"></a>一. 基础篇</h1><h2 id="1-创建数据库"><a href="#1-创建数据库" class="headerlink" title="1. 创建数据库"></a>1. 创建数据库</h2><pre><code>CREATE DATABASE database-name
</code></pre><h2 id="2-删除数据库"><a href="#2-删除数据库" class="headerlink" title="2. 删除数据库"></a>2. 删除数据库</h2><pre><code>drop database dbname
</code></pre><h2 id="3-备份sql-server"><a href="#3-备份sql-server" class="headerlink" title="3. 备份sql server"></a>3. 备份sql server</h2><pre><code>创建 备份数据的 device
USE master
EXEC sp_addumpdevice &apos;disk&apos;, &apos;testBack&apos;, &apos;c:\mssql7backup\MyNwind_1.dat&apos;
开始 备份
BACKUP DATABASE pubs TO testBack 
</code></pre><a id="more"></a>
<h2 id="4-创建新表"><a href="#4-创建新表" class="headerlink" title="4. 创建新表"></a>4. 创建新表</h2><pre><code>create table tabname(col1 type1 [not null] [primary key],col2 type2 [not null],..)
</code></pre><p>根据已有的表创建新表：</p>
<pre><code>A：create table tab_new like tab_old (使用旧表创建新表)
B：create table tab_new as select col1,col2… from tab_old definition only
</code></pre><h2 id="5-删除新表"><a href="#5-删除新表" class="headerlink" title="5. 删除新表"></a>5. 删除新表</h2><pre><code>drop table tabname
</code></pre><h2 id="6-增加一个列"><a href="#6-增加一个列" class="headerlink" title="6. 增加一个列"></a>6. 增加一个列</h2><pre><code>Alter table tabname add column col type
</code></pre><blockquote>
<p>注：列增加后将不能删除。DB2中列加上后数据类型也不能改变，唯一能改变的是增加varchar类型的长度。</p>
</blockquote>
<h2 id="7-添加主键"><a href="#7-添加主键" class="headerlink" title="7. 添加主键"></a>7. 添加主键</h2><pre><code>ALTER TABLE tabname ADD PRIMARY KEY (col)
</code></pre><p>删除主键</p>
<pre><code>ALTER TABLE tabname DROP PRIMARY KEY (col)
</code></pre><h2 id="8-创建索引"><a href="#8-创建索引" class="headerlink" title="8. 创建索引"></a>8. 创建索引</h2><pre><code>create [unique] index idxname on tabname(col….) 
</code></pre><p>删除索引</p>
<pre><code>drop index idxname
</code></pre><blockquote>
<p>注：索引是不可更改的，想更改必须删除重新建。</p>
</blockquote>
<h2 id="9-创建视图"><a href="#9-创建视图" class="headerlink" title="9. 创建视图"></a>9. 创建视图</h2><pre><code>create view viewname as select statement 
</code></pre><p>删除视图</p>
<pre><code>drop view viewname
</code></pre><h2 id="10-几个简单的基本sql语句"><a href="#10-几个简单的基本sql语句" class="headerlink" title="10. 几个简单的基本sql语句"></a>10. 几个简单的基本sql语句</h2><p>选择</p>
<pre><code>select * from table1 where 范围
</code></pre><p>插入</p>
<pre><code>insert into table1(field1,field2) values(value1,value2)
</code></pre><p>删除</p>
<pre><code>delete from table1 where 范围
</code></pre><p>更新</p>
<pre><code>update table1 set field1=value1 where 范围
</code></pre><p>查找</p>
<pre><code>select * from table1 where field1 like ’%value1%’
</code></pre><p>排序</p>
<pre><code>select * from table1 order by field1,field2 [desc]
</code></pre><p>总数</p>
<pre><code>select count as totalcount from table1
</code></pre><p>求和</p>
<pre><code>select sum(field1) as sumvalue from table1
</code></pre><p>平均</p>
<pre><code>select avg(field1) as avgvalue from table1
</code></pre><p>最大</p>
<pre><code>select max(field1) as maxvalue from table1
</code></pre><p>最小</p>
<pre><code>select min(field1) as minvalue from table1
</code></pre><h2 id="11-几个高级查询运算词"><a href="#11-几个高级查询运算词" class="headerlink" title="11. 几个高级查询运算词"></a>11. 几个高级查询运算词</h2><ul>
<li>A： UNION 运算符<br>UNION 运算符通过组合其他两个结果表（例如 TABLE1 和 TABLE2）并消去表中任何重复行而派生出一个结果表。当 ALL 随 UNION一起使用时（即 UNION ALL），不消除重复行。两种情况下，派生表的每一行不是来自 TABLE1 就是来自 TABLE2。 </li>
<li>B： EXCEPT 运算符<br>EXCEPT 运算符通过包括所有在 TABLE1 中但不在 TABLE2 中的行并消除所有重复行而派生出一个结果表。当 ALL 随 EXCEPT 一起使用时 (EXCEPT ALL)，不消除重复行。 </li>
<li>C： INTERSECT 运算符<br>INTERSECT 运算符通过只包括 TABLE1 和 TABLE2 中都有的行并消除所有重复行而派生出一个结果表。当 ALL 随 INTERSECT 一起使用时 (INTERSECT ALL)，不消除重复行。 <blockquote>
<p>注：使用运算词的几个查询结果行必须是一致的。</p>
</blockquote>
</li>
</ul>
<h2 id="12-使用外连接"><a href="#12-使用外连接" class="headerlink" title="12. 使用外连接"></a>12. 使用外连接</h2><ul>
<li>A. left （outer） join：<br>左外连接（左连接）：结果集几包括连接表的匹配行，也包括左连接表的所有行。 </li>
</ul>
<pre><code>select a.a, a.b, a.c, b.c, b.d, b.f from a LEFT OUT JOIN b ON a.a = b.c
</code></pre><ul>
<li>B：right （outer） join:<br>右外连接(右连接)：结果集既包括连接表的匹配连接行，也包括右连接表的所有行。 </li>
<li>C：full/cross （outer） join：<br>全外连接：不仅包括符号连接表的匹配行，还包括两个连接表中的所有记录。</li>
</ul>
<h2 id="13-分组-Group-by"><a href="#13-分组-Group-by" class="headerlink" title="13. 分组:Group by"></a>13. 分组:Group by</h2><p>一张表，一旦分组 完成后，查询后只能得到组相关的信息。<br>组相关的信息：（统计信息） count,sum,max,min,avg 分组的标准)<br>在SQLServer中分组时：不能以text,ntext,image类型的字段作为分组依据<br>在selecte统计函数中的字段，不能和普通的字段放在一起；</p>
<h2 id="14-对数据库进行操作"><a href="#14-对数据库进行操作" class="headerlink" title="14. 对数据库进行操作"></a>14. 对数据库进行操作</h2><p>分离数据库： sp_detach_db; 附加数据库：sp_attach_db 后接表明，附加需要完整的路径名</p>
<h2 id="15-如何修改数据库的名称"><a href="#15-如何修改数据库的名称" class="headerlink" title="15. 如何修改数据库的名称"></a>15. 如何修改数据库的名称</h2><p>sp_renamedb ‘old_name’, ‘new_name’</p>
<h2 id="16-查询字段ID最大值的记录"><a href="#16-查询字段ID最大值的记录" class="headerlink" title="16. 查询字段ID最大值的记录"></a>16. 查询字段ID最大值的记录</h2><p>无索引</p>
<pre><code>select time from table t1 where not exists (select 1 from table where id &gt; t1.id) 
</code></pre><p>有索引</p>
<pre><code>select time from table where id in (select max(id) from table)
</code></pre><h2 id="17-查询某一列的重复项内容"><a href="#17-查询某一列的重复项内容" class="headerlink" title="17. 查询某一列的重复项内容"></a>17. 查询某一列的重复项内容</h2><pre><code>SELECT * FROM documentation AS A WHERE (SELECT COUNT(*) FROM documentation WHERE fileName=A.fileName)&gt;1 
</code></pre><h2 id="18-判断表中是否存在记录"><a href="#18-判断表中是否存在记录" class="headerlink" title="18. 判断表中是否存在记录"></a>18. 判断表中是否存在记录</h2><pre><code>SELECT COUNT (*) FROM tableName WHERE conditions
</code></pre><hr>
<h1 id="二-提升篇"><a href="#二-提升篇" class="headerlink" title="二. 提升篇"></a>二. 提升篇</h1><h2 id="1-复制表-只复制结构-源表名：a-新表名：b-Access可用"><a href="#1-复制表-只复制结构-源表名：a-新表名：b-Access可用" class="headerlink" title="1. 复制表(只复制结构,源表名：a 新表名：b) (Access可用)"></a>1. 复制表(只复制结构,源表名：a 新表名：b) (Access可用)</h2><p>法一</p>
<pre><code>select * into b from a where 1&lt;&gt;1（仅用于SQlServer）
</code></pre><p>法二</p>
<pre><code>select top 0 * into b from a
</code></pre><h2 id="2-拷贝表-拷贝数据-源表名：a-目标表名：b-Access可用"><a href="#2-拷贝表-拷贝数据-源表名：a-目标表名：b-Access可用" class="headerlink" title="2. 拷贝表(拷贝数据,源表名：a 目标表名：b) (Access可用)"></a>2. 拷贝表(拷贝数据,源表名：a 目标表名：b) (Access可用)</h2><pre><code>insert into b(a, b, c) select d,e,f from b;
</code></pre><h2 id="3-跨数据库之间表的拷贝-具体数据使用绝对路径-Access可用"><a href="#3-跨数据库之间表的拷贝-具体数据使用绝对路径-Access可用" class="headerlink" title="3. 跨数据库之间表的拷贝(具体数据使用绝对路径) (Access可用)"></a>3. 跨数据库之间表的拷贝(具体数据使用绝对路径) (Access可用)</h2><pre><code>insert into b(a, b, c) select d,e,f from b in ‘具体数据库’ where 条件
</code></pre><p>例子：..from b in ‘“&amp;Server.MapPath(“.”)&amp;”\data.mdb” &amp;”‘ where..</p>
<h2 id="4-子查询-表名1：a-表名2：b"><a href="#4-子查询-表名1：a-表名2：b" class="headerlink" title="4. 子查询(表名1：a 表名2：b)"></a>4. 子查询(表名1：a 表名2：b)</h2><pre><code>select a,b,c from a where a IN (select d from b ) 或者: select a,b,c from a where a IN (1,2,3)
</code></pre><h2 id="5-显示文章、提交人和最后回复时间"><a href="#5-显示文章、提交人和最后回复时间" class="headerlink" title="5. 显示文章、提交人和最后回复时间"></a>5. 显示文章、提交人和最后回复时间</h2><pre><code>select a.title,a.username,b.adddate from table a,(select max(adddate) adddate from table where table.title=a.title) b
</code></pre><h2 id="6-外连接查询-表名1：a-表名2：b"><a href="#6-外连接查询-表名1：a-表名2：b" class="headerlink" title="6. 外连接查询(表名1：a 表名2：b)"></a>6. 外连接查询(表名1：a 表名2：b)</h2><pre><code>select a.a, a.b, a.c, b.c, b.d, b.f from a LEFT OUT JOIN b ON a.a = b.c
</code></pre><h2 id="7-在线视图查询-表名1：a"><a href="#7-在线视图查询-表名1：a" class="headerlink" title="7. 在线视图查询(表名1：a )"></a>7. 在线视图查询(表名1：a )</h2><pre><code>select * from (SELECT a,b,c FROM a) T where t.a &gt; 1;
</code></pre><h2 id="8-between的用法-between限制查询数据范围时包括了边界值-not-between不包括"><a href="#8-between的用法-between限制查询数据范围时包括了边界值-not-between不包括" class="headerlink" title="8. between的用法,between限制查询数据范围时包括了边界值,not between不包括"></a>8. between的用法,between限制查询数据范围时包括了边界值,not between不包括</h2><pre><code>select * from table1 where time between time1 and time2
select a,b,c, from table1 where a not between 数值1 and 数值2
</code></pre><h2 id="9-in-的使用方法"><a href="#9-in-的使用方法" class="headerlink" title="9. in 的使用方法"></a>9. in 的使用方法</h2><pre><code>select * from table1 where a [not] in (‘值1’,’值2’,’值4’,’值6’)
</code></pre><h2 id="10-两张关联表，删除主表中已经在副表中没有的信息"><a href="#10-两张关联表，删除主表中已经在副表中没有的信息" class="headerlink" title="10. 两张关联表，删除主表中已经在副表中没有的信息"></a>10. 两张关联表，删除主表中已经在副表中没有的信息</h2><pre><code>delete from table1 where not exists ( select * from table2 where table1.field1=table2.field1 )
</code></pre><h2 id="11-四表联查问题"><a href="#11-四表联查问题" class="headerlink" title="11. 四表联查问题"></a>11. 四表联查问题</h2><pre><code>select * from a left inner join b on a.a=b.b right inner join c on a.a=c.c inner join d on a.a=d.d where .....
</code></pre><h2 id="12-日程安排提前五分钟提醒"><a href="#12-日程安排提前五分钟提醒" class="headerlink" title="12. 日程安排提前五分钟提醒"></a>12. 日程安排提前五分钟提醒</h2><pre><code>select * from 日程安排 where datediff(&apos;minute&apos;,f开始时间,getdate())&gt;5
</code></pre><h2 id="13-一条sql语句搞定数据库分页"><a href="#13-一条sql语句搞定数据库分页" class="headerlink" title="13. 一条sql语句搞定数据库分页"></a>13. 一条sql语句搞定数据库分页</h2><pre><code>select top 10 b.* from (select top 20 主键字段,排序字段 from 表名 order by 排序字段 desc) a,表名 b where b.主键字段 = a.主键字段 order by a.排序字段
</code></pre><p>关于数据库分页：</p>
<pre><code>declare @start int,@end int
@sql nvarchar(600)
set @sql=’select top’+str(@end-@start+1)+’+from T where rid not in(select top’+str(@str-1)+’Rid from T where Rid&gt;-1)’
exec sp_executesql @sql
</code></pre><blockquote>
<p>注意：在top后不能直接跟一个变量，所以在实际应用中只有这样的进行特殊的处理。Rid为一个标识列，如果top后还有具体的字段，这样做是非常有好处的。因为这样可以避免 top的字段如果是逻辑索引的，查询的结果后实际表中的不一致（逻辑索引中的数据有可能和数据表中的不一致，而查询时如果处在索引则首先查询索引）</p>
</blockquote>
<h2 id="14-前10条记录"><a href="#14-前10条记录" class="headerlink" title="14. 前10条记录"></a>14. 前10条记录</h2><pre><code>select top 10 * form table1 where 范围
</code></pre><h2 id="15-选择在每一组b值相同的数据中对应的a最大的记录的所有信息-类似这样的用法可以用于论坛每月排行榜-每月热销产品分析-按科目成绩排名-等等"><a href="#15-选择在每一组b值相同的数据中对应的a最大的记录的所有信息-类似这样的用法可以用于论坛每月排行榜-每月热销产品分析-按科目成绩排名-等等" class="headerlink" title="15. 选择在每一组b值相同的数据中对应的a最大的记录的所有信息(类似这样的用法可以用于论坛每月排行榜,每月热销产品分析,按科目成绩排名,等等.)"></a>15. 选择在每一组b值相同的数据中对应的a最大的记录的所有信息(类似这样的用法可以用于论坛每月排行榜,每月热销产品分析,按科目成绩排名,等等.)</h2><pre><code>select a,b,c from tablename ta where a=(select max(a) from tablename tb where tb.b=ta.b)
</code></pre><h2 id="16-包括所有在-TableA-中但不在-TableB和TableC-中的行并消除所有重复行而派生出一个结果表"><a href="#16-包括所有在-TableA-中但不在-TableB和TableC-中的行并消除所有重复行而派生出一个结果表" class="headerlink" title="16. 包括所有在 TableA 中但不在 TableB和TableC 中的行并消除所有重复行而派生出一个结果表"></a>16. 包括所有在 TableA 中但不在 TableB和TableC 中的行并消除所有重复行而派生出一个结果表</h2><pre><code>(select a from tableA ) except (select a from tableB) except (select a from tableC)
</code></pre><h2 id="17-随机取出10条数据"><a href="#17-随机取出10条数据" class="headerlink" title="17. 随机取出10条数据"></a>17. 随机取出10条数据</h2><pre><code>select top 10 * from tablename order by newid()
</code></pre><h2 id="18-随机选择记录"><a href="#18-随机选择记录" class="headerlink" title="18. 随机选择记录"></a>18. 随机选择记录</h2><pre><code>select newid()
</code></pre><h2 id="19-删除重复记录"><a href="#19-删除重复记录" class="headerlink" title="19. 删除重复记录"></a>19. 删除重复记录</h2><ul>
<li>方法一：</li>
</ul>
<pre><code>delete from tablename where id not in (select max(id) from tablename group by col1,col2,...)
</code></pre><ul>
<li>方法二：</li>
</ul>
<pre><code>select distinct * into temp from tablename
delete from tablename
insert into tablename select * from temp
</code></pre><blockquote>
<p>评价： 这种操作牵连大量的数据的移动，这种做法不适合大容量的数据操作</p>
</blockquote>
<ul>
<li>方法三： 例如：在一个外部表中导入数据，由于某些原因第一次只导入了一部分，但很难判断具体位置，这样只有在下一次全部导入，这样也就产生好多重复的字段，怎样删除重复字段</li>
</ul>
<pre><code>alter table tablename
add column_b int identity(1,1)    --添加一个自增列
delete from tablename where column_b not in(
select max(column_b) from tablename group by column1,column2,...)
alter table tablename drop column column_b
</code></pre><h2 id="20-列出数据库里所有的表名"><a href="#20-列出数据库里所有的表名" class="headerlink" title="20. 列出数据库里所有的表名"></a>20. 列出数据库里所有的表名</h2><pre><code>select name from sysobjects where type=&apos;U&apos; // U代表用户
</code></pre><h2 id="21-列出表里的所有的列名"><a href="#21-列出表里的所有的列名" class="headerlink" title="21. 列出表里的所有的列名"></a>21. 列出表里的所有的列名</h2><pre><code>select name from syscolumns where id=object_id(&apos;TableName&apos;)
</code></pre><h2 id="22-列示type、vender、pcs字段，以type字段排列，case可以方便地实现多重选择，类似select-中的case。"><a href="#22-列示type、vender、pcs字段，以type字段排列，case可以方便地实现多重选择，类似select-中的case。" class="headerlink" title="22. 列示type、vender、pcs字段，以type字段排列，case可以方便地实现多重选择，类似select 中的case。"></a>22. 列示type、vender、pcs字段，以type字段排列，case可以方便地实现多重选择，类似select 中的case。</h2><pre><code>select type,sum(case vender when &apos;A&apos; then pcs else 0 end),sum(case vender when &apos;C&apos; then pcs else 0 end),sum(case vender when &apos;B&apos; then pcs else 0 end) FROM tablename group by type
</code></pre><p>显示结果：</p>
<pre><code>type vender pcs
电脑 A 1
电脑 A 1
光盘 B 2
光盘 A 2
手机 B 3
手机 C 3
</code></pre><h2 id="23-初始化-表table1"><a href="#23-初始化-表table1" class="headerlink" title="23. 初始化 表table1"></a>23. 初始化 表table1</h2><pre><code>TRUNCATE TABLE table1
</code></pre><h2 id="24-选择从10到15的记录"><a href="#24-选择从10到15的记录" class="headerlink" title="24. 选择从10到15的记录"></a>24. 选择从10到15的记录</h2><pre><code>select top 5 * from (select top 15 * from table order by id asc) table_别名 order by id desc
</code></pre><h2 id="25-创建临时表"><a href="#25-创建临时表" class="headerlink" title="25. 创建临时表"></a>25. 创建临时表</h2><ul>
<li>方法一：</li>
</ul>
<pre><code>create table #临时表名(字段1 约束条件,
                       字段2 约束条件,
                      .....)
create table ##临时表名(字段1 约束条件,
                        字段2 约束条件,
                        .....)
</code></pre><p>例：</p>
<pre><code>create table #Tmp --创建临时表#Tmp
(
    ID   int IDENTITY (1,1)     not null, --创建列ID,并且每次新增一条记录就会加1
    WokNo                varchar(50),   
    primary key (ID)      --定义ID为临时表#Tmp的主键      
);
</code></pre><ul>
<li>方法二：</li>
</ul>
<pre><code>select * into #临时表名 from 你的表;
select * into ##临时表名 from 你的表;
</code></pre><blockquote>
<p>注：以上的#代表局部临时表，##代表全局临时表<br>查询临时表</p>
</blockquote>
<pre><code>select * from #临时表名;
select * from ##临时表名;
</code></pre><p>删除临时表</p>
<pre><code>drop table #临时表名;
drop table ##临时表名;
</code></pre><h2 id="26-关联表更新"><a href="#26-关联表更新" class="headerlink" title="26. 关联表更新"></a>26. 关联表更新</h2><pre><code>UPDATE A SET A.b=B.d FROM tableA A INNER JOIN tableB B ON A.a = B.a
</code></pre><h2 id="27-查看表的所有外键关系"><a href="#27-查看表的所有外键关系" class="headerlink" title="27. 查看表的所有外键关系"></a>27. 查看表的所有外键关系</h2><pre><code>select t1.*,t2.name,t3.name from dbo.sysforeignkeys t1 left join sysobjects t2 on t1.fkeyid=t2.id 
           left join sysobjects t3 on t1.rkeyid=t3.id where t3.name=&apos;表名 &apos;
</code></pre><h2 id="28-删除所有约束"><a href="#28-删除所有约束" class="headerlink" title="28. 删除所有约束"></a>28. 删除所有约束</h2><pre><code>DECLARE c1 cursor for
    select &apos;alter table [&apos;+ object_name(parent_obj) + &apos;] drop constraint [&apos;+name+&apos;]; &apos;
    from sysobjects
    where xtype = &apos;F&apos;
open c1
declare @c1 varchar(8000)
fetch next from c1 into @c1
while(@@fetch_status=0)
    begin
        exec(@c1)
        fetch next from c1 into @c1
    end
close c1
deallocate c1
</code></pre><h2 id="29-删除数据库所有表"><a href="#29-删除数据库所有表" class="headerlink" title="29. 删除数据库所有表"></a>29. 删除数据库所有表</h2><pre><code>declare @tname varchar(8000)
set @tname=&apos;&apos;
select @tname=@tname + Name + &apos;,&apos; from sysobjects where xtype=&apos;U&apos;
select @tname=&apos;drop table &apos; + left(@tname,len(@tname)-1)
exec(@tname)
</code></pre><h2 id="30-删除外键约束"><a href="#30-删除外键约束" class="headerlink" title="30. 删除外键约束"></a>30. 删除外键约束</h2><p>得到某个表被哪些外键引用，并且显示出外键表的表名</p>
<pre><code>SELECT
    fk.name,
    fk.object_id,
    OBJECT_NAME(fk.parent_object_id) AS referenceTableName
FROM
    sys.foreign_keys AS fk
JOIN sys.objects AS o ON fk.referenced_object_id = o.object_id
WHERE
    o.name = &apos;ATTACHMENTDOC&apos;;
</code></pre><p>通过外键表的表名和外键名称执行以下语句即可删除外键</p>
<pre><code>ALTER TABLE dbo.CONTRACTINFO DROP CONSTRAINT FK_CONTRACTINFO_ATTACHMENTDOC
</code></pre><h2 id="31-查找指定数据库表的字段名，类型，注释"><a href="#31-查找指定数据库表的字段名，类型，注释" class="headerlink" title="31. 查找指定数据库表的字段名，类型，注释"></a>31. 查找指定数据库表的字段名，类型，注释</h2><pre><code>    SELECT c.object_id, c.name AS cname, t.name AS tname, is_computed AS isComputed,
           (SELECT VALUE
              FROM sys.extended_properties AS ex
             WHERE ex.major_id = c.object_id AND ex.minor_id = c.column_id) AS notes
      FROM sys.columns AS c
INNER JOIN sys.tables  AS ta ON c.object_id = ta.object_id
INNER JOIN (SELECT name, system_type_id
              FROM sys.types
             WHERE name &lt;&gt; &apos;sysname&apos;) AS t ON c.system_type_id = t.system_type_id
     WHERE ta.name = &apos;指定数据库表&apos;
  ORDER BY c.column_id
</code></pre><h2 id="32-同步表数据"><a href="#32-同步表数据" class="headerlink" title="32. 同步表数据"></a>32. 同步表数据</h2><pre><code>INSERT 表2 
SELECT * FROM 表1 AS a WHERE NOT EXISTS(SELECT 1 FROM 表2 WHERE ID = a.ID);
</code></pre><h2 id="33-判断某列中是否包含中文字符或者英文字符"><a href="#33-判断某列中是否包含中文字符或者英文字符" class="headerlink" title="33. 判断某列中是否包含中文字符或者英文字符"></a>33. 判断某列中是否包含中文字符或者英文字符</h2><pre><code>SELECT * FROM 表名 WHERE 某列 LIKE &apos;%[吖-座]%&apos;
SELECT * FROM 表名 WHERE 某列 LIKE &apos;%[a-z]%&apos;
</code></pre><h2 id="34-行转列，将多行数据合并成一行（SQL-SERVER-2005以上支持）"><a href="#34-行转列，将多行数据合并成一行（SQL-SERVER-2005以上支持）" class="headerlink" title="34. 行转列，将多行数据合并成一行（SQL SERVER 2005以上支持）"></a>34. 行转列，将多行数据合并成一行（SQL SERVER 2005以上支持）</h2><p>例如表Table1中有两列数据：</p>
<pre><code>code        name
AAA         姓名1
AAA         姓名2
AAA         姓名3
BBB         姓名4
BBB         姓名5
</code></pre><p>行转列，想变成如下格式：</p>
<pre><code>code        name
AAA         姓名1,姓名2,姓名3
BBB         姓名4,姓名5
</code></pre><p>可用如下SQL实现：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">SELECT</span> code, <span class="keyword">name</span> = (<span class="keyword">STUFF</span>((<span class="keyword">SELECT</span> <span class="string">','</span> + <span class="keyword">name</span> </span><br><span class="line">                                <span class="keyword">FROM</span> Table1 </span><br><span class="line">                               <span class="keyword">WHERE</span> code = a.code <span class="keyword">FOR</span> <span class="keyword">xml</span> <span class="keyword">PATH</span>(<span class="string">''</span>)),<span class="number">1</span>,<span class="number">1</span>,<span class="string">''</span>))</span><br><span class="line">    <span class="keyword">FROM</span> Table1 a </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> code</span><br></pre></td></tr></table></figure></p>
<hr>
<h1 id="三-技巧篇"><a href="#三-技巧篇" class="headerlink" title="三. 技巧篇"></a>三. 技巧篇</h1><h2 id="1-1-1，1-2的使用，在SQL语句组合时用的较多"><a href="#1-1-1，1-2的使用，在SQL语句组合时用的较多" class="headerlink" title="1. 1=1，1=2的使用，在SQL语句组合时用的较多"></a>1. 1=1，1=2的使用，在SQL语句组合时用的较多</h2><p>“where 1=1” 表示选择全部<br>“where 1=2” 表示全部不选</p>
<h2 id="2-收缩数据库"><a href="#2-收缩数据库" class="headerlink" title="2. 收缩数据库"></a>2. 收缩数据库</h2><p>重建索引</p>
<pre><code>DBCC REINDEX
DBCC INDEXDEFRAG
</code></pre><p>收缩数据和日志</p>
<pre><code>DBCC SHRINKDB
DBCC SHRINKFILE
</code></pre><h2 id="3-压缩数据库"><a href="#3-压缩数据库" class="headerlink" title="3. 压缩数据库"></a>3. 压缩数据库</h2><pre><code>dbcc shrinkdatabase(dbname)
</code></pre><h2 id="4-转移数据库给新用户以已存在用户权限"><a href="#4-转移数据库给新用户以已存在用户权限" class="headerlink" title="4. 转移数据库给新用户以已存在用户权限"></a>4. 转移数据库给新用户以已存在用户权限</h2><pre><code>exec sp_change_users_login &apos;update_one&apos;,&apos;newname&apos;,&apos;oldname&apos;
go
</code></pre><h2 id="5-检查备份集"><a href="#5-检查备份集" class="headerlink" title="5. 检查备份集"></a>5. 检查备份集</h2><pre><code>RESTORE VERIFYONLY from disk=&apos;E:\dvbbs.bak&apos;
</code></pre><h2 id="6-修复数据库"><a href="#6-修复数据库" class="headerlink" title="6. 修复数据库"></a>6. 修复数据库</h2><pre><code>ALTER DATABASE [dvbbs] SET SINGLE_USER
GO
DBCC CHECKDB(&apos;dvbbs&apos;,repair_allow_data_loss) WITH TABLOCK
GO
ALTER DATABASE [dvbbs] SET MULTI_USER
GO
</code></pre><h2 id="7-日志清除"><a href="#7-日志清除" class="headerlink" title="7. 日志清除"></a>7. 日志清除</h2><pre><code>SET NOCOUNT ON
DECLARE @LogicalFileName sysname,
@MaxMinutes INT,
@NewSize INT

USE tablename -- 要操作的数据库名
SELECT  @LogicalFileName = &apos;tablename_log&apos;, -- 日志文件名
@MaxMinutes = 10, -- Limit on time allowed to wrap log.
@NewSize = 1  -- 你想设定的日志文件的大小(M)
Setup / initialize
DECLARE @OriginalSize int
SELECT @OriginalSize = size 
FROM sysfiles
WHERE name = @LogicalFileName
SELECT &apos;Original Size of &apos; + db_name() + &apos; LOG is &apos; + 
CONVERT(VARCHAR(30),@OriginalSize) + &apos; 8K pages or &apos; + 
CONVERT(VARCHAR(30),(@OriginalSize*8/1024)) + &apos;MB&apos;
FROM sysfiles
WHERE name = @LogicalFileName
CREATE TABLE DummyTrans
(DummyColumn char (8000) not null)

DECLARE @Counter    INT,
@StartTime DATETIME,
@TruncLog   VARCHAR(255)
SELECT @StartTime = GETDATE(),
@TruncLog = &apos;BACKUP LOG &apos; + db_name() + &apos; WITH TRUNCATE_ONLY&apos;
DBCC SHRINKFILE (@LogicalFileName, @NewSize)
EXEC (@TruncLog)
-- Wrap the log if necessary.
WHILE @MaxMinutes &gt; DATEDIFF (mi, @StartTime, GETDATE()) -- time has not expired
AND @OriginalSize = (SELECT size FROM sysfiles WHERE name = @LogicalFileName)  
AND (@OriginalSize * 8 /1024) &gt; @NewSize  
BEGIN -- Outer loop.
SELECT @Counter = 0
WHILE   ((@Counter &lt; @OriginalSize / 16) AND (@Counter &lt; 50000))
BEGIN -- update
INSERT DummyTrans VALUES (&apos;Fill Log&apos;) DELETE DummyTrans
SELECT @Counter = @Counter + 1
END
EXEC (@TruncLog)  
END
SELECT &apos;Final Size of &apos; + db_name() + &apos; LOG is &apos; +
CONVERT(VARCHAR(30),size) + &apos; 8K pages or &apos; + 
CONVERT(VARCHAR(30),(size*8/1024)) + &apos;MB&apos;
FROM sysfiles 
WHERE name = @LogicalFileName
DROP TABLE DummyTrans
SET NOCOUNT OFF
</code></pre><h2 id="8-更改某个表"><a href="#8-更改某个表" class="headerlink" title="8. 更改某个表"></a>8. 更改某个表</h2><pre><code>exec sp_changeobjectowner &apos;tablename&apos;,&apos;dbo&apos;
</code></pre><h2 id="9-存储更改全部表"><a href="#9-存储更改全部表" class="headerlink" title="9. 存储更改全部表"></a>9. 存储更改全部表</h2><pre><code>CREATE PROCEDURE dbo.User_ChangeObjectOwnerBatch
@OldOwner as NVARCHAR(128),
@NewOwner as NVARCHAR(128)
AS
DECLARE @Name    as NVARCHAR(128)
DECLARE @Owner   as NVARCHAR(128)
DECLARE @OwnerName   as NVARCHAR(128)
DECLARE curObject CURSOR FOR 
select &apos;Name&apos;    = name,
   &apos;Owner&apos;    = user_name(uid)
from sysobjects
where user_name(uid)=@OldOwner
order by name
OPEN   curObject
FETCH NEXT FROM curObject INTO @Name, @Owner
WHILE(@@FETCH_STATUS=0)
BEGIN     
if @Owner=@OldOwner 
begin
   set @OwnerName = @OldOwner + &apos;.&apos; + rtrim(@Name)
   exec sp_changeobjectowner @OwnerName, @NewOwner
end
-- select @name,@NewOwner,@OldOwner
FETCH NEXT FROM curObject INTO @Name, @Owner
END
close curObject
deallocate curObject
GO
</code></pre><h2 id="10-SQL-SERVER中直接循环写入数据"><a href="#10-SQL-SERVER中直接循环写入数据" class="headerlink" title="10. SQL SERVER中直接循环写入数据"></a>10. SQL SERVER中直接循环写入数据</h2><pre><code>declare @i int
set @i=1
while @i&lt;30
begin
insert into test (userid) values(@i)
set @i=@i+1
end
</code></pre><p>案例：<br>有如下表，要求就表中所有沒有及格的成绩，在每次增长0.1的基础上，使他们刚好及格:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th style="text-align:right">score</th>
</tr>
</thead>
<tbody>
<tr>
<td>Zhangshan</td>
<td style="text-align:right">80</td>
</tr>
<tr>
<td>Lishi</td>
<td style="text-align:right">59</td>
</tr>
<tr>
<td>Wangwu</td>
<td style="text-align:right">50</td>
</tr>
<tr>
<td>Songquan</td>
<td style="text-align:right">69</td>
</tr>
</tbody>
</table>
<pre><code>while((select min(score) from tb_table)&lt;60)
begin
update tb_table set score =score*1.01
where score&lt;60
if (select min(score) from tb_table)&gt;60
break
else
continue
end
</code></pre><h2 id="11-查看数据库属性"><a href="#11-查看数据库属性" class="headerlink" title="11. 查看数据库属性"></a>11. 查看数据库属性</h2><pre><code>sp_helpdb 数据库名
</code></pre><h2 id="12-按姓氏笔画排序"><a href="#12-按姓氏笔画排序" class="headerlink" title="12. 按姓氏笔画排序:"></a>12. 按姓氏笔画排序:</h2><pre><code>Select * From TableName Order By CustomerName Collate Chinese_PRC_Stroke_ci_as //从少到多
</code></pre><h2 id="13-数据库加密"><a href="#13-数据库加密" class="headerlink" title="13. 数据库加密:"></a>13. 数据库加密:</h2><pre><code>select encrypt(&apos;原始密码&apos;)
select pwdencrypt(&apos;原始密码&apos;)
select pwdcompare(&apos;原始密码&apos;,&apos;加密后密码&apos;) = 1--相同；否则不相同 encrypt(&apos;原始密码&apos;)
select pwdencrypt(&apos;原始密码&apos;)
select pwdcompare(&apos;原始密码&apos;,&apos;加密后密码&apos;) = 1--相同；否则不相同
</code></pre><h2 id="14-取回表中字段"><a href="#14-取回表中字段" class="headerlink" title="14. 取回表中字段:"></a>14. 取回表中字段:</h2><pre><code>declare @list varchar(1000),
@sql nvarchar(1000) 
select @list=@list+&apos;,&apos;+b.name from sysobjects a,syscolumns b where a.id=b.id and a.name=&apos;表A&apos;
set @sql=&apos;select &apos;+right(@list,len(@list)-1)+&apos; from 表A&apos; 
exec (@sql)
</code></pre><h2 id="15-查看硬盘分区"><a href="#15-查看硬盘分区" class="headerlink" title="15. 查看硬盘分区:"></a>15. 查看硬盘分区:</h2><pre><code>EXEC master..xp_fixeddrives
</code></pre><h2 id="16-比较A-B表是否相等"><a href="#16-比较A-B表是否相等" class="headerlink" title="16. 比较A,B表是否相等:"></a>16. 比较A,B表是否相等:</h2><pre><code>if (select checksum_agg(binary_checksum(*)) from A)
     =
    (select checksum_agg(binary_checksum(*)) from B)
print &apos;相等&apos;
else
print &apos;不相等&apos;
</code></pre><h2 id="17-杀掉所有的事件探察器进程"><a href="#17-杀掉所有的事件探察器进程" class="headerlink" title="17. 杀掉所有的事件探察器进程:"></a>17. 杀掉所有的事件探察器进程:</h2><pre><code>DECLARE hcforeach CURSOR GLOBAL FOR SELECT &apos;kill &apos;+RTRIM(spid) FROM master.dbo.sysprocesses
WHERE program_name IN(&apos;SQL profiler&apos;,N&apos;SQL 事件探查器&apos;)
EXEC sp_msforeach_worker &apos;?&apos;
</code></pre><h2 id="18-记录搜索"><a href="#18-记录搜索" class="headerlink" title="18. 记录搜索:"></a>18. 记录搜索:</h2><p>开头到N条记录</p>
<pre><code>Select Top N * From 表
</code></pre><p>N到M条记录(要有主索引ID)</p>
<pre><code>Select Top M-N * From 表 Where ID in (Select Top M ID From 表) Order by ID   Desc
</code></pre><p>N到结尾记录</p>
<pre><code>Select Top N * From 表 Order by ID Desc
</code></pre><h2 id="19-获取当前数据库中的所有用户表"><a href="#19-获取当前数据库中的所有用户表" class="headerlink" title="19. 获取当前数据库中的所有用户表"></a>19. 获取当前数据库中的所有用户表</h2><pre><code>select Name from sysobjects where xtype=&apos;u&apos; and status&gt;=0
</code></pre><h2 id="20-获取某一个表的所有字段"><a href="#20-获取某一个表的所有字段" class="headerlink" title="20. 获取某一个表的所有字段"></a>20. 获取某一个表的所有字段</h2><pre><code>select name from syscolumns where id=object_id(&apos;表名&apos;)
select name from syscolumns where id in (select id from sysobjects where type = &apos;u&apos; and name = &apos;表名&apos;)
</code></pre><p>两种方式的效果相同</p>
<h2 id="21-查看与某一个表相关的视图、存储过程、函数"><a href="#21-查看与某一个表相关的视图、存储过程、函数" class="headerlink" title="21. 查看与某一个表相关的视图、存储过程、函数"></a>21. 查看与某一个表相关的视图、存储过程、函数</h2><pre><code>select a.* from sysobjects a, syscomments b where a.id = b.id and b.text like &apos;%表名%&apos;
</code></pre><h2 id="22-查看当前数据库中所有存储过程"><a href="#22-查看当前数据库中所有存储过程" class="headerlink" title="22. 查看当前数据库中所有存储过程"></a>22. 查看当前数据库中所有存储过程</h2><pre><code>select name as 存储过程名称 from sysobjects where xtype=&apos;P&apos;
</code></pre><h2 id="23-查询用户创建的所有数据库"><a href="#23-查询用户创建的所有数据库" class="headerlink" title="23. 查询用户创建的所有数据库"></a>23. 查询用户创建的所有数据库</h2><pre><code>select * from master..sysdatabases D where sid not in(select sid from master..syslogins where name=&apos;sa&apos;)
</code></pre><p>或者</p>
<pre><code>select dbid, name AS DB_NAME from master..sysdatabases where sid &lt;&gt; 0x01
</code></pre><h2 id="24-查询某一个表的字段和数据类型"><a href="#24-查询某一个表的字段和数据类型" class="headerlink" title="24. 查询某一个表的字段和数据类型"></a>24. 查询某一个表的字段和数据类型</h2><pre><code>select column_name,data_type from information_schema.columns
where table_name = &apos;表名&apos;
</code></pre><h2 id="25-不同服务器数据库之间的数据操作"><a href="#25-不同服务器数据库之间的数据操作" class="headerlink" title="25. 不同服务器数据库之间的数据操作"></a>25. 不同服务器数据库之间的数据操作</h2><p>创建链接服务器</p>
<pre><code>exec sp_addlinkedserver &apos;ITSV &apos;, &apos; &apos;, &apos;SQLOLEDB &apos;, &apos;远程服务器名或ip地址 &apos;
exec sp_addlinkedsrvlogin &apos;ITSV &apos;, &apos;false &apos;,null, &apos;用户名 &apos;, &apos;密码 &apos;
</code></pre><p>查询示例</p>
<pre><code>select * from ITSV.数据库名.dbo.表名
</code></pre><p>导入示例</p>
<pre><code>select * into 表 from ITSV.数据库名.dbo.表名
</code></pre><p>以后不再使用时删除链接服务器</p>
<pre><code>exec sp_dropserver &apos;ITSV &apos;, &apos;droplogins &apos;
</code></pre><p>连接远程/局域网数据(openrowset/openquery/opendatasource)</p>
<ul>
<li><ol>
<li>openrowset<br>查询示例</li>
</ol>
</li>
</ul>
<pre><code>select * from openrowset( &apos;SQLOLEDB &apos;, &apos;sql服务器名 &apos;; &apos;用户名 &apos;; &apos;密码 &apos;,数据库名.dbo.表名)
</code></pre><p>生成本地表</p>
<pre><code>select * into 表 from openrowset( &apos;SQLOLEDB &apos;, &apos;sql服务器名 &apos;; &apos;用户名 &apos;; &apos;密码 &apos;,数据库名.dbo.表名)
</code></pre><p>把本地表导入远程表</p>
<pre><code>insert openrowset( &apos;SQLOLEDB &apos;, &apos;sql服务器名 &apos;; &apos;用户名 &apos;; &apos;密码 &apos;,数据库名.dbo.表名)
select *from 本地表
</code></pre><p>更新本地表</p>
<pre><code>update b
set b.列A=a.列A
from openrowset( &apos;SQLOLEDB &apos;, &apos;sql服务器名 &apos;; &apos;用户名 &apos;; &apos;密码 &apos;,数据库名.dbo.表名)as a inner join 本地表 b    on a.column1=b.column1
</code></pre><ul>
<li><ol>
<li>openquery用法需要创建一个连接<br>首先创建一个连接创建链接服务器</li>
</ol>
</li>
</ul>
<pre><code>exec sp_addlinkedserver &apos;ITSV &apos;, &apos; &apos;, &apos;SQLOLEDB &apos;, &apos;远程服务器名或ip地址 &apos;
</code></pre><p>查询</p>
<pre><code>select *
FROM openquery(ITSV, &apos;SELECT * FROM 数据库.dbo.表名 &apos;)
</code></pre><p>把本地表导入远程表</p>
<pre><code>insert openquery(ITSV, &apos;SELECT * FROM 数据库.dbo.表名 &apos;)
select * from 本地表
</code></pre><p>更新本地表</p>
<pre><code>update b
set b.列B=a.列B
FROM openquery(ITSV, &apos;SELECT * FROM 数据库.dbo.表名 &apos;) as a
inner join 本地表 b on a.列A=b.列A
</code></pre><ul>
<li><ol>
<li>opendatasource/openrowset</li>
</ol>
</li>
</ul>
<pre><code>SELECT *
FROM opendatasource( &apos;SQLOLEDB &apos;, &apos;Data Source=ip/ServerName;User ID=登陆名;Password=密码 &apos; ).test.dbo.roy_ta
</code></pre><p>把本地表导入远程表</p>
<pre><code>insert opendatasource( &apos;SQLOLEDB &apos;, &apos;Data Source=ip/ServerName;User ID=登陆名;Password=密码 &apos;).数据库.dbo.表名
select * from 本地表
</code></pre><h2 id="26-删除数据库下面的所有表"><a href="#26-删除数据库下面的所有表" class="headerlink" title="26. 删除数据库下面的所有表"></a>26. 删除数据库下面的所有表</h2><pre><code>use 数据库名(是要删除表的所在的那个数据库的名称)
GO
declare @sql varchar(8000)
while (select count(*) from sysobjects where type=&apos;U&apos;)&gt;0
begin
SELECT @sql=&apos;drop table &apos; + name
FROM sysobjects
WHERE (type = &apos;U&apos;)
ORDER BY &apos;drop table &apos; + name
exec(@sql) 
end
</code></pre><h2 id="27-查看数据库文件使用情况"><a href="#27-查看数据库文件使用情况" class="headerlink" title="27. 查看数据库文件使用情况"></a>27. 查看数据库文件使用情况</h2><pre><code>SELECT  A.name                                                     AS &quot;逻辑名称&quot;
       ,CONVERT(FLOAT ,A.size)             * (8192.0/1024.0)/1024  AS &quot;已用大小MB&quot;
       ,CONVERT(FLOAT ,A.maxSize - A.size) * (8192.0/1024.0)/1024  AS &quot;可用大小MB&quot;
       ,CONVERT(FLOAT ,A.maxSize)          * (8192.0/1024.0)/1024  AS &quot;分配大小MB&quot;
       ,A.fileName                                                 AS &quot;文件路径&quot;
       ,(
         SELECT  SA.groupName
           FROM  SysFileGroups  SA
          WHERE  SA.groupID = A.groupID
        )                                                          AS &quot;文件组&quot;
       ,CASE WHEN A.status = 1081346 THEN &apos;磁盘文件&apos;               
             WHEN A.status = 1081410 THEN &apos;日志设备&apos;
             ELSE CONVERT(VARCHAR ,A.status) END                   AS &quot;文件类型&quot;
  FROM  SysFiles  A
</code></pre><h2 id="28-修改sa的密码"><a href="#28-修改sa的密码" class="headerlink" title="28. 修改sa的密码"></a>28. 修改sa的密码</h2><pre><code>EXEC sp_password NULL,NULL,&apos;sa&apos;;
</code></pre><hr>
<h1 id="常识"><a href="#常识" class="headerlink" title="常识"></a>常识</h1><ul>
<li>在SQL查询中，from后最多可以跟256张表或视图</li>
<li>在SQL语句中出现 Order by，查询时，先排序，后取值</li>
<li>在SQL中，一个字段的最大容量是8000</li>
</ul>

                

                <hr>
                <!-- Pager -->
                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/FPSpread/【FPSpread】属性说明/" data-toggle="tooltip" data-placement="top" title="【FPSpread】属性说明">&larr; Previous Post</a>
                        </li>
                    
                    
                        <li class="next">
                            <a href="/SQL/【SQL】获取字符串最后出现的位置/" data-toggle="tooltip" data-placement="top" title="【SQL】获取字符串最后出现的位置">Next Post &rarr;</a>
                        </li>
                    
                </ul>

                <br>

                <!--打赏-->
                
                <!--打赏-->

                <br>
                <!--分享-->
                
                    <div class="social-share" data-wechat-qrcode-helper="" align="center"></div>
                    <!--  css & js -->
                    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css">
                    <script src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>
                
                <!--分享-->
                <br>                       
                
                <!-- require APlayer -->
                

                <!-- duoshuo Share start -->
                
                <!-- 多说 Share end-->

                <!-- 多说评论框 start -->
                
                <!-- 多说评论框 end -->

                <!-- disqus comment start -->
                
                <!-- disqus comment end -->

                

            </div>
            
            <!-- Tabe of Content -->
            <!-- Table of Contents -->

                
            <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                          <a class="tag" href="/tags/#SQL" title="SQL">SQL</a>
                        
                          <a class="tag" href="/tags/#经典语句" title="经典语句">经典语句</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">

                    
                        <li><a href="http://blog.csdn.net/yangpiena" target="_blank">CSDN Blog 昜丿捺</a></li>
                    
                </ul>
                
            </div>
        </div>
    </div>
</article>








<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'left',
          icon: 'ℬ'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                
                

                

                

                
                    <li>
                        <a target="_blank" href="https://github.com/huweihuang">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; 昜丿捺 2019 
                    <br>
                    Theme by <a href="http://beantech.org">BeanTech</a> 
                    <span style="display: inline-block; margin: 0 5px;">
                        <i class="fa fa-heart"></i>
                    </span> 
                    re-Ported by <a href="http://www.huweihuang.com">胡伟煌</a> | 
                    <iframe style="margin-left: 2px; margin-bottom:-5px;" frameborder="0" scrolling="0" width="91px" height="20px" src="https://ghbtns.com/github-btn.html?user=huweihuang&repo=hexo-theme-huweihuang&type=star&count=true">
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("http://www.yangpiena.com/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-XXXXXXXX-X';
    var _gaDomain = 'yoursite';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>




<!-- Baidu Tongji -->

<script>
    // dynamic User by Hux
    var _baId = 'xxx';

    // Originial
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?" + _baId;
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
</script>




<!--2017-10-06 YPN Add 添加鼠标点击特效 -->
<script type="text/javascript">
  /* 鼠标点击特效 */
  var a_idx = 0;
  jQuery(document).ready(function($) {
      $("body").click(function(e) {
  var a = new Array("富强", "民主", "文明", "和谐", "自由", "平等", "公正" ,"法治", "爱国", "敬业", "诚信", "友善");
  var $i = $("<span/>").text(a[a_idx]);
          a_idx = (a_idx + 1) % a.length;
  var x = e.pageX,
          y = e.pageY;
          $i.css({
  "z-index": 999999999999999999999999999999999999999999999999999999999999999999999,
  "top": y - 20,
  "left": x,
  "cursor":"default",
  "position": "absolute",
  "font-weight": "bold",
  "color": "#ff6651"
          });
          $("body").append($i);
          $i.animate({
  "top": y - 180,
  "opacity": 0
          },
          1500,
  function() {
              $i.remove();
          });
      });
  });
</script>

<!--2017-10-06 YPN Add 添加输入框特效。 -->
<script src="/js/activate-power-mode.js"></script>
<script>
  POWERMODE.colorful = true;  // 控制开启/开启礼花特效  
  POWERMODE.shake    = false; // 控制开启/关闭屏幕震动特效  
  document.body.addEventListener('input', POWERMODE);
</script>


	<a id="rocket" href="#top" class=""></a>
	<script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
    <script type="text/javascript" src="/js/toc.js?v=1.0.0" async=""></script>
<!-- Image to hack wechat -->
<img src="http://www.yangpiena.com/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
