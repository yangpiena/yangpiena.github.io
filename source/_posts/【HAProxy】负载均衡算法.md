---
title: 【HAProxy】负载均衡算法
layout: post
comments: true
date: 2017-12-20 10:03:35
categories: HAProxy
tags: [HAProxy]
keywords:
description:
---
常用的算法有：undrobin、source和lestconn。

<!-- more -->

1. roundrobin
表示简单的轮询，每个服务器根据权重轮流使用，在服务器的处理时间平均分配的情况下这是最流畅和公平的算法。
该算法是动态的，对于实例启动慢的服务器权重会在运行中调整。

2. static-rr
表示根据权重，每个服务器根据权重轮流使用，类似roundrobin，但它是静态的，意味着运行时修改权限是无效的。另外，它对服务器的数量没有限制。

3. leastconn
表示最少连接者先处理，leastconn建议用于长会话服务，例如LDAP、SQL、TSE等，而不适合短会话协议，如HTTP。
该算法是动态的，对于实例启动慢的服务器权重会在运行中调整。

4. source
表示根据请求源IP，对请求源IP地址进行哈希，用可用服务器的权重总数除以哈希值，根据结果进行分配。只要服务器正常，同一个客户端IP地址总是访问同一个服务器。如果哈希的结果随可用服务器数量而变化，那么客户端会定向到不同的服务器；
该算法一般用于不能插入cookie的Tcp模式。它还可以用于广域网上为拒绝使用会话cookie的客户端提供最有效的粘连；
该算法默认是静态的，所以运行时修改服务器的权重是无效的，但是算法会根据“hash-type”的变化做调整。

5. uri
表示根据请求的URI；根据请求的URI左端（问号之前）进行哈希，用可用服务器的权重总数除以哈希值，根据结果进行分配。只要服务器正常，同一个URI地址总是访问同一个服务器。
一般用于代理缓存和反病毒代理，以最大限度的提高缓存的命中率。
该算法只能用于HTTP后端；该算法一般用于后端是缓存服务器；
该算法默认是静态的，所以运行时修改服务器的权重是无效的，但是算法会根据“hash-type”的变化做调整。

6. url_param
表示根据请求的URl参数'balance url_param' requires an URL parameter name，在HTTP GET请求的查询串中查找<param>中指定的URL参数，基本上可以锁定使用特制的URL到特定的负载均衡器节点的要求；
该算法一般用于将同一个用户的信息发送到同一个后端服务器；
该算法默认是静态的，所以运行时修改服务器的权重是无效的，但是算法会根据“hash-type”的变化做调整。

7. hdr(name)
表示根据HTTP请求头来锁定每一次HTTP请求；在每个HTTP请求中查找HTTP头<name>，HTTP头<name>将被看作在每个HTTP请求，并针对特定的节点；
如果缺少头或者头没有任何值，则用roundrobin代替；
该算法默认是静态的，所以运行时修改服务器的权重是无效的，但是算法会根据“hash-type”的变化做调整。

8. rdp-cookie(name)
表示根据据cookie(name)来锁定并哈希每一次TCP请求。为每个进来的TCP请求查询并哈希RDP cookie<name>；
该机制用于退化的持久模式，可以使同一个用户或者同一个会话ID总是发送给同一台服务器。
如果没有cookie，则使用roundrobin算法代替；
该算法默认是静态的，所以运行时修改服务器的权重是无效的，但是算法会根据“hash-type”的变化做调整。